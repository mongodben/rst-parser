(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{"/GqU":function(t,e,n){var r=n("RK3t"),o=n("HYAF");t.exports=function(t){return r(o(t))}},"/b8u":function(t,e,n){var r=n("STAE");t.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},"/qmn":function(t,e,n){var r=n("2oRo");t.exports=r.Promise},"0BK2":function(t,e){t.exports={}},"0Dky":function(t,e){t.exports=function(t){try{return!!t()}catch(e){return!0}}},"0GbY":function(t,e,n){var r=n("Qo9l"),o=n("2oRo"),i=function(t){return"function"==typeof t?t:void 0};t.exports=function(t,e){return arguments.length<2?i(r[t])||i(o[t]):r[t]&&r[t][e]||o[t]&&o[t][e]}},"0eef":function(t,e,n){"use strict";var r={}.propertyIsEnumerable,o=Object.getOwnPropertyDescriptor,i=o&&!r.call({1:2},1);e.f=i?function(t){var e=o(this,t);return!!e&&e.enumerable}:r},"2lpH":function(t,e){t.exports=r;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(_){}function r(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}function o(t){return!0===(t&&t.__isLong__)}r.prototype.__isLong__,Object.defineProperty(r.prototype,"__isLong__",{value:!0}),r.isLong=o;var i={},s={};function u(t,e){var n,r,o;return e?(o=0<=(t>>>=0)&&t<256)&&(r=s[t])?r:(n=c(t,(0|t)<0?-1:0,!0),o&&(s[t]=n),n):(o=-128<=(t|=0)&&t<128)&&(r=i[t])?r:(n=c(t,t<0?-1:0,!1),o&&(i[t]=n),n)}function a(t,e){if(isNaN(t))return e?m:g;if(e){if(t<0)return m;if(t>=l)return b}else{if(t<=-v)return I;if(t+1>=v)return R}return t<0?a(-t,e).neg():c(t%p|0,t/p|0,e)}function c(t,e,n){return new r(t,e,n)}r.fromInt=u,r.fromNumber=a,r.fromBits=c;var h=Math.pow;function d(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return g;if("number"==typeof e?(n=e,e=!1):e=!!e,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return d(t.substring(1),e,n).neg();for(var o=a(h(n,8)),i=g,s=0;s<t.length;s+=8){var u=Math.min(8,t.length-s),c=parseInt(t.substring(s,s+u),n);if(u<8){var f=a(h(n,u));i=i.mul(f).add(a(c))}else i=(i=i.mul(o)).add(a(c))}return i.unsigned=e,i}function f(t,e){return"number"==typeof t?a(t,e):"string"==typeof t?d(t,e):c(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}r.fromString=d,r.fromValue=f;var p=4294967296,l=p*p,v=l/2,y=u(1<<24),g=u(0);r.ZERO=g;var m=u(0,!0);r.UZERO=m;var E=u(1);r.ONE=E;var A=u(1,!0);r.UONE=A;var w=u(-1);r.NEG_ONE=w;var R=c(-1,2147483647,!1);r.MAX_VALUE=R;var b=c(-1,-1,!0);r.MAX_UNSIGNED_VALUE=b;var I=c(0,-2147483648,!1);r.MIN_VALUE=I;var O=r.prototype;O.toInt=function(){return this.unsigned?this.low>>>0:this.low},O.toNumber=function(){return this.unsigned?(this.high>>>0)*p+(this.low>>>0):this.high*p+(this.low>>>0)},O.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(I)){var e=a(t),n=this.div(e),r=n.mul(e).sub(this);return n.toString(t)+r.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var o=a(h(t,6),this.unsigned),i=this,s="";;){var u=i.div(o),c=(i.sub(u.mul(o)).toInt()>>>0).toString(t);if((i=u).isZero())return c+s;for(;c.length<6;)c="0"+c;s=""+c+s}},O.getHighBits=function(){return this.high},O.getHighBitsUnsigned=function(){return this.high>>>0},O.getLowBits=function(){return this.low},O.getLowBitsUnsigned=function(){return this.low>>>0},O.getNumBitsAbs=function(){if(this.isNegative())return this.eq(I)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},O.isZero=function(){return 0===this.high&&0===this.low},O.eqz=O.isZero,O.isNegative=function(){return!this.unsigned&&this.high<0},O.isPositive=function(){return this.unsigned||this.high>=0},O.isOdd=function(){return 1==(1&this.low)},O.isEven=function(){return 0==(1&this.low)},O.equals=function(t){return o(t)||(t=f(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},O.eq=O.equals,O.notEquals=function(t){return!this.eq(t)},O.neq=O.notEquals,O.ne=O.notEquals,O.lessThan=function(t){return this.comp(t)<0},O.lt=O.lessThan,O.lessThanOrEqual=function(t){return this.comp(t)<=0},O.lte=O.lessThanOrEqual,O.le=O.lessThanOrEqual,O.greaterThan=function(t){return this.comp(t)>0},O.gt=O.greaterThan,O.greaterThanOrEqual=function(t){return this.comp(t)>=0},O.gte=O.greaterThanOrEqual,O.ge=O.greaterThanOrEqual,O.compare=function(t){if(o(t)||(t=f(t)),this.eq(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},O.comp=O.compare,O.negate=function(){return!this.unsigned&&this.eq(I)?I:this.not().add(E)},O.neg=O.negate,O.add=function(t){o(t)||(t=f(t));var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,i=65535&this.low,s=t.high>>>16,u=65535&t.high,a=t.low>>>16,h=0,d=0,p=0,l=0;return p+=(l+=i+(65535&t.low))>>>16,d+=(p+=r+a)>>>16,h+=(d+=n+u)>>>16,h+=e+s,c((p&=65535)<<16|(l&=65535),(h&=65535)<<16|(d&=65535),this.unsigned)},O.subtract=function(t){return o(t)||(t=f(t)),this.add(t.neg())},O.sub=O.subtract,O.multiply=function(t){if(this.isZero())return g;if(o(t)||(t=f(t)),n)return c(n.mul(this.low,this.high,t.low,t.high),n.get_high(),this.unsigned);if(t.isZero())return g;if(this.eq(I))return t.isOdd()?I:g;if(t.eq(I))return this.isOdd()?I:g;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(y)&&t.lt(y))return a(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,r=65535&this.high,i=this.low>>>16,s=65535&this.low,u=t.high>>>16,h=65535&t.high,d=t.low>>>16,p=65535&t.low,l=0,v=0,m=0,E=0;return m+=(E+=s*p)>>>16,v+=(m+=i*p)>>>16,m&=65535,v+=(m+=s*d)>>>16,l+=(v+=r*p)>>>16,v&=65535,l+=(v+=i*d)>>>16,v&=65535,l+=(v+=s*h)>>>16,l+=e*p+r*d+i*h+s*u,c((m&=65535)<<16|(E&=65535),(l&=65535)<<16|(v&=65535),this.unsigned)},O.mul=O.multiply,O.divide=function(t){if(o(t)||(t=f(t)),t.isZero())throw Error("division by zero");var e,r,i;if(n)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?c((this.unsigned?n.div_u:n.div_s)(this.low,this.high,t.low,t.high),n.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?m:g;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return m;if(t.gt(this.shru(1)))return A;i=m}else{if(this.eq(I))return t.eq(E)||t.eq(w)?I:t.eq(I)?E:(e=this.shr(1).div(t).shl(1)).eq(g)?t.isNegative()?E:w:(r=this.sub(t.mul(e)),i=e.add(r.div(t)));if(t.eq(I))return this.unsigned?m:g;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();i=g}for(r=this;r.gte(t);){e=Math.max(1,Math.floor(r.toNumber()/t.toNumber()));for(var s=Math.ceil(Math.log(e)/Math.LN2),u=s<=48?1:h(2,s-48),d=a(e),p=d.mul(t);p.isNegative()||p.gt(r);)p=(d=a(e-=u,this.unsigned)).mul(t);d.isZero()&&(d=E),i=i.add(d),r=r.sub(p)}return i},O.div=O.divide,O.modulo=function(t){return o(t)||(t=f(t)),n?c((this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,t.low,t.high),n.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},O.mod=O.modulo,O.rem=O.modulo,O.not=function(){return c(~this.low,~this.high,this.unsigned)},O.and=function(t){return o(t)||(t=f(t)),c(this.low&t.low,this.high&t.high,this.unsigned)},O.or=function(t){return o(t)||(t=f(t)),c(this.low|t.low,this.high|t.high,this.unsigned)},O.xor=function(t){return o(t)||(t=f(t)),c(this.low^t.low,this.high^t.high,this.unsigned)},O.shiftLeft=function(t){return o(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?c(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):c(0,this.low<<t-32,this.unsigned)},O.shl=O.shiftLeft,O.shiftRight=function(t){return o(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?c(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):c(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},O.shr=O.shiftRight,O.shiftRightUnsigned=function(t){if(o(t)&&(t=t.toInt()),0===(t&=63))return this;var e=this.high;return t<32?c(this.low>>>t|e<<32-t,e>>>t,this.unsigned):c(32===t?e:e>>>t-32,0,this.unsigned)},O.shru=O.shiftRightUnsigned,O.shr_u=O.shiftRightUnsigned,O.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},O.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},O.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},O.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},O.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},r.fromBytes=function(t,e,n){return n?r.fromBytesLE(t,e):r.fromBytesBE(t,e)},r.fromBytesLE=function(t,e){return new r(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},r.fromBytesBE=function(t,e){return new r(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)}},"2oRo":function(t,e,n){(function(e){var n=function(t){return t&&t.Math==Math&&t};t.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof e&&e)||function(){return this}()||Function("return this")()}).call(this,n("yLpj"))},"6JNq":function(t,e,n){var r=n("UTVS"),o=n("Vu81"),i=n("Bs8V"),s=n("m/L8");t.exports=function(t,e){for(var n=o(e),u=s.f,a=i.f,c=0;c<n.length;c++){var h=n[c];r(t,h)||u(t,h,a(e,h))}}},"8GlL":function(t,e,n){"use strict";var r=n("HAuM"),o=function(t){var e,n;this.promise=new t((function(t,r){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=r})),this.resolve=r(e),this.reject=r(n)};t.exports.f=function(t){return new o(t)}},"93I0":function(t,e,n){var r=n("VpIT"),o=n("kOOl"),i=r("keys");t.exports=function(t){return i[t]||(i[t]=o(t))}},Bs8V:function(t,e,n){var r=n("g6v/"),o=n("0eef"),i=n("XGwC"),s=n("/GqU"),u=n("wE6v"),a=n("UTVS"),c=n("DPsx"),h=Object.getOwnPropertyDescriptor;e.f=r?h:function(t,e){if(t=s(t),e=u(e,!0),c)try{return h(t,e)}catch(n){}if(a(t,e))return i(!o.f.call(t,e),t[e])}},DPsx:function(t,e,n){var r=n("g6v/"),o=n("0Dky"),i=n("zBJ4");t.exports=!r&&!o((function(){return 7!=Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a}))},HAuM:function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t}},HYAF:function(t,e){t.exports=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t}},HiXI:function(t,e,n){"use strict";var r=n("I+eb"),o=n("WKiH").end,i=n("yNLB")("trimEnd"),s=i?function(){return o(this)}:"".trimEnd;r({target:"String",proto:!0,forced:i},{trimEnd:s,trimRight:s})},"I+eb":function(t,e,n){var r=n("2oRo"),o=n("Bs8V").f,i=n("kRJp"),s=n("busE"),u=n("zk60"),a=n("6JNq"),c=n("lMq5");t.exports=function(t,e){var n,h,d,f,p,l=t.target,v=t.global,y=t.stat;if(n=v?r:y?r[l]||u(l,{}):(r[l]||{}).prototype)for(h in e){if(f=e[h],d=t.noTargetGet?(p=o(n,h))&&p.value:n[h],!c(v?h:l+(y?".":"#")+h,t.forced)&&void 0!==d){if(typeof f==typeof d)continue;a(f,d)}(t.sham||d&&d.sham)&&i(f,"sham",!0),s(n,h,f,t)}}},I8vh:function(t,e,n){var r=n("ppGB"),o=Math.max,i=Math.min;t.exports=function(t,e){var n=r(t);return n<0?o(n+e,0):i(n,e)}},JBy8:function(t,e,n){var r=n("yoRg"),o=n("eDl+").concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return r(t,o)}},Qo9l:function(t,e,n){var r=n("2oRo");t.exports=r},RK3t:function(t,e,n){var r=n("0Dky"),o=n("xrYK"),i="".split;t.exports=r((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==o(t)?i.call(t,""):Object(t)}:Object},SEBh:function(t,e,n){var r=n("glrk"),o=n("HAuM"),i=n("tiKp")("species");t.exports=function(t,e){var n,s=r(t).constructor;return void 0===s||null==(n=r(s)[i])?e:o(n)}},STAE:function(t,e,n){var r=n("0Dky");t.exports=!!Object.getOwnPropertySymbols&&!r((function(){return!String(Symbol())}))},SjWX:function(t,e,n){(function(e){function n(t){var e=i([["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/],["Search Bot",/(nuhk)|(Googlebot)|(Yammybot)|(Openbot)|(Slurp)|(MSNBot)|(Ask Jeeves\/Teoma)|(ia_archiver)/]]).filter((function(e){return e.rule&&e.rule.test(t)}))[0];return e?e.name:null}function r(){return void 0!==e&&e.version&&{name:"node",version:e.version.slice(1),os:e.platform}}function o(t){var e=i([["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["vivaldi",/Vivaldi\/([0-9\.]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)$/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FBAV\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/]]);if(!t)return null;var r=e.map((function(e){var n=e.rule.exec(t),r=n&&n[1].split(/[._]/).slice(0,3);return r&&r.length<3&&(r=r.concat(1==r.length?[0,0]:[0])),n&&{name:e.name,version:r.join(".")}})).filter(Boolean)[0]||null;return r&&(r.os=n(t)),/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/i.test(t)&&((r=r||{}).bot=!0),r}function i(t){return t.map((function(t){return{name:t[0],rule:t[1]}}))}t.exports={detect:function(){return"undefined"!=typeof navigator?o(navigator.userAgent):r()},detectOS:n,getNodeVersion:r,parseUserAgent:o}}).call(this,n("8oxB"))},TWQb:function(t,e,n){var r=n("/GqU"),o=n("UMSQ"),i=n("I8vh"),s=function(t){return function(e,n,s){var u,a=r(e),c=o(a.length),h=i(s,c);if(t&&n!=n){for(;c>h;)if((u=a[h++])!=u)return!0}else for(;c>h;h++)if((t||h in a)&&a[h]===n)return t||h||0;return!t&&-1}};t.exports={includes:s(!0),indexOf:s(!1)}},UMSQ:function(t,e,n){var r=n("ppGB"),o=Math.min;t.exports=function(t){return t>0?o(r(t),9007199254740991):0}},UTVS:function(t,e){var n={}.hasOwnProperty;t.exports=function(t,e){return n.call(t,e)}},VpIT:function(t,e,n){var r=n("xDBR"),o=n("xs3f");(t.exports=function(t,e){return o[t]||(o[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.8.3",mode:r?"pure":"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})},Vu81:function(t,e,n){var r=n("0GbY"),o=n("JBy8"),i=n("dBg+"),s=n("glrk");t.exports=r("Reflect","ownKeys")||function(t){var e=o.f(s(t)),n=i.f;return n?e.concat(n(t)):e}},WJkJ:function(t,e){t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},WKiH:function(t,e,n){var r=n("HYAF"),o="["+n("WJkJ")+"]",i=RegExp("^"+o+o+"*"),s=RegExp(o+o+"*$"),u=function(t){return function(e){var n=String(r(e));return 1&t&&(n=n.replace(i,"")),2&t&&(n=n.replace(s,"")),n}};t.exports={start:u(1),end:u(2),trim:u(3)}},XGwC:function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},afO8:function(t,e,n){var r,o,i,s=n("f5p1"),u=n("2oRo"),a=n("hh1v"),c=n("kRJp"),h=n("UTVS"),d=n("xs3f"),f=n("93I0"),p=n("0BK2"),l=u.WeakMap;if(s){var v=d.state||(d.state=new l),y=v.get,g=v.has,m=v.set;r=function(t,e){return e.facade=t,m.call(v,t,e),e},o=function(t){return y.call(v,t)||{}},i=function(t){return g.call(v,t)}}else{var E=f("state");p[E]=!0,r=function(t,e){return e.facade=t,c(t,E,e),e},o=function(t){return h(t,E)?t[E]:{}},i=function(t){return h(t,E)}}t.exports={set:r,get:o,has:i,enforce:function(t){return i(t)?o(t):r(t,{})},getterFor:function(t){return function(e){var n;if(!a(e)||(n=o(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return n}}}},bOD8:function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return u}));var r=n("wTIg"),o=(n("q1tI"),n("sX4h")),i=n("v0vc"),s=n("qKvR");function u(){return Object(o.a)().isTabletOrMobile&&Object(s.d)(a,null,Object(s.d)(c,null,"How helpful was this page?",Object(s.d)(i.c,{size:"2x"})))}var a=Object(r.a)("div",{target:"e1ngsyzt0"})({name:"18t80ih",styles:"display:flex;position:relative;justify-content:center;align-items:center;"}),c=Object(r.a)("div",{target:"e1ngsyzt1"})({name:"oml8yh",styles:"display:flex;flex-direction:column;align-items:center;width:220px;max-height:80px;"})},bpZ4:function(t,e,n){"use strict";n.d(e,"a",(function(){return u})),n.d(e,"c",(function(){return a})),n.d(e,"b",(function(){return c})),n.d(e,"d",(function(){return h}));var r=n("wx14"),o=n("zLVn"),i=(n("q1tI"),n("qKvR")),s=function(t){var e=t.icon,n=t.size,s=t.spin,u=Object(o.a)(t,["icon","size","spin"]),a=["fa","fa-"+e,"fa-"+n];return s&&a.push("fa-spin"),Object(i.d)("div",Object(r.a)({className:a.join(" ")},u))},u=function(t){return Object(i.d)(s,Object(r.a)({icon:"camera"},t))},a=function(t){return Object(i.d)(s,Object(r.a)({icon:"spinner",spin:!0},t))},c=function(t){return Object(i.d)(s,Object(r.a)({icon:"check"},t))},h=function(t){return Object(i.d)(s,Object(r.a)({icon:"star"},t))}},busE:function(t,e,n){var r=n("2oRo"),o=n("kRJp"),i=n("UTVS"),s=n("zk60"),u=n("iSVu"),a=n("afO8"),c=a.get,h=a.enforce,d=String(String).split("String");(t.exports=function(t,e,n,u){var a,c=!!u&&!!u.unsafe,f=!!u&&!!u.enumerable,p=!!u&&!!u.noTargetGet;"function"==typeof n&&("string"!=typeof e||i(n,"name")||o(n,"name",e),(a=h(n)).source||(a.source=d.join("string"==typeof e?e:""))),t!==r?(c?!p&&t[e]&&(f=!0):delete t[e],f?t[e]=n:o(t,e,n)):f?t[e]=n:s(e,n)})(Function.prototype,"toString",(function(){return"function"==typeof this&&c(this).source||u(this)}))},d77F:function(t,e,n){"use strict";n.d(e,"a",(function(){return Ai})),n.d(e,"b",(function(){return Ri}));var r,o=n("KQm4"),i=n("o0o1"),s=n.n(i),u=(n("ls82"),n("HaE+")),a=n("zLVn"),c=n("q1tI"),h=n.n(c),d=n("no5z");!function(t){t[t.ActiveUserChanged=0]="ActiveUserChanged",t[t.ListenerRegistered=1]="ListenerRegistered",t[t.UserAdded=2]="UserAdded",t[t.UserLinked=3]="UserLinked",t[t.UserLoggedIn=4]="UserLoggedIn",t[t.UserLoggedOut=5]="UserLoggedOut",t[t.UserRemoved=6]="UserRemoved"}(r||(r={}));var f,p=function(){function t(t,e,n,r,o,i,s,u){this.userId=t,this.deviceId=e,this.accessToken=n,this.refreshToken=r,this.loggedInProviderType=o,this.loggedInProviderName=i,this.lastAuthActivity=s,this.userProfile=u}return t.empty=function(){return new t(void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0)},Object.defineProperty(t.prototype,"hasUser",{get:function(){return void 0!==this.userId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isEmpty",{get:function(){return void 0===this.deviceId},enumerable:!0,configurable:!0}),t.prototype.loggedOut=function(){return new t(this.userId,this.deviceId,void 0,void 0,this.loggedInProviderType,this.loggedInProviderName,new Date,this.userProfile)},t.prototype.withClearedUser=function(){return new t(void 0,this.deviceId,void 0,void 0,void 0,void 0,void 0,void 0)},t.prototype.withAuthProvider=function(e,n){return new t(this.userId,this.deviceId,this.accessToken,this.refreshToken,e,n,new Date,this.userProfile)},t.prototype.withNewAuthActivityTime=function(){return new t(this.userId,this.deviceId,this.accessToken,this.refreshToken,this.loggedInProviderType,this.loggedInProviderName,new Date,this.userProfile)},Object.defineProperty(t.prototype,"isLoggedIn",{get:function(){return void 0!==this.accessToken&&void 0!==this.refreshToken},enumerable:!0,configurable:!0}),t.prototype.merge=function(e){return new t(void 0===e.userId?this.userId:e.userId,void 0===e.deviceId?this.deviceId:e.deviceId,void 0===e.accessToken?this.accessToken:e.accessToken,void 0===e.refreshToken?this.refreshToken:e.refreshToken,void 0===e.loggedInProviderType?this.loggedInProviderType:e.loggedInProviderType,void 0===e.loggedInProviderName?this.loggedInProviderName:e.loggedInProviderName,void 0===e.lastAuthActivity?this.lastAuthActivity:e.lastAuthActivity,void 0===e.userProfile?this.userProfile:e.userProfile)},t}(),l=(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}f(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),v=function(t){Error.call(this,t),Error.captureStackTrace&&Error.captureStackTrace(this),this.message=t,this.name=this.constructor.name};v.prototype=Object.create(Error.prototype);var y,g,m=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e}(v);!function(t){t[t.TRANSPORT_ERROR=0]="TRANSPORT_ERROR",t[t.DECODING_ERROR=1]="DECODING_ERROR",t[t.ENCODING_ERROR=2]="ENCODING_ERROR"}(g||(g={}));var E,A=((y={})[g.TRANSPORT_ERROR]="the request transport encountered an error communicating with Stitch",y[g.DECODING_ERROR]="an error occurred while decoding a response from Stitch",y[g.ENCODING_ERROR]="an error occurred while encoding a request for Stitch",y),w=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),R=function(t){function e(e,n){var r=this,o="("+g[n]+"): "+A[n]+": "+e.message;return(r=t.call(this,o)||this).underlyingError=e,r.errorCode=n,r.errorCodeName=g[n],r}return w(e,t),e}(m);!function(t){t[t.MissingAuthReq=0]="MissingAuthReq",t[t.InvalidSession=1]="InvalidSession",t[t.UserAppDomainMismatch=2]="UserAppDomainMismatch",t[t.DomainNotAllowed=3]="DomainNotAllowed",t[t.ReadSizeLimitExceeded=4]="ReadSizeLimitExceeded",t[t.InvalidParameter=5]="InvalidParameter",t[t.MissingParameter=6]="MissingParameter",t[t.TwilioError=7]="TwilioError",t[t.GCMError=8]="GCMError",t[t.HTTPError=9]="HTTPError",t[t.AWSError=10]="AWSError",t[t.MongoDBError=11]="MongoDBError",t[t.ArgumentsNotAllowed=12]="ArgumentsNotAllowed",t[t.FunctionExecutionError=13]="FunctionExecutionError",t[t.NoMatchingRuleFound=14]="NoMatchingRuleFound",t[t.InternalServerError=15]="InternalServerError",t[t.AuthProviderNotFound=16]="AuthProviderNotFound",t[t.AuthProviderAlreadyExists=17]="AuthProviderAlreadyExists",t[t.ServiceNotFound=18]="ServiceNotFound",t[t.ServiceTypeNotFound=19]="ServiceTypeNotFound",t[t.ServiceAlreadyExists=20]="ServiceAlreadyExists",t[t.ServiceCommandNotFound=21]="ServiceCommandNotFound",t[t.ValueNotFound=22]="ValueNotFound",t[t.ValueAlreadyExists=23]="ValueAlreadyExists",t[t.ValueDuplicateName=24]="ValueDuplicateName",t[t.FunctionNotFound=25]="FunctionNotFound",t[t.FunctionAlreadyExists=26]="FunctionAlreadyExists",t[t.FunctionDuplicateName=27]="FunctionDuplicateName",t[t.FunctionSyntaxError=28]="FunctionSyntaxError",t[t.FunctionInvalid=29]="FunctionInvalid",t[t.IncomingWebhookNotFound=30]="IncomingWebhookNotFound",t[t.IncomingWebhookAlreadyExists=31]="IncomingWebhookAlreadyExists",t[t.IncomingWebhookDuplicateName=32]="IncomingWebhookDuplicateName",t[t.RuleNotFound=33]="RuleNotFound",t[t.ApiKeyNotFound=34]="ApiKeyNotFound",t[t.RuleAlreadyExists=35]="RuleAlreadyExists",t[t.RuleDuplicateName=36]="RuleDuplicateName",t[t.AuthProviderDuplicateName=37]="AuthProviderDuplicateName",t[t.RestrictedHost=38]="RestrictedHost",t[t.ApiKeyAlreadyExists=39]="ApiKeyAlreadyExists",t[t.IncomingWebhookAuthFailed=40]="IncomingWebhookAuthFailed",t[t.ExecutionTimeLimitExceeded=41]="ExecutionTimeLimitExceeded",t[t.FunctionNotCallable=42]="FunctionNotCallable",t[t.UserAlreadyConfirmed=43]="UserAlreadyConfirmed",t[t.UserNotFound=44]="UserNotFound",t[t.UserDisabled=45]="UserDisabled",t[t.Unknown=46]="Unknown"}(E||(E={}));var b={APIKeyAlreadyExists:E.ApiKeyAlreadyExists,APIKeyNotFound:E.ApiKeyNotFound,AWSError:E.AWSError,ArgumentsNotAllowed:E.ArgumentsNotAllowed,AuthProviderAlreadyExists:E.AuthProviderAlreadyExists,AuthProviderDuplicateName:E.AuthProviderDuplicateName,AuthProviderNotFound:E.AuthProviderNotFound,DomainNotAllowed:E.DomainNotAllowed,ExecutionTimeLimitExceeded:E.ExecutionTimeLimitExceeded,FunctionAlreadyExists:E.FunctionAlreadyExists,FunctionDuplicateName:E.FunctionDuplicateName,FunctionExecutionError:E.FunctionExecutionError,FunctionInvalid:E.FunctionInvalid,FunctionNotCallable:E.FunctionNotCallable,FunctionNotFound:E.FunctionNotFound,FunctionSyntaxError:E.FunctionSyntaxError,GCMError:E.GCMError,HTTPError:E.HTTPError,IncomingWebhookAlreadyExists:E.IncomingWebhookAlreadyExists,IncomingWebhookAuthFailed:E.IncomingWebhookAuthFailed,IncomingWebhookDuplicateName:E.IncomingWebhookDuplicateName,IncomingWebhookNotFound:E.IncomingWebhookNotFound,InternalServerError:E.InternalServerError,InvalidParameter:E.InvalidParameter,InvalidSession:E.InvalidSession,MissingAuthReq:E.MissingAuthReq,MissingParameter:E.MissingParameter,MongoDBError:E.MongoDBError,NoMatchingRuleFound:E.NoMatchingRuleFound,ReadSizeLimitExceeded:E.ReadSizeLimitExceeded,RestrictedHost:E.RestrictedHost,RuleAlreadyExists:E.RuleAlreadyExists,RuleDuplicateName:E.RuleDuplicateName,RuleNotFound:E.RuleNotFound,ServiceAlreadyExists:E.ServiceAlreadyExists,ServiceCommandNotFound:E.ServiceCommandNotFound,ServiceNotFound:E.ServiceNotFound,ServiceTypeNotFound:E.ServiceTypeNotFound,TwilioError:E.TwilioError,UserAlreadyConfirmed:E.UserAlreadyConfirmed,UserAppDomainMismatch:E.UserAppDomainMismatch,UserDisabled:E.UserDisabled,UserNotFound:E.UserNotFound,ValueAlreadyExists:E.ValueAlreadyExists,ValueDuplicateName:E.ValueDuplicateName,ValueNotFound:E.ValueNotFound};function I(t){return t in b?b[t]:E.Unknown}var O,_,T=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),N=function(t){function e(e,n){void 0===n&&(n=E.Unknown);var r=t.call(this,e)||this;return r.message=e,r.errorCode=n,r.errorCodeName=E[n],r}return T(e,t),e}(m),P=function(){function t(){}return t.APPLICATION_JSON="application/json",t.TEXT_EVENT_STREAM="text/event-stream",t}(),S=function(){function t(){}return t.getAuthorizationBearer=function(e){return t.AUTHORIZATION_BEARER+" "+e},t.CONTENT_TYPE_CANON="Content-Type",t.CONTENT_TYPE=t.CONTENT_TYPE_CANON.toLocaleLowerCase(),t.AUTHORIZATION_CANON="Authorization",t.AUTHORIZATION=t.AUTHORIZATION_CANON.toLocaleLowerCase(),t.ACCEPT_CANON="Accept",t.ACCEPT=t.ACCEPT_CANON.toLocaleLowerCase(),t.AUTHORIZATION_BEARER="Bearer",t}();function U(t){return t instanceof m?t:new R(t,g.DECODING_ERROR)}function k(t){if(void 0===t.body)throw new N("received unexpected status code "+t.statusCode,E.Unknown);var e;try{e=t.body}catch(r){throw new N("received unexpected status code "+t.statusCode,E.Unknown)}var n=function(t,e){if(void 0===t.headers[S.CONTENT_TYPE]||void 0!==t.headers[S.CONTENT_TYPE]&&t.headers[S.CONTENT_TYPE]!==P.APPLICATION_JSON)return e;var n=JSON.parse(e);if(!(n instanceof Object))return e;var r=n;if(void 0===r[O.ERROR])return e;var o=r[O.ERROR];if(void 0===r[O.ERROR_CODE])return o;var i=r[O.ERROR_CODE];throw new N(o,I(i))}(t,e);throw new N(n,E.Unknown)}!function(t){t.ERROR="error",t.ERROR_CODE="error_code"}(O||(O={})),function(t){t.GET="GET",t.POST="POST",t.PUT="PUT",t.DELETE="DELETE",t.HEAD="HEAD",t.OPTIONS="OPTIONS",t.TRACE="TRACE",t.PATCH="PATCH"}(_||(_={}));var D=_,C=function(){function t(t,e,n,r,o){this.method=t,this.path=e,this.headers=n,this.body=o,this.startedAt=r}return Object.defineProperty(t.prototype,"builder",{get:function(){return new t.Builder(this)},enumerable:!0,configurable:!0}),t}();!function(t){var e=function(){function e(t){void 0!==t&&(this.method=t.method,this.path=t.path,this.headers=t.headers,this.body=t.body,this.startedAt=t.startedAt)}return e.prototype.withMethod=function(t){return this.method=t,this},e.prototype.withPath=function(t){return this.path=t,this},e.prototype.withHeaders=function(t){return this.headers=t,this},e.prototype.withBody=function(t){return this.body=t,this},e.prototype.build=function(){if(void 0===this.method)throw Error("must set method");if(void 0===this.path)throw Error("must set non-empty path");return void 0===this.startedAt&&(this.startedAt=Date.now()/1e3),new t(this.method,this.path,void 0===this.headers?{}:this.headers,this.startedAt,this.body)},e}();t.Builder=e}(C||(C={}));var L,x,F=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),M=function(t){function e(e,n,r){void 0===n&&(n=!1),void 0===r&&(r=!0);var o=t.call(this,e.method,e.path,e.headers,e.startedAt,e.body)||this;return o.useRefreshToken=n,o.shouldRefreshOnFailure=r,o}return F(e,t),Object.defineProperty(e.prototype,"builder",{get:function(){return new e.Builder(this)},enumerable:!0,configurable:!0}),e}(C);L=M||(M={}),x=function(t){function e(e){return t.call(this,e)||this}return F(e,t),e.prototype.withAccessToken=function(){return this.useRefreshToken=!1,this},e.prototype.withRefreshToken=function(){return this.useRefreshToken=!0,this},e.prototype.withShouldRefreshOnFailure=function(t){return this.shouldRefreshOnFailure=t,this},e.prototype.build=function(){return this.useRefreshToken&&(this.shouldRefreshOnFailure=!1),new L(t.prototype.build.call(this),this.useRefreshToken,this.shouldRefreshOnFailure)},e}(C.Builder),L.Builder=x;var j=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),q=function(t){function e(e,n){var r=this;return(r=e instanceof M?t.call(this,e,e.useRefreshToken,e.shouldRefreshOnFailure)||this:t.call(this,e)||this).document=n,r}return j(e,t),Object.defineProperty(e.prototype,"builder",{get:function(){return new e.Builder(this)},enumerable:!0,configurable:!0}),e}(M);!function(t){var e=function(e){function n(t){var n=e.call(this,t)||this;return void 0!==t&&(n.document=t.document,n.useRefreshToken=t.useRefreshToken),n}return j(n,e),n.prototype.withDocument=function(t){return this.document=t,this},n.prototype.withAccessToken=function(){return this.useRefreshToken=!1,this},n.prototype.build=function(){if(void 0===this.document||!(this.document instanceof Object))throw new Error("document must be set: "+this.document);return void 0===this.headers&&this.withHeaders({}),this.headers[S.CONTENT_TYPE]=P.APPLICATION_JSON,this.withBody(d.a.stringify(this.document,{relaxed:!1})),new t(e.prototype.build.call(this),this.document)},n}(M.Builder);t.Builder=e}(q||(q={}));var V,B,W=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),K=function(t){function e(e,n){var r=t.call(this,e.method,e.path,e.headers,e.startedAt,e.body)||this;return r.document=n,r}return W(e,t),Object.defineProperty(e.prototype,"builder",{get:function(){return new e.Builder(this)},enumerable:!0,configurable:!0}),e}(C);!function(t){var e=function(e){function n(t){var n=e.call(this,t)||this;return void 0!==t&&(n.document=t.document),n}return W(n,e),n.prototype.withDocument=function(t){return this.document=t,this},n.prototype.build=function(){if(void 0===this.document||!(this.document instanceof Object))throw new Error("document must be set");return void 0===this.headers&&this.withHeaders({}),this.headers[S.CONTENT_TYPE]=P.APPLICATION_JSON,this.withBody(d.a.stringify(this.document,{relaxed:!1})),new t(e.prototype.build.call(this),this.document)},n}(C.Builder);t.Builder=e}(K||(K={})),function(t){t[t.LoggedOutDuringRequest=0]="LoggedOutDuringRequest",t[t.MustAuthenticateFirst=1]="MustAuthenticateFirst",t[t.UserNoLongerValid=2]="UserNoLongerValid",t[t.UserNotFound=3]="UserNotFound",t[t.UserNotLoggedIn=4]="UserNotLoggedIn",t[t.CouldNotLoadPersistedAuthInfo=5]="CouldNotLoadPersistedAuthInfo",t[t.CouldNotPersistAuthInfo=6]="CouldNotPersistAuthInfo",t[t.StreamingNotSupported=7]="StreamingNotSupported",t[t.StreamClosed=8]="StreamClosed",t[t.UnexpectedArguments=9]="UnexpectedArguments"}(B||(B={}));var G,H=((V={})[B.LoggedOutDuringRequest]="logged out while making a request to Stitch",V[B.MustAuthenticateFirst]="method called requires being authenticated",V[B.UserNoLongerValid]="user instance being accessed is no longer valid; please get a new user with auth.getUser()",V[B.UserNotFound]="user not found in list of users",V[B.UserNotLoggedIn]="cannot make the active user a logged out user; please use loginWithCredential() to switch to this user",V[B.CouldNotLoadPersistedAuthInfo]="failed to load stored auth information for Stitch",V[B.CouldNotPersistAuthInfo]="failed to save auth information for Stitch",V[B.StreamingNotSupported]="streaming not supported in this SDK",V[B.StreamClosed]="stream is closed",V[B.UnexpectedArguments]="function does not accept arguments",V),Y=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),J=function(t){function e(e){var n=this,r="("+B[e]+"): "+H[e];return(n=t.call(this,r)||this).errorCode=e,n.errorCodeName=B[e],n}return Y(e,t),e}(m),z=function(){function t(t,e){this.eventName=t,this.data=e}return t.MESSAGE_EVENT="message",t}(),Z=function(){function t(e,n,r){this.eventName=e,n=n||"";for(var o=[],i=0;i<n.length;i++){var s=n[i];switch(s){case"%":if(i+2>=n.length)break;var u=void 0;switch(n.substring(i+1,i+3)){case"25":u=!0,o.push("%");break;case"0A":u=!0,o.push("\n");break;case"0D":u=!0,o.push("\r");break;default:u=!1}if(u){i+=2;continue}}o.push(s)}var a=o.join("");switch(this.eventName){case t.ERROR_EVENT_NAME:var c=void 0,h=void 0;try{var f=d.a.parse(a,{strict:!1});c=f[G.Error],h=I(f[G.ErrorCode])}catch(p){c=a,h=E.Unknown}this.error=new N(c,h);break;case z.MESSAGE_EVENT:this.data=d.a.parse(a,{strict:!1}),r&&(this.data=r.decode(this.data))}}return t.fromEvent=function(e,n){return new t(e.eventName,e.data,n)},t.ERROR_EVENT_NAME="error",t}();!function(t){t.Error="error",t.ErrorCode="error_code"}(G||(G={}));var X=function(){function t(t,e){this.eventStream=t,this.decoder=e,this.listeners=[]}return t.prototype.next=function(){var t=this;return this.eventStream.nextEvent().then((function(e){var n=Z.fromEvent(e,t.decoder);if(n.eventName===Z.ERROR_EVENT_NAME)throw n.error;return n.eventName===z.MESSAGE_EVENT?n.data:t.next()}))},t.prototype.onNext=function(t){var e=this,n={onEvent:function(n){var r=Z.fromEvent(n,e.decoder);r.eventName===z.MESSAGE_EVENT&&t(r.data)}};this.eventStream.addListener(n)},t.prototype.onError=function(t){var e=this,n={onEvent:function(n){var r=Z.fromEvent(n,e.decoder);r.eventName===Z.ERROR_EVENT_NAME&&t(r.error)}};this.eventStream.addListener(n)},t.prototype.addListener=function(t){var e=this,n={onEvent:function(n){var r=Z.fromEvent(n,e.decoder);r.eventName===Z.ERROR_EVENT_NAME?t.onError&&t.onError(r.error):t.onNext&&t.onNext(r.data)}};this.listeners.push([t,n]),this.eventStream.addListener(n)},t.prototype.removeListener=function(t){for(var e=-1,n=0;n<this.listeners.length;n++)if(this.listeners[n][0]===t){e=n;break}if(-1!==e){var r=this.listeners[e][1];this.listeners.splice(e,1),this.eventStream.removeListener(r)}},t.prototype.isOpen=function(){return this.eventStream.isOpen()},t.prototype.close=function(){this.eventStream.close()},t}(),Q=function(){function t(t,e,n){void 0===e&&(e={}),void 0===n&&(n=[]),this.userType=t,this.data=e,this.identities=n}return t.empty=function(){return new t},Object.defineProperty(t.prototype,"name",{get:function(){return this.data.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"email",{get:function(){return this.data.email},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pictureUrl",{get:function(){return this.data.picture},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstName",{get:function(){return this.data.first_name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastName",{get:function(){return this.data.last_name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gender",{get:function(){return this.data.gender},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"birthday",{get:function(){return this.data.birthday},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minAge",{get:function(){var t=this.data.min_age;if(void 0!==t)return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxAge",{get:function(){var t=this.data.max_age;if(void 0!==t)return t},enumerable:!0,configurable:!0}),t}(),$=function(){function t(t,e,n,r,o,i,s){this.id=t,this.loggedInProviderType=e,this.loggedInProviderName=n,this.profile=void 0===i?Q.empty():i,this.isLoggedIn=r,this.lastAuthActivity=o,this.customData=void 0===s?{}:s}return Object.defineProperty(t.prototype,"userType",{get:function(){return this.profile.userType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"identities",{get:function(){return this.profile.identities},enumerable:!0,configurable:!0}),t.prototype.equals=function(t){return this.id===t.id&&JSON.stringify(this.identities)===JSON.stringify(t.identities)&&this.isLoggedIn===t.isLoggedIn&&this.loggedInProviderName===t.loggedInProviderName&&this.loggedInProviderType===t.loggedInProviderType&&JSON.stringify(this.profile)===JSON.stringify(t.profile)},t}(),tt=function(){function t(){}return t.TYPE="anon-user",t.DEFAULT_NAME="anon-user",t}(),et=function(t,e,n,r){this.authInfo=t,this.providerType=e,this.providerName=n,this.asLink=r},nt=n("H7XF");function rt(t){var e,n=t.length%4;0!=n?e=t+"=".repeat(4-n):e=t;var r=Object(nt.toByteArray)(e);return function(t,e,n){var r="",o="";n=Math.min(t.length,n||1/0);for(var i=e=e||0;i<n;i++)t[i]<=127?(r+=st(o)+String.fromCharCode(t[i]),o=""):o+="%"+t[i].toString(16);return r+st(o)}(r,0,r.length)}function ot(t){var e;return"undefined"==typeof Uint8Array&&(e=it(t)),e=new Uint8Array(it(t)),Object(nt.fromByteArray)(e)}function it(t){for(var e,n=1/0,r=t.length,o=null,i=[],s=0;s<r;s++){if((e=t.charCodeAt(s))>55295&&e<57344){if(!o){if(e>56319){(n-=3)>-1&&i.push(239,191,189);continue}if(s+1===r){(n-=3)>-1&&i.push(239,191,189);continue}o=e;continue}if(e<56320){(n-=3)>-1&&i.push(239,191,189),o=e;continue}e=o-55296<<10|e-56320|65536,o=null}else o&&((n-=3)>-1&&i.push(239,191,189),o=null);if(e<128){if((n-=1)<0)break;i.push(e)}else if(e<2048){if((n-=2)<0)break;i.push(e>>6|192,63&e|128)}else if(e<65536){if((n-=3)<0)break;i.push(e>>12|224,e>>6&63|128,63&e|128)}else{if(!(e<2097152))throw new Error("Invalid code point");if((n-=4)<0)break;i.push(e>>18|240,e>>12&63|128,e>>6&63|128,63&e|128)}}return i}function st(t){try{return decodeURIComponent(t)}catch(e){return String.fromCharCode(65533)}}var ut,at=function(){function t(t,e,n){this.expires=t,this.issuedAt=e,this.userData=n}return t.fromEncoded=function(e){var n=t.splitToken(e),r=JSON.parse(rt(n[1]));return new t(r.exp,r.iat,r.user_data)},t.splitToken=function(t){var e=t.split(".");if(3!==e.length)throw new Error("Malformed JWT token. The string "+t+" should have 3 parts.");return e},t}(),ct=function(){function t(t){this.auth=t}return t.prototype.shouldRefresh=function(){var t=this.auth;if(void 0===t)return!1;if(!t.isLoggedIn)return!1;var e,n=t.authInfo;if(void 0===n)return!1;if(!n.isLoggedIn)return!1;try{e=at.fromEncoded(n.accessToken)}catch(r){return console.log(r),!1}return!(Date.now()/1e3<e.expires-300)},t.prototype.run=function(){var t=this;this.shouldRefresh()?this.auth.refreshAccessToken().then((function(){t.nextTimeout=setTimeout((function(){return t.run()}),6e4)})).catch((function(){t.nextTimeout=setTimeout((function(){return t.run()}),6e4)})):this.nextTimeout=setTimeout((function(){return t.run()}),6e4)},t.prototype.stop=function(){clearTimeout(this.nextTimeout)},t}(),ht=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();!function(t){t.USER_ID="user_id",t.DEVICE_ID="device_id",t.ACCESS_TOKEN="access_token",t.REFRESH_TOKEN="refresh_token"}(ut||(ut={}));var dt,ft=function(t){function e(e,n,r,o){return t.call(this,e,n,r,o)||this}return ht(e,t),e.fromJSON=function(t){return new e(t[ut.USER_ID],t[ut.DEVICE_ID],t[ut.ACCESS_TOKEN],t[ut.REFRESH_TOKEN])},e.prototype.toJSON=function(){var t;return(t={})[ut.USER_ID]=this.userId,t[ut.DEVICE_ID]=this.deviceId,t[ut.ACCESS_TOKEN]=this.accessToken,t[ut.REFRESH_TOKEN]=this.refreshToken,t},e}(p),pt=function(){function t(){}return t.keyPresent=function(t,e){if(void 0===e[t])throw new Error("expected "+t+" to be present")},t}(),lt=function(t,e){this.id=t,this.providerType=e},vt=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();!function(t){t.ID="id",t.PROVIDER_TYPE="provider_type"}(dt||(dt={}));var yt,gt=function(t){function e(e,n){return t.call(this,e,n)||this}return vt(e,t),e.fromJSON=function(t){return new e(t[dt.ID],t[dt.PROVIDER_TYPE])},e.prototype.toJSON=function(){var t;return(t={})[dt.ID]=this.id,t[dt.PROVIDER_TYPE]=this.providerType,t},e}(lt),mt=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();!function(t){t.DATA="data",t.USER_TYPE="type",t.IDENTITIES="identities"}(yt||(yt={}));var Et,At=function(t){function e(e,n,r){return t.call(this,e,n,r)||this}return mt(e,t),e.fromJSON=function(t){return pt.keyPresent(yt.USER_TYPE,t),pt.keyPresent(yt.DATA,t),pt.keyPresent(yt.IDENTITIES,t),new e(t[yt.USER_TYPE],t[yt.DATA],t[yt.IDENTITIES].map(gt.fromJSON))},e.prototype.toJSON=function(){var t;return(t={})[yt.DATA]=this.data,t[yt.USER_TYPE]=this.userType,t[yt.IDENTITIES]=this.identities,t},e}(Q),wt=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();!function(t){t.ID="id",t.PROVIDER_TYPE="provider_type"}(Et||(Et={}));var Rt,bt=function(t){function e(e,n){return t.call(this,e,n)||this}return wt(e,t),e.decode=function(t){return new e(t[Et.ID],t[Et.PROVIDER_TYPE])},e.prototype.encode=function(){var t;return(t={})[Et.ID]=this.id,t[Et.PROVIDER_TYPE]=this.providerType,t},e}(lt),It=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();!function(t){t.DATA="data",t.USER_TYPE="type",t.IDENTITIES="identities"}(Rt||(Rt={}));var Ot,_t=function(t){function e(e,n,r){var o=t.call(this,e,n,r)||this;return o.userType=e,o.data=n,o.identities=r,o}return It(e,t),e.decode=function(t){return t?new e(t[Rt.USER_TYPE],t[Rt.DATA],t[Rt.IDENTITIES].map((function(t){return bt.decode(t)}))):void 0},e.prototype.encode=function(){var t;return(t={})[Rt.DATA]=this.data,t[Rt.USER_TYPE]=this.userType,t[Rt.IDENTITIES]=this.identities.map((function(t){return t.encode()})),t},e}(Q),Tt=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function Nt(t,e){if(t.isEmpty)e.remove(Ut.ACTIVE_USER_STORAGE_NAME);else{var n=new Ut(t.userId,t.deviceId,t.accessToken,t.refreshToken,t.loggedInProviderType,t.loggedInProviderName,t.lastAuthActivity,t.userProfile?new _t(t.userProfile.userType,t.userProfile.data,t.userProfile.identities.map((function(t){return new bt(t.id,t.providerType)}))):void 0);e.set(Ut.ACTIVE_USER_STORAGE_NAME,JSON.stringify(n.encode()))}}function Pt(t,e){var n=[];t.forEach((function(t,e){var r=new Ut(e,t.deviceId,t.accessToken,t.refreshToken,t.loggedInProviderType,t.loggedInProviderName,t.lastAuthActivity,t.userProfile?new _t(t.userProfile.userType,t.userProfile.data,t.userProfile.identities.map((function(t){return new bt(t.id,t.providerType)}))):void 0);n.push(r.encode())})),e.set(Ut.ALL_USERS_STORAGE_NAME,JSON.stringify(n))}!function(t){t.USER_ID="user_id",t.DEVICE_ID="device_id",t.ACCESS_TOKEN="access_token",t.REFRESH_TOKEN="refresh_token",t.LAST_AUTH_ACTIVITY="last_auth_activity",t.LOGGED_IN_PROVIDER_TYPE="logged_in_provider_type",t.LOGGED_IN_PROVIDER_NAME="logged_in_provider_name",t.USER_PROFILE="user_profile"}(Ot||(Ot={}));var St,Ut=function(t){function e(e,n,r,o,i,s,u,a){var c=t.call(this,e,n,r,o,i,s,u,a)||this;return c.userProfile=a,c}return Tt(e,t),e.decode=function(t){var n=t[Ot.USER_ID],r=t[Ot.DEVICE_ID],o=t[Ot.ACCESS_TOKEN],i=t[Ot.REFRESH_TOKEN],s=t[Ot.LOGGED_IN_PROVIDER_TYPE],u=t[Ot.LOGGED_IN_PROVIDER_NAME],a=t[Ot.USER_PROFILE],c=t[Ot.LAST_AUTH_ACTIVITY];return new e(n,r,o,i,s,u,new Date(c),_t.decode(a))},e.prototype.encode=function(){var t={};return t[Ot.USER_ID]=this.userId,t[Ot.ACCESS_TOKEN]=this.accessToken,t[Ot.REFRESH_TOKEN]=this.refreshToken,t[Ot.DEVICE_ID]=this.deviceId,t[Ot.LOGGED_IN_PROVIDER_NAME]=this.loggedInProviderName,t[Ot.LOGGED_IN_PROVIDER_TYPE]=this.loggedInProviderType,t[Ot.LAST_AUTH_ACTIVITY]=this.lastAuthActivity?this.lastAuthActivity.getTime():void 0,t[Ot.USER_PROFILE]=this.userProfile?this.userProfile.encode():void 0,t},e.ACTIVE_USER_STORAGE_NAME="auth_info",e.ALL_USERS_STORAGE_NAME="all_auth_infos",e}(p),kt=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}},Dt=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(u){o={error:u}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},Ct=function(){function t(t,e,n,r){var o,i;void 0===r&&(r=!0),this.requestClient=t,this.authRoutes=e,this.storage=n;try{o=function(t){var e=t.get(Ut.ALL_USERS_STORAGE_NAME);if(!e)return new Map;var n=JSON.parse(e);if(!Array.isArray(n))throw new J(B.CouldNotLoadPersistedAuthInfo);var r=new Map;return n.forEach((function(t){var e=Ut.decode(t);r.set(e.userId,e)})),r}(n)}catch(s){throw new J(B.CouldNotLoadPersistedAuthInfo)}this.allUsersAuthInfo=o;try{i=function(t){var e=t.get(Ut.ACTIVE_USER_STORAGE_NAME);if(e)return Ut.decode(JSON.parse(e))}(n)}catch(s){throw new J(B.CouldNotLoadPersistedAuthInfo)}this.activeUserAuthInfo=void 0===i?p.empty():i,this.activeUserAuthInfo.hasUser&&(this.currentUser=this.prepUser(this.activeUserAuthInfo)),r&&(this.accessTokenRefresher=new ct(this),this.accessTokenRefresher.run())}return Object.defineProperty(t.prototype,"authInfo",{get:function(){return this.activeUserAuthInfo},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoggedIn",{get:function(){return void 0!==this.currentUser&&this.currentUser.isLoggedIn},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"user",{get:function(){return this.currentUser},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasDeviceId",{get:function(){return void 0!==this.activeUserAuthInfo.deviceId&&""!==this.activeUserAuthInfo.deviceId&&"000000000000000000000000"!==this.activeUserAuthInfo.deviceId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"deviceId",{get:function(){if(this.hasDeviceId)return this.activeUserAuthInfo.deviceId},enumerable:!0,configurable:!0}),t.prototype.listUsers=function(){var t=this,e=[];return this.allUsersAuthInfo.forEach((function(n){e.push(t.prepUser(n))})),e},t.prototype.doAuthenticatedRequest=function(t,e){var n=this;try{return this.requestClient.doRequest(this.prepareAuthRequest(t,e||this.activeUserAuthInfo)).catch((function(e){return n.handleAuthFailure(e,t)}))}catch(r){return Promise.reject(r)}},t.prototype.doAuthenticatedRequestWithDecoder=function(t,e){return this.doAuthenticatedRequest(t).then((function(t){var n=d.a.parse(t.body,{strict:!1});return e?e.decode(n):n})).catch((function(t){throw U(t)}))},t.prototype.openAuthenticatedEventStream=function(t,e){var n=this;if(void 0===e&&(e=!0),!this.isLoggedIn)throw new J(B.MustAuthenticateFirst);var r=t.useRefreshToken?this.activeUserAuthInfo.refreshToken:this.activeUserAuthInfo.accessToken;return this.requestClient.doStreamRequest(t.builder.withPath(t.path+"&stitch_at="+r).build(),e,(function(){return n.openAuthenticatedEventStream(t,!1)})).catch((function(r){return n.handleAuthFailureForEventStream(r,t,e)}))},t.prototype.openAuthenticatedStreamWithDecoder=function(t,e){return this.openAuthenticatedEventStream(t).then((function(t){return new X(t,e)}))},t.prototype.refreshAccessToken=function(){var t=this,e=(new M.Builder).withRefreshToken().withPath(this.authRoutes.sessionRoute).withMethod(D.POST);return this.doAuthenticatedRequest(e.build()).then((function(e){try{var n=ft.fromJSON(JSON.parse(e.body));if(t.activeUserAuthInfo=t.activeUserAuthInfo.merge(n),n.accessToken&&t.user instanceof $){var r=at.fromEncoded(n.accessToken).userData;t.user.customData=void 0===r?{}:r}}catch(o){throw new R(o,g.DECODING_ERROR)}try{Nt(t.activeUserAuthInfo,t.storage),t.allUsersAuthInfo.set(t.activeUserAuthInfo.userId,t.activeUserAuthInfo),Pt(t.allUsersAuthInfo,t.storage)}catch(o){throw new J(B.CouldNotPersistAuthInfo)}}))},t.prototype.switchToUserWithId=function(t){var e=this.allUsersAuthInfo.get(t);if(void 0===e)throw new J(B.UserNotFound);if(!e.isLoggedIn)throw new J(B.UserNotLoggedIn);this.activeUserAuthInfo.hasUser&&this.allUsersAuthInfo.set(this.activeUserAuthInfo.userId,this.activeUserAuthInfo.withNewAuthActivityTime());var n=e.withNewAuthActivityTime();this.allUsersAuthInfo.set(t,n),Nt(n,this.storage),this.activeUserAuthInfo=n;var o=this.currentUser;return this.currentUser=this.prepUser(n),this.onAuthEvent(),this.dispatchAuthEvent({currentActiveUser:this.currentUser,kind:r.ActiveUserChanged,previousActiveUser:o}),this.currentUser},t.prototype.loginWithCredentialInternal=function(t){var e,n,o=this;if(t instanceof et)return this.processLogin(t,t.authInfo,t.asLink).then((function(t){return o.dispatchAuthEvent({kind:r.UserLoggedIn,loggedInUser:t}),t}));if(t.providerCapabilities.reusesExistingSession)try{for(var i=kt(this.allUsersAuthInfo),s=i.next();!s.done;s=i.next()){var u=Dt(s.value,2),a=u[0],c=u[1];if(c.loggedInProviderType===t.providerType){if(c.isLoggedIn)try{return Promise.resolve(this.switchToUserWithId(a))}catch(h){return Promise.reject(h)}void 0!==c.userId&&this.removeUserWithIdInternal(c.userId)}}}catch(d){e={error:d}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return this.doLogin(t,!1)},t.prototype.linkUserWithCredentialInternal=function(t,e){return void 0!==this.currentUser&&t.id!==this.currentUser.id?Promise.reject(new J(B.UserNoLongerValid)):this.doLogin(e,!0)},t.prototype.logoutInternal=function(){return this.isLoggedIn&&this.currentUser?this.logoutUserWithIdInternal(this.currentUser.id):Promise.resolve()},t.prototype.logoutUserWithIdInternal=function(t){var e=this,n=this.allUsersAuthInfo.get(t);if(void 0===n)return Promise.reject(new J(B.UserNotFound));if(!n.isLoggedIn)return Promise.resolve();var r=function(){e.clearUserAuthTokens(n.userId),n.loggedInProviderType===tt.TYPE&&e.removeUserWithIdInternal(n.userId)};return this.doLogout(n).then((function(){r()})).catch((function(){r()}))},t.prototype.removeUserInternal=function(){return this.isLoggedIn&&void 0!==this.currentUser?this.removeUserWithIdInternal(this.currentUser.id):Promise.resolve()},t.prototype.removeUserWithIdInternal=function(t){var e=this,n=this.allUsersAuthInfo.get(t);if(void 0===n)return Promise.reject(new J(B.UserNotFound));var o=function(){e.clearUserAuthTokens(n.userId),e.allUsersAuthInfo.delete(t),Pt(e.allUsersAuthInfo,e.storage);var o=e.prepUser(n.loggedOut());e.onAuthEvent(),e.dispatchAuthEvent({kind:r.UserRemoved,removedUser:o})};return n.isLoggedIn?this.doLogout(n).then((function(){o()})).catch((function(t){o()})):(o(),Promise.resolve())},t.prototype.close=function(){this.accessTokenRefresher&&this.accessTokenRefresher.stop()},t.prototype.prepareAuthRequest=function(t,e){if(!e.isLoggedIn)throw new J(B.MustAuthenticateFirst);var n=t.builder,r=n.headers||{};return t.useRefreshToken?r[S.AUTHORIZATION]=S.getAuthorizationBearer(e.refreshToken):r[S.AUTHORIZATION]=S.getAuthorizationBearer(e.accessToken),n.withHeaders(r),n.build()},t.prototype.handleAuthFailureForEventStream=function(t,e,n){var r=this;if(void 0===n&&(n=!0),!(t instanceof N)||t.errorCode!==E.InvalidSession)throw t;if(e.useRefreshToken||!e.shouldRefreshOnFailure)throw this.clearActiveUserAuth(),t;return this.tryRefreshAccessToken(e.startedAt).then((function(){return r.openAuthenticatedEventStream(e.builder.withShouldRefreshOnFailure(!1).build(),n)}))},t.prototype.handleAuthFailure=function(t,e){var n=this;if(!(t instanceof N)||t.errorCode!==E.InvalidSession)throw t;if(e.useRefreshToken||!e.shouldRefreshOnFailure)throw this.clearActiveUserAuth(),t;return this.tryRefreshAccessToken(e.startedAt).then((function(){return n.doAuthenticatedRequest(e.builder.withShouldRefreshOnFailure(!1).build())}))},t.prototype.tryRefreshAccessToken=function(t){if(!this.isLoggedIn)throw new J(B.LoggedOutDuringRequest);try{if(at.fromEncoded(this.activeUserAuthInfo.accessToken).issuedAt>=t)return Promise.resolve()}catch(e){}return this.refreshAccessToken()},t.prototype.prepUser=function(t){return this.userFactory.makeUser(t.userId,t.loggedInProviderType,t.loggedInProviderName,t.isLoggedIn,t.lastAuthActivity,t.userProfile)},t.prototype.attachAuthOptions=function(t){var e={};e.device=this.deviceInfo,t.options=e},t.prototype.doLogin=function(t,e){var n=this,o=this.currentUser;return this.doLoginRequest(t,e).then((function(r){return n.processLoginResponse(t,r,e)})).then((function(t){return n.onAuthEvent(),e?n.dispatchAuthEvent({kind:r.UserLinked,linkedUser:t}):(n.dispatchAuthEvent({kind:r.UserLoggedIn,loggedInUser:t}),n.dispatchAuthEvent({currentActiveUser:t,kind:r.ActiveUserChanged,previousActiveUser:o})),t}))},t.prototype.doLoginRequest=function(t,e){var n=new K.Builder;n.withMethod(D.POST),e?n.withPath(this.authRoutes.getAuthProviderLinkRoute(t.providerName)):n.withPath(this.authRoutes.getAuthProviderLoginRoute(t.providerName));var r=t.material;if(this.attachAuthOptions(r),n.withDocument(r),!e)return this.requestClient.doRequest(n.build());var o=new q(n.build(),n.document);return this.doAuthenticatedRequest(o)},t.prototype.processLogin=function(t,e,n){var o=this,i=this.activeUserAuthInfo,s=this.currentUser;return e=this.activeUserAuthInfo.merge(new p(e.userId,e.deviceId,e.accessToken,e.refreshToken,t.providerType,t.providerName,void 0,void 0)),this.activeUserAuthInfo=e,this.currentUser=this.userFactory.makeUser(this.activeUserAuthInfo.userId,t.providerType,t.providerName,this.activeUserAuthInfo.isLoggedIn,new Date,void 0,at.fromEncoded(e.accessToken).userData),this.doGetUserProfile().then((function(n){i.hasUser&&o.allUsersAuthInfo.set(i.userId,i.withNewAuthActivityTime()),e=e.merge(new p(e.userId,e.deviceId,e.accessToken,e.refreshToken,t.providerType,t.providerName,new Date,n));var u=!o.allUsersAuthInfo.has(e.userId);try{Nt(e,o.storage),o.allUsersAuthInfo.set(e.userId,e),Pt(o.allUsersAuthInfo,o.storage)}catch(a){throw o.activeUserAuthInfo=i,o.currentUser=s,e.userId!==i.userId&&e.userId&&o.allUsersAuthInfo.delete(e.userId),new J(B.CouldNotPersistAuthInfo)}return o.activeUserAuthInfo=e,o.currentUser=o.userFactory.makeUser(o.activeUserAuthInfo.userId,t.providerType,t.providerName,o.activeUserAuthInfo.isLoggedIn,o.activeUserAuthInfo.lastAuthActivity,n,at.fromEncoded(e.accessToken).userData),u&&(o.onAuthEvent(),o.dispatchAuthEvent({addedUser:o.currentUser,kind:r.UserAdded})),o.currentUser})).catch((function(t){if(t instanceof J)throw t;if(n||i.hasUser){var e=o.activeUserAuthInfo;o.activeUserAuthInfo=i,o.currentUser=s,n&&(o.activeUserAuthInfo=o.activeUserAuthInfo.withAuthProvider(e.loggedInProviderType,e.loggedInProviderName))}else o.clearActiveUserAuth();throw t}))},t.prototype.processLoginResponse=function(t,e,n){try{if(!e)throw new N("the login response could not be processed for credential: "+t+";response was undefined");if(!e.body)throw new N("response with status code "+e.statusCode+" has empty body");return this.processLogin(t,ft.fromJSON(JSON.parse(e.body)),n)}catch(r){throw new R(r,g.DECODING_ERROR)}},t.prototype.doGetUserProfile=function(){var t=new M.Builder;return t.withMethod(D.GET).withPath(this.authRoutes.profileRoute),this.doAuthenticatedRequest(t.build()).then((function(t){return At.fromJSON(JSON.parse(t.body))})).catch((function(t){throw t instanceof m?t:new R(t,g.DECODING_ERROR)}))},t.prototype.doLogout=function(t){var e=new M.Builder;return e.withRefreshToken().withPath(this.authRoutes.sessionRoute).withMethod(D.DELETE),this.doAuthenticatedRequest(e.build(),t).then((function(){}))},t.prototype.clearActiveUserAuth=function(){this.isLoggedIn&&this.clearUserAuthTokens(this.activeUserAuthInfo.userId)},t.prototype.clearUserAuthTokens=function(t){var e=this.allUsersAuthInfo.get(t);if(void 0===e){if(this.activeUserAuthInfo.userId!==t)throw new J(B.UserNotFound)}else if(!e.isLoggedIn)return;try{var n=void 0;if(e){var o=e.loggedOut();this.allUsersAuthInfo.set(t,o),Pt(this.allUsersAuthInfo,this.storage),n=this.userFactory.makeUser(o.userId,o.loggedInProviderType,o.loggedInProviderName,o.isLoggedIn,o.lastAuthActivity,o.userProfile)}var i=!1;this.activeUserAuthInfo.hasUser&&this.activeUserAuthInfo.userId===t&&(i=!0,this.activeUserAuthInfo=this.activeUserAuthInfo.withClearedUser(),this.currentUser=void 0,Nt(this.activeUserAuthInfo,this.storage)),n&&(this.onAuthEvent(),this.dispatchAuthEvent({kind:r.UserLoggedOut,loggedOutUser:n}),i&&this.dispatchAuthEvent({currentActiveUser:void 0,kind:r.ActiveUserChanged,previousActiveUser:n}))}catch(s){throw new J(B.CouldNotPersistAuthInfo)}},t}();!function(t){t.DEVICE_ID="deviceId",t.APP_ID="appId",t.APP_VERSION="appVersion",t.PLATFORM="platform",t.PLATFORM_VERSION="platformVersion",t.SDK_VERSION="sdkVersion"}(St||(St={}));var Lt,xt=St,Ft=function(t){void 0===t&&(t=!1),this.reusesExistingSession=t},Mt=function(t){void 0===t&&(t=tt.DEFAULT_NAME),this.providerType=tt.TYPE,this.material={},this.providerCapabilities=new Ft(!0),this.providerName=t};!function(){function t(){}t.TYPE="custom-token",t.DEFAULT_NAME="custom-token"}();!function(t){t.TOKEN="token"}(Lt||(Lt={}));var jt,qt=function(){function t(){}return t.TYPE="oauth2-facebook",t.DEFAULT_NAME="oauth2-facebook",t}();!function(t){t.ACCESS_TOKEN="accessToken"}(jt||(jt={}));!function(){function t(t,e){var n;void 0===e&&(e=qt.DEFAULT_NAME),this.providerType=qt.TYPE,this.providerName=e,this.accessToken=t,this.material=((n={})[jt.ACCESS_TOKEN]=this.accessToken,n)}Object.defineProperty(t.prototype,"providerCapabilities",{get:function(){return new Ft(!1)},enumerable:!0,configurable:!0})}();var Vt,Bt=function(){function t(){}return t.TYPE="custom-function",t.DEFAULT_NAME="custom-function",t}();(function(){function t(t,e){void 0===e&&(e=Bt.DEFAULT_NAME),this.providerType=Bt.TYPE,this.providerName=e,this.material=t}Object.defineProperty(t.prototype,"providerCapabilities",{get:function(){return new Ft(!1)},enumerable:!0,configurable:!0})})(),function(){function t(){}t.TYPE="oauth2-google",t.DEFAULT_NAME="oauth2-google"}();!function(t){t.AUTH_CODE="authCode"}(Vt||(Vt={}));var Wt;!function(){function t(){}t.TYPE="api-key",t.DEFAULT_NAME="api-key"}();!function(t){t.KEY="key"}(Wt||(Wt={}));var Kt,Gt=function(t,e,n){this.providerName=t,this.requestClient=e,this.baseRoute=n};!function(t){t.ID="_id",t.KEY="key",t.NAME="name",t.DISABLED="disabled"}(Kt||(Kt={}));var Ht,Yt=function(){function t(t,e,n,r){this.id=d.b.ObjectID.createFromHexString(t),this.key=e,this.name=n,this.disabled=r}return t.readFromApi=function(e){var n="string"==typeof e?JSON.parse(e):e;return pt.keyPresent(Kt.ID,n),pt.keyPresent(Kt.NAME,n),pt.keyPresent(Kt.DISABLED,n),new t(n[Kt.ID],n[Kt.KEY],n[Kt.NAME],n[Kt.DISABLED])},t.prototype.toJSON=function(){var t;return(t={})[Kt.ID]=this.id,t[Kt.KEY]=this.key,t[Kt.NAME]=this.name,t[Kt.DISABLED]=this.disabled,t},t}(),Jt=function(){function t(){}return t.TYPE="api-key",t.DEFAULT_NAME="api-key",t}(),zt=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();!function(t){t.NAME="name"}(Ht||(Ht={}));var Zt,Xt=function(t){function e(e,n){var r=n.baseAuthRoute+"/api_keys",o=Jt.DEFAULT_NAME;return t.call(this,o,e,r)||this}return zt(e,t),e.prototype.createApiKey=function(t){var e,n=new q.Builder;return n.withMethod(D.POST).withPath(this.baseRoute).withDocument((e={},e[Ht.NAME]=t,e)).withRefreshToken(),this.requestClient.doAuthenticatedRequest(n.build()).then((function(t){return Yt.readFromApi(t.body)})).catch((function(t){throw U(t)}))},e.prototype.fetchApiKey=function(t){var e=new M.Builder;return e.withMethod(D.GET).withPath(this.getApiKeyRoute(t.toHexString())),e.withRefreshToken(),this.requestClient.doAuthenticatedRequest(e.build()).then((function(t){return Yt.readFromApi(t.body)})).catch((function(t){throw U(t)}))},e.prototype.fetchApiKeys=function(){var t=new M.Builder;return t.withMethod(D.GET).withPath(this.baseRoute),t.withRefreshToken(),this.requestClient.doAuthenticatedRequest(t.build()).then((function(t){var e=JSON.parse(t.body);if(Array.isArray(e))return e.map((function(t){return Yt.readFromApi(t)}));throw new R(new Error("unexpected non-array response from server"),g.DECODING_ERROR)})).catch((function(t){throw U(t)}))},e.prototype.deleteApiKey=function(t){var e=new M.Builder;return e.withMethod(D.DELETE).withPath(this.getApiKeyRoute(t.toHexString())),e.withRefreshToken(),this.requestClient.doAuthenticatedRequest(e.build()).then((function(){}))},e.prototype.enableApiKey=function(t){var e=new M.Builder;return e.withMethod(D.PUT).withPath(this.getApiKeyEnableRoute(t.toHexString())),e.withRefreshToken(),this.requestClient.doAuthenticatedRequest(e.build()).then((function(){}))},e.prototype.disableApiKey=function(t){var e=new M.Builder;return e.withMethod(D.PUT).withPath(this.getApiKeyDisableRoute(t.toHexString())),e.withRefreshToken(),this.requestClient.doAuthenticatedRequest(e.build()).then((function(){}))},e.prototype.getApiKeyRoute=function(t){return this.baseRoute+"/"+t},e.prototype.getApiKeyEnableRoute=function(t){return this.getApiKeyRoute(t)+"/enable"},e.prototype.getApiKeyDisableRoute=function(t){return this.getApiKeyRoute(t)+"/disable"},e}(Gt);!function(t){t.KEY="key"}(Zt||(Zt={}));var Qt,$t,te=function(){function t(){}return t.TYPE="local-userpass",t.DEFAULT_NAME="local-userpass",t}(),ee=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();!function(t){t.EMAIL="email",t.PASSWORD="password"}(Qt||(Qt={})),function(t){t.EMAIL="email",t.PASSWORD="password",t.TOKEN="token",t.TOKEN_ID="tokenId",t.ARGS="arguments"}($t||($t={}));var ne,re=function(t){function e(e,n,r){void 0===e&&(e=te.DEFAULT_NAME);var o=r.getAuthProviderRoute(e);return t.call(this,e,n,o)||this}return ee(e,t),e.prototype.registerWithEmailInternal=function(t,e){var n,r=new K.Builder;return r.withMethod(D.POST).withPath(this.getRegisterWithEmailRoute()),r.withDocument(((n={})[Qt.EMAIL]=t,n[Qt.PASSWORD]=e,n)),this.requestClient.doRequest(r.build()).then((function(){}))},e.prototype.confirmUserInternal=function(t,e){var n,r=new K.Builder;return r.withMethod(D.POST).withPath(this.getConfirmUserRoute()),r.withDocument(((n={})[$t.TOKEN]=t,n[$t.TOKEN_ID]=e,n)),this.requestClient.doRequest(r.build()).then((function(){}))},e.prototype.resendConfirmationEmailInternal=function(t){var e,n=new K.Builder;return n.withMethod(D.POST).withPath(this.getResendConfirmationEmailRoute()),n.withDocument(((e={})[$t.EMAIL]=t,e)),this.requestClient.doRequest(n.build()).then((function(){}))},e.prototype.resetPasswordInternal=function(t,e,n){var r,o=new K.Builder;return o.withMethod(D.POST).withPath(this.getResetPasswordRoute()),o.withDocument(((r={})[$t.TOKEN]=t,r[$t.TOKEN_ID]=e,r[$t.PASSWORD]=n,r)),this.requestClient.doRequest(o.build()).then((function(){}))},e.prototype.sendResetPasswordEmailInternal=function(t){var e,n=new K.Builder;return n.withMethod(D.POST).withPath(this.getSendResetPasswordEmailRoute()),n.withDocument(((e={})[$t.EMAIL]=t,e)),this.requestClient.doRequest(n.build()).then((function(){}))},e.prototype.callResetPasswordFunctionInternal=function(t,e,n){var r,o=new K.Builder;return o.withMethod(D.POST).withPath(this.getCallResetPasswordFunctionRoute()),o.withDocument(((r={})[$t.EMAIL]=t,r[$t.PASSWORD]=e,r[$t.ARGS]=n,r)),this.requestClient.doRequest(o.build()).then((function(){}))},e.prototype.getRegisterWithEmailRoute=function(){return this.getExtensionRoute("register")},e.prototype.getConfirmUserRoute=function(){return this.getExtensionRoute("confirm")},e.prototype.getResendConfirmationEmailRoute=function(){return this.getExtensionRoute("confirm/send")},e.prototype.getResetPasswordRoute=function(){return this.getExtensionRoute("reset")},e.prototype.getSendResetPasswordEmailRoute=function(){return this.getExtensionRoute("reset/send")},e.prototype.getCallResetPasswordFunctionRoute=function(){return this.getExtensionRoute("reset/call")},e.prototype.getExtensionRoute=function(t){return this.baseRoute+"/"+t},e}(Gt);!function(t){t.USERNAME="username",t.PASSWORD="password"}(ne||(ne={}));var oe;!function(t){t.Normal="normal",t.Server="server",t.Unknown="unknown"}(oe||(oe={}));!function(){function t(t){this.suiteName=t,this.storage={}}t.prototype.get=function(t){return this.storage[this.suiteName+"."+t]},t.prototype.set=function(t,e){this.storage[this.suiteName+"."+t]=e},t.prototype.remove=function(t){delete this.storage[this.suiteName+"."+t]}}();var ie,se=function(){};!function(t){t[t.AUTH_EVENT=0]="AUTH_EVENT"}(ie||(ie={}));var ue=function(){function t(t,e,n){this.serviceField="service",this.argumentsField="arguments",this.requestClient=t,this.serviceRoutes=e,this.serviceName=n,this.serviceBinders=[],this.allocatedStreams=[]}return t.prototype.callFunction=function(t,e,n){return this.requestClient.doAuthenticatedRequestWithDecoder(this.getCallServiceFunctionRequest(t,e),n)},t.prototype.streamFunction=function(t,e,n){var r=this;return this.requestClient.openAuthenticatedStreamWithDecoder(this.getStreamServiceFunctionRequest(t,e),n).then((function(t){return r.allocatedStreams.push(t),t}))},t.prototype.bind=function(t){this.serviceBinders.push(t)},t.prototype.onRebindEvent=function(t){switch(t.type){case ie.AUTH_EVENT:t.event.kind===r.ActiveUserChanged&&this.closeAllocatedStreams()}this.serviceBinders.forEach((function(e){e.onRebindEvent(t)}))},t.prototype.getStreamServiceFunctionRequest=function(t,e){var n={name:t};void 0!==this.serviceName&&(n[this.serviceField]=this.serviceName),n[this.argumentsField]=e;var r=new M.Builder;return r.withMethod(D.GET).withPath(this.serviceRoutes.functionCallRoute+"?stitch_request="+encodeURIComponent(ot(d.a.stringify(n)))),r.build()},t.prototype.getCallServiceFunctionRequest=function(t,e){var n={name:t};void 0!==this.serviceName&&(n[this.serviceField]=this.serviceName),n[this.argumentsField]=e;var r=new q.Builder;return r.withMethod(D.POST).withPath(this.serviceRoutes.functionCallRoute),r.withDocument(n),r.build()},t.prototype.closeAllocatedStreams=function(){this.allocatedStreams.forEach((function(t){t.isOpen()&&t.close()})),this.allocatedStreams=[]},t}(),ae=function(){function t(t,e){this.functionService=new ue(t,e.serviceRoutes)}return t.prototype.callFunction=function(t,e,n){return this.functionService.callFunction(t,e,n)},t}(),ce=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}},he=function(){function t(t){this.reconnecter=t,this.closed=!1,this.events=[],this.listeners=[],this.lastErr=void 0}return t.prototype.isOpen=function(){return!this.closed},t.prototype.addListener=function(t){var e=this;this.closed?setTimeout((function(){return t.onEvent(new z(Z.ERROR_EVENT_NAME,"stream closed"))}),0):void 0===this.lastErr?(this.listeners.push(t),this.poll()):setTimeout((function(){return t.onEvent(new z(Z.ERROR_EVENT_NAME,e.lastErr))}),0)},t.prototype.removeListener=function(t){var e=this.listeners.indexOf(t);-1!==e&&this.listeners.splice(e,1)},t.prototype.nextEvent=function(){var t=this;return this.closed?Promise.reject(new z(Z.ERROR_EVENT_NAME,"stream closed")):void 0!==this.lastErr?Promise.reject(new z(Z.ERROR_EVENT_NAME,this.lastErr)):new Promise((function(e,n){t.listenOnce({onEvent:function(t){e(t)}})}))},t.prototype.close=function(){this.closed||(this.closed=!0,this.afterClose())},t.prototype.reconnect=function(e){var n=this;this.reconnecter?this.reconnecter().then((function(t){n.onReconnect(t)})).catch((function(r){if(!(r instanceof m&&r instanceof R))return n.closed=!0,n.events.push(new z(Z.ERROR_EVENT_NAME,"stream closed: "+e)),void n.poll();setTimeout((function(){return n.reconnect(r)}),t.RETRY_TIMEOUT_MILLIS)})):this.closed||(this.closed=!0,this.events.push(new z(Z.ERROR_EVENT_NAME,"stream closed: "+e)),this.poll())},t.prototype.poll=function(){for(var t,e;0!==this.events.length;){var n=this.events.pop();try{for(var r=ce(this.listeners),o=r.next();!o.done;o=r.next()){var i=o.value;i.onEvent&&i.onEvent(n)}}catch(s){t={error:s}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}}},t.prototype.listenOnce=function(t){var e=this;if(this.closed)setTimeout((function(){return t.onEvent(new z(Z.ERROR_EVENT_NAME,"stream closed"))}),0);else if(void 0===this.lastErr){var n={onEvent:function(r){e.removeListener(n),t.onEvent(r)}};this.addListener(n)}else setTimeout((function(){return t.onEvent(new z(Z.ERROR_EVENT_NAME,e.lastErr))}),0)},t.RETRY_TIMEOUT_MILLIS=5e3,t}(),de=function(t,e,n,r){this.method=t,this.url=e,this.headers=n,this.body=r};!function(t){var e=function(){function e(t){t&&(this.method=t.method,this.url=t.url,this.headers=t.headers,this.body=t.body)}return e.prototype.withMethod=function(t){return this.method=t,this},e.prototype.withUrl=function(t){return this.url=t,this},e.prototype.withHeaders=function(t){return this.headers=t,this},e.prototype.withBody=function(t){return this.body=t,this},e.prototype.build=function(){if(void 0===this.method)throw new Error("must set method");if(void 0===this.url)throw new Error("must set non-empty url");return new t(this.method,this.url,void 0===this.headers?{}:this.headers,this.body)},e}();t.Builder=e}(de||(de={}));var fe=function(t,e,n){var r=this;this.statusCode=e,this.body=n,this.headers={},Object.keys(t).map((function(e,n){r.headers[e.toLocaleLowerCase()]=t[e]}))};function pe(t){return"/api/client/v2.0/app/"+t}function le(t){return pe(t)+"/functions/call"}function ve(t,e){return pe(t)+"/auth/providers/"+e}function ye(t,e){return ve(t,e)+"/login"}var ge,me=function(){function t(t){var e=this;this.baseAuthRoute="/api/client/v2.0/auth",this.sessionRoute=e.baseAuthRoute+"/session",this.profileRoute=e.baseAuthRoute+"/profile",this.clientAppId=t}return t.prototype.getAuthProviderRoute=function(t){return ve(this.clientAppId,t)},t.prototype.getAuthProviderLoginRoute=function(t){return ye(this.clientAppId,t)},t.prototype.getAuthProviderLinkRoute=function(t){return function(t,e){return ye(t,e)+"?link=true"}(this.clientAppId,t)},t.prototype.getAuthProviderExtensionRoute=function(t,e){return this.getAuthProviderRoute(t)+"/"+e},t}();!function(t){t.DEPLOYMENT_MODEL="deployment_model",t.LOCATION="location",t.HOSTNAME="hostname"}(ge||(ge={}));var Ee=function(){function t(t,e,n){this.deploymentModel=t,this.location=e,this.hostname=n}return t.fromJSON=function(e){return new t(e[ge.DEPLOYMENT_MODEL],e[ge.LOCATION],e[ge.HOSTNAME])},t.prototype.toJSON=function(){var t;return(t={})[ge.DEPLOYMENT_MODEL]=this.deploymentModel,t[ge.LOCATION]=this.location,t[ge.HOSTNAME]=this.hostname,t},t}();var Ae=function(){function t(t,e){this.baseUrl=t,this.transport=e}return t.prototype.doRequestToURL=function(t,e){return this.transport.roundTrip(this.buildRequest(t,e)).catch((function(t){throw new R(t,g.TRANSPORT_ERROR)})).then((function(t){return(e=t).statusCode>=200&&e.statusCode<300?e:k(e);var e}))},t.prototype.doStreamRequestToURL=function(t,e,n,r){return void 0===n&&(n=!0),this.transport.stream(this.buildRequest(t,e),n,r).catch((function(t){if(t instanceof m)throw t;throw new R(t,g.TRANSPORT_ERROR)}))},t.prototype.buildRequest=function(t,e){return(new de.Builder).withMethod(t.method).withUrl(""+e+t.path).withHeaders(t.headers).withBody(t.body).build()},t}(),we=function(t){this.clientAppId=t,this.functionCallRoute=le(t)},Re=function(t){this.clientAppId=t,this.authRoutes=new me(t),this.serviceRoutes=new we(t),this.appMetadataRoute=function(t){return pe(t)+"/location"}(t),this.functionCallRoute=le(t)},be=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ie=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{a(r.next(t))}catch(e){i(e)}}function u(t){try{a(r.throw(t))}catch(e){i(e)}}function a(t){t.done?o(t.value):new n((function(e){e(t.value)})).then(s,u)}a((r=r.apply(t,e||[])).next())}))},Oe=function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(u){i=[6,u],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},_e=function(t){function e(e,n,r){var o=t.call(this,n,r)||this;return o.clientAppId=e,o.routes=new Re(e),o}return be(e,t),e.prototype.doRequest=function(e){var n=this;return this.initAppMetadata().then((function(r){return t.prototype.doRequestToURL.call(n,e,r.hostname)}))},e.prototype.doStreamRequest=function(e,n,r){var o=this;return void 0===n&&(n=!0),this.initAppMetadata().then((function(i){return t.prototype.doStreamRequestToURL.call(o,e,i.hostname,n,r)}))},e.prototype.getBaseURL=function(){return Ie(this,void 0,void 0,(function(){return Oe(this,(function(t){return[2,this.initAppMetadata().then((function(t){return t.hostname}))]}))}))},e.prototype.initAppMetadata=function(){var e=this;if(this.appMetadata)return Promise.resolve(this.appMetadata);var n=(new C.Builder).withMethod(D.GET).withPath(this.routes.appMetadataRoute).build();return t.prototype.doRequestToURL.call(this,n,this.baseUrl).then((function(t){return e.appMetadata=Ee.fromJSON(d.a.parse(t.body)),e.appMetadata}))},e}(Ae),Te=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ne=(function(t){function e(e,n){return t.call(this,e,n)||this}Te(e,t),e.prototype.doRequest=function(e){return t.prototype.doRequestToURL.call(this,e,this.baseUrl)},e.prototype.doStreamRequest=function(e,n,r){return void 0===n&&(n=!0),t.prototype.doStreamRequestToURL.call(this,e,this.baseUrl,n,r)},e.prototype.getBaseURL=function(){return Promise.resolve(this.baseUrl)}}(Ae),function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),Pe=function(t){function e(e){var n=t.call(this)||this;return n.type=ie.AUTH_EVENT,n.event=e,n}return Ne(e,t),e}(se),Se=function(){function t(t,e,n,r){this.baseUrl=t,this.storage=e,this.dataDirectory=n,this.transport=r}return t.prototype.builder=function(){return new t.Builder(this)},t}();!function(t){var e=function(){function e(t){t&&(this.baseUrl=t.baseUrl,this.storage=t.storage,this.dataDirectory=t.dataDirectory,this.transport=t.transport)}return e.prototype.withBaseUrl=function(t){return this.baseUrl=t,this},e.prototype.withStorage=function(t){return this.storage=t,this},e.prototype.withDataDirectory=function(t){return this.dataDirectory=t,this},e.prototype.withTransport=function(t){return this.transport=t,this},e.prototype.build=function(){return new t(this.baseUrl,this.storage,this.dataDirectory,this.transport)},e}();t.Builder=e}(Se||(Se={}));var Ue=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ke=function(t){function e(e,n,r){var o=t.call(this,e.baseUrl,e.storage,e.dataDirectory,e.transport)||this;return o.localAppVersion=r,o.localAppName=n,o}return Ue(e,t),e.prototype.builder=function(){return new e.Builder(this)},e}(Se);!function(t){var e=function(e){function n(t){var n=e.call(this,t)||this;return t&&(n.localAppVersion=t.localAppVersion,n.localAppName=t.localAppName),n}return Ue(n,e),n.prototype.withLocalAppName=function(t){return this.localAppName=t,this},n.prototype.withLocalAppVersion=function(t){return this.localAppVersion=t,this},n.prototype.build=function(){var n=e.prototype.build.call(this);return new t(n,this.localAppName,this.localAppVersion)},n}(Se.Builder);t.Builder=e}(ke||(ke={}));var De,Ce=function(t,e,n,r){this.clientAppId=t,this.dataDirectory=e,this.localAppName=n,this.localAppVersion=r},Le=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),xe=function(t){function e(e,n){return t.call(this,e,n)||this}return Le(e,t),e.prototype.createApiKey=function(e){return t.prototype.createApiKey.call(this,e)},e.prototype.fetchApiKey=function(e){return t.prototype.fetchApiKey.call(this,e)},e.prototype.fetchApiKeys=function(){return t.prototype.fetchApiKeys.call(this)},e.prototype.deleteApiKey=function(e){return t.prototype.deleteApiKey.call(this,e)},e.prototype.enableApiKey=function(e){return t.prototype.enableApiKey.call(this,e)},e.prototype.disableApiKey=function(e){return t.prototype.disableApiKey.call(this,e)},e}(Xt);(De||(De={})).factory=new(function(){function t(){}return t.prototype.getClient=function(t,e,n){return new xe(t,n)},t}());var Fe,Me=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),je=function(t){function e(e,n){return t.call(this,te.DEFAULT_NAME,e,n)||this}return Me(e,t),e.prototype.registerWithEmail=function(e,n){return t.prototype.registerWithEmailInternal.call(this,e,n)},e.prototype.confirmUser=function(e,n){return t.prototype.confirmUserInternal.call(this,e,n)},e.prototype.resendConfirmationEmail=function(e){return t.prototype.resendConfirmationEmailInternal.call(this,e)},e.prototype.resetPassword=function(e,n,r){return t.prototype.resetPasswordInternal.call(this,e,n,r)},e.prototype.sendResetPasswordEmail=function(e){return t.prototype.sendResetPasswordEmailInternal.call(this,e)},e.prototype.callResetPasswordFunction=function(e,n,r){return t.prototype.callResetPasswordFunctionInternal.call(this,e,n,r)},e}(re);(Fe||(Fe={})).factory=new(function(){function t(){}return t.prototype.getClient=function(t,e,n){return new je(e,n)},t}());var qe,Ve=n("qpwQ"),Be=function(){function t(){}return t.prototype.roundTrip=function(t){var e=Object(Ve.fetch)(t.url,{body:t.body,headers:t.headers,method:t.method,mode:"cors"}),n=e.then((function(t){return t.text()}));return Promise.all([e,n]).then((function(t){var e=t[0],n=t[1],r={};return e.headers.forEach((function(t,e){r[e]=t})),new fe(r,e.status,n)}))},t.prototype.stream=function(t,e,n){throw void 0===e&&(e=!0),new J(B.StreamingNotSupported)},t}(),We=function(){function t(t){this.suiteName=t}return t.prototype.get=function(t){return localStorage.getItem(this.getKey(t))},t.prototype.set=function(t,e){localStorage.setItem(this.getKey(t),e)},t.prototype.remove=function(t){localStorage.removeItem(this.getKey(t))},t.prototype.getKey=function(t){return"__stitch.client."+this.suiteName+"."+t},t}(),Ke=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ge=function(t){function e(e,n,r,o){var i=t.call(this,o)||this;return i.evtSrc=e,i.onOpenError=r,i.openedOnce=!1,i.evtSrc.onopen=function(t){n(i),i.openedOnce=!0},i.reset(),i}return Ke(e,t),e.prototype.open=function(){if(this.closed)throw new J(B.StreamClosed)},e.prototype.afterClose=function(){this.evtSrc.close()},e.prototype.onReconnect=function(t){this.evtSrc=t.evtSrc,this.reset(),this.events=t.events.concat(this.events)},e.prototype.reset=function(){var t=this;this.evtSrc.onmessage=function(e){t.events.push(new z(z.MESSAGE_EVENT,e.data)),t.poll()},this.evtSrc.onerror=function(e){return e instanceof MessageEvent?(t.lastErr=e.data,t.events.push(new z(Z.ERROR_EVENT_NAME,t.lastErr)),t.close(),void t.poll()):t.openedOnce?(t.evtSrc.close(),void t.reconnect()):(t.close(),void t.onOpenError(new Error("event source failed to open and will not reconnect; check network log for more details")))}},e}(he),He=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ye=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},Je=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return He(e,t),e.prototype.stream=function(t,e,n){void 0===e&&(e=!0);var r=Ye({},t.headers);return r[S.ACCEPT]=P.TEXT_EVENT_STREAM,r[S.CONTENT_TYPE]=P.TEXT_EVENT_STREAM,Object(Ve.fetch)(t.url+"&stitch_validate=true",{body:t.body,headers:r,method:t.method,mode:"cors"}).then((function(e){var r={};return e.headers.forEach((function(t,e){r[e]=t})),e.status<200||e.status>=300?e.text().then((function(t){return k(new fe(r,e.status,t))})):new Promise((function(e,r){return new Ge(new EventSource(t.url),(function(t){return e(t)}),(function(t){return r(t)}),n?function(){return n().then((function(t){return t}))}:void 0)}))}))},e}(Be),ze=function(){function t(t){this.proxy=t}return t.prototype.callFunction=function(t,e,n){return this.proxy.callFunction(t,e,n)},t.prototype.streamFunction=function(t,e,n){return this.proxy.streamFunction(t,e,n)},t}(),Ze=n("SjWX");!function(t){t.StitchError="_stitch_error",t.State="_stitch_state",t.UserAuth="_stitch_ua",t.LinkUser="_stitch_link_user",t.StitchLink="_stitch_link",t.ClientAppId="_stitch_client_app_id"}(qe||(qe={}));var Xe,Qe=qe;!function(t){t.ProviderName="_stitch_redirect_provider_name",t.ProviderType="_stitch_redirect_provider_type",t.State="_stitch_redirect_state"}(Xe||(Xe={}));var $e=Xe,tn=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),en=function(t){function e(e){return t.call(this,e)||this}return tn(e,t),e}(m),nn=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),rn=function(t){function e(e,n,r,o,i,s,u,a){var c=t.call(this,e,n,r,o,i,s,a)||this;return c.auth=u,c}return nn(e,t),e.prototype.linkWithCredential=function(t){return this.auth.linkWithCredential(this,t)},e.prototype.linkUserWithRedirect=function(t){return this.auth.linkWithRedirectInternal(this,t)},e}($),on=function(){function t(t){this.auth=t}return t.prototype.makeUser=function(t,e,n,r,o,i,s){return new rn(t,e,n,r,o,i,this.auth,s)},t}(),sn=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),un=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(u){o={error:u}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},an=function(t){function e(e,n,r,o,i){void 0===i&&(i=window);var s=t.call(this,e,n,r)||this;return s.browserAuthRoutes=n,s.authStorage=r,s.appInfo=o,s.jsdomWindow=i,s.listeners=new Set,s.synchronousListeners=new Set,s}return sn(e,t),Object.defineProperty(e.prototype,"userFactory",{get:function(){return new on(this)},enumerable:!0,configurable:!0}),e.prototype.getProviderClient=function(t,e){return function(t){return void 0!==t.getClient}(t)?t.getClient(this,this.requestClient,this.authRoutes):t.getNamedClient(e,this.requestClient,this.authRoutes)},e.prototype.loginWithCredential=function(e){return t.prototype.loginWithCredentialInternal.call(this,e)},e.prototype.loginWithRedirect=function(t){var e=this,n=this.prepareRedirect(t),r=n.redirectUrl,o=n.state;this.requestClient.getBaseURL().then((function(n){e.jsdomWindow.location.replace(n+e.browserAuthRoutes.getAuthProviderRedirectRoute(t,r,o,e.deviceInfo))}))},e.prototype.linkWithRedirectInternal=function(t,n){var r=this;if(void 0!==this.user&&t.id!==this.user.id)return Promise.reject(new J(B.UserNoLongerValid));var o=this.prepareRedirect(n),i=o.redirectUrl,s=o.state;return this.requestClient.getBaseURL().then((function(t){var o=t+r.browserAuthRoutes.getAuthProviderLinkRedirectRoute(n,i,s,r.deviceInfo);return(e.injectedFetch?e.injectedFetch:fetch)(new Request(o,{credentials:"include",headers:{Authorization:"Bearer "+r.authInfo.accessToken},mode:"cors"}))})).then((function(t){r.jsdomWindow.location.replace(t.headers.get("X-Stitch-Location"))}))},e.prototype.hasRedirectResult=function(){var t=!1;try{return t=this.parseRedirect().isValid}catch(e){return!1}finally{t||this.cleanupRedirect()}},e.prototype.handleRedirectResult=function(){try{var t=this.authStorage.get($e.ProviderName),e=this.authStorage.get($e.ProviderType),n=this.parseRedirect();return this.loginWithCredentialInternal(new et(this.processRedirectResult(n),e,t,n.asLink)).then((function(t){return t}))}catch(r){return Promise.reject(r)}},e.prototype.linkWithCredential=function(e,n){return t.prototype.linkUserWithCredentialInternal.call(this,e,n)},e.prototype.logout=function(){return arguments.length>0?Promise.reject(new J(B.UnexpectedArguments)):t.prototype.logoutInternal.call(this)},e.prototype.logoutUserWithId=function(e){return t.prototype.logoutUserWithIdInternal.call(this,e)},e.prototype.removeUser=function(){return arguments.length>0?Promise.reject(new J(B.UnexpectedArguments)):t.prototype.removeUserInternal.call(this)},e.prototype.removeUserWithId=function(e){return t.prototype.removeUserWithIdInternal.call(this,e)},Object.defineProperty(e.prototype,"deviceInfo",{get:function(){var t={};this.hasDeviceId&&(t[xt.DEVICE_ID]=this.deviceId),void 0!==this.appInfo.localAppName&&(t[xt.APP_ID]=this.appInfo.localAppName),void 0!==this.appInfo.localAppVersion&&(t[xt.APP_VERSION]=this.appInfo.localAppVersion);var e=Object(Ze.detect)();return e?(t[xt.PLATFORM]=e.name,t[xt.PLATFORM_VERSION]=e.version):(t[xt.PLATFORM]="web",t[xt.PLATFORM_VERSION]="0.0.0"),t[xt.SDK_VERSION]="4.8.0",t},enumerable:!0,configurable:!0}),e.prototype.addAuthListener=function(t){this.listeners.add(t),this.onAuthEvent(t),this.dispatchAuthEvent({kind:r.ListenerRegistered})},e.prototype.addSynchronousAuthListener=function(t){this.listeners.add(t),this.onAuthEvent(t),this.dispatchAuthEvent({kind:r.ListenerRegistered})},e.prototype.removeAuthListener=function(t){this.listeners.delete(t)},e.prototype.onAuthEvent=function(t){var e=this;if(t)new Promise((function(n){t.onAuthEvent&&t.onAuthEvent(e),n(void 0)}));else this.listeners.forEach((function(t){e.onAuthEvent(t)}))},e.prototype.dispatchAuthEvent=function(t){var e=this;switch(t.kind){case r.ActiveUserChanged:this.dispatchBlockToListeners((function(n){n.onActiveUserChanged&&n.onActiveUserChanged(e,t.currentActiveUser,t.previousActiveUser)}));break;case r.ListenerRegistered:this.dispatchBlockToListeners((function(t){t.onListenerRegistered&&t.onListenerRegistered(e)}));break;case r.UserAdded:this.dispatchBlockToListeners((function(n){n.onUserAdded&&n.onUserAdded(e,t.addedUser)}));break;case r.UserLinked:this.dispatchBlockToListeners((function(n){n.onUserLinked&&n.onUserLinked(e,t.linkedUser)}));break;case r.UserLoggedIn:this.dispatchBlockToListeners((function(n){n.onUserLoggedIn&&n.onUserLoggedIn(e,t.loggedInUser)}));break;case r.UserLoggedOut:this.dispatchBlockToListeners((function(n){n.onUserLoggedOut&&n.onUserLoggedOut(e,t.loggedOutUser)}));break;case r.UserRemoved:this.dispatchBlockToListeners((function(n){n.onUserRemoved&&n.onUserRemoved(e,t.removedUser)}));break;default:return this.assertNever(t)}},e.prototype.refreshCustomData=function(){return this.refreshAccessToken()},e.prototype.assertNever=function(t){throw new Error("unexpected object: "+t)},e.prototype.dispatchBlockToListeners=function(t){this.synchronousListeners.forEach(t),this.listeners.forEach((function(e){new Promise((function(n){t(e),n(void 0)}))}))},e.prototype.cleanupRedirect=function(){this.jsdomWindow.history.replaceState(null,"",this.pageRootUrl()),this.authStorage.remove($e.State),this.authStorage.remove($e.ProviderName),this.authStorage.remove($e.ProviderType)},e.prototype.parseRedirect=function(){if(void 0===this.jsdomWindow)throw new en("running in a non-browser environment");if(!this.jsdomWindow.location||!this.jsdomWindow.location.hash)throw new en("window location hash was undefined");var t=this.authStorage.get($e.State);return function(t,e,n){var r=t.split("&"),o=new cn;return r.forEach((function(t){var r=t.split("=");switch(decodeURIComponent(r[0])){case Qe.StitchError:o.lastError=decodeURIComponent(r[1]);break;case Qe.UserAuth:try{o.authInfo=function(t){var e=t.split("$");if(4!==e.length)throw new en("invalid user auth data provided while marshalling user authentication data: "+t);var n=un(e,4),r=n[0],o=n[1],i=n[2],s=n[3];return new p(i,s,r,o)}(decodeURIComponent(r[1]))}catch(u){o.lastError=u}break;case Qe.StitchLink:"ok"===r[1]&&(o.asLink=!0);break;case Qe.State:var i=decodeURIComponent(r[1]);e===i&&(o.stateValid=!0);break;case Qe.ClientAppId:var s=decodeURIComponent(r[1]);n===s&&(o.clientAppIdValid=!0)}})),o}(this.jsdomWindow.location.hash.substring(1),t,this.appInfo.clientAppId)},e.prototype.processRedirectResult=function(t){try{if(!t.isValid)throw new en("invalid redirect result");if(t.lastError)throw new en("error handling redirect: "+t.lastError);if(!t.authInfo)throw new en("no user auth value was found: it could not be decoded from fragment")}catch(e){throw e}finally{this.cleanupRedirect()}return t.authInfo},e.prototype.prepareRedirect=function(t){this.authStorage.set($e.ProviderName,t.providerName),this.authStorage.set($e.ProviderType,t.providerType);var e=t.redirectUrl;void 0===e&&(e=this.pageRootUrl());var n=function(){for(var t="",e=0;e<64;++e)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(Math.random()*"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".length));return t}();return this.authStorage.set($e.State,n),{redirectUrl:e,state:n}},e.prototype.pageRootUrl=function(){return[this.jsdomWindow.location.protocol,"//",this.jsdomWindow.location.host,this.jsdomWindow.location.pathname].join("")},e}(Ct);var cn=function(){function t(){this.stateValid=!1,this.clientAppIdValid=!1,this.asLink=!1}return Object.defineProperty(t.prototype,"isValid",{get:function(){return this.stateValid&&this.clientAppIdValid},enumerable:!0,configurable:!0}),t}();var hn=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),dn=function(t){function e(e){return t.call(this,e)||this}return hn(e,t),e.prototype.getAuthProviderRedirectRoute=function(t,e,n,r){return this.getAuthProviderLoginRoute(t.providerName)+"?redirect="+encodeURI(e)+"&state="+n+"&device="+this.uriEncodeObject(r)},e.prototype.getAuthProviderLinkRedirectRoute=function(t,e,n,r){return this.getAuthProviderLoginRoute(t.providerName)+"?redirect="+encodeURI(e)+"&state="+n+"&device="+this.uriEncodeObject(r)+"&link=true&providerRedirectHeader=true"},e.prototype.uriEncodeObject=function(t){return encodeURIComponent(ot(JSON.stringify(t)))},e}(me),fn=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),pn=function(t){function e(e){var n=t.call(this,e)||this;return n.authRoutes=new dn(e),n}return fn(e,t),e}(Re),ln=function(){function t(t,e){this.info=new Ce(t,e.dataDirectory,e.localAppName,e.localAppVersion),this.routes=new pn(this.info.clientAppId);var n=new _e(t,e.baseUrl,e.transport);this.auth=new an(n,this.routes.authRoutes,e.storage,this.info),this.coreClient=new ae(this.auth,this.routes),this.serviceClients=[],this.auth.addSynchronousAuthListener(this)}return t.prototype.getServiceClient=function(t,e){if(function(t){return void 0!==t.getClient}(t)){var n=new ue(this.auth,this.routes.serviceRoutes,"");return this.bindServiceClient(n),t.getClient(n,this.info)}n=new ue(this.auth,this.routes.serviceRoutes,e);return this.bindServiceClient(n),t.getNamedClient(n,this.info)},t.prototype.getGeneralServiceClient=function(t){var e=new ue(this.auth,this.routes.serviceRoutes,t);return this.bindServiceClient(e),new ze(e)},t.prototype.callFunction=function(t,e){return this.coreClient.callFunction(t,e)},t.prototype.onActiveUserChanged=function(t,e,n){this.onRebindEvent(new Pe({currentActiveUser:e,kind:r.ActiveUserChanged,previousActiveUser:n}))},t.prototype.bindServiceClient=function(t){this.serviceClients.push(t)},t.prototype.onRebindEvent=function(t){this.serviceClients.forEach((function(e){e.onRebindEvent(t)}))},t}();var vn,yn={},gn=function(){function t(){}return Object.defineProperty(t,"defaultAppClient",{get:function(){if(void 0===t.defaultClientAppId)throw new Error("default app client has not yet been initialized/set");return yn[t.defaultClientAppId]},enumerable:!0,configurable:!0}),t.getAppClient=function(t){if(void 0===yn[t])throw new Error("client for app '"+t+"' has not yet been initialized");return yn[t]},t.hasAppClient=function(t){return void 0!==yn[t]},t.initializeDefaultAppClient=function(e,n){if(void 0===n&&(n=(new ke.Builder).build()),void 0===e||""===e)throw new Error("clientAppId must be set to a non-empty string");if(void 0!==t.defaultClientAppId)throw new Error("default app can only be set once; currently set to '"+t.defaultClientAppId+"'");var r=t.initializeAppClient(e,n);return t.defaultClientAppId=e,r},t.initializeAppClient=function(e,n){if(void 0===n&&(n=(new ke.Builder).build()),void 0===e||""===e)throw new Error("clientAppId must be set to a non-empty string");if(void 0!==yn[e])throw new Error("client for app '"+e+"' has already been initialized");var r=n.builder?n.builder():new ke.Builder(n);void 0===r.storage&&r.withStorage(new We(e)),void 0===r.transport&&(window.EventSource?r.withTransport(new Je):r.withTransport(new Be)),void 0!==r.baseUrl&&""!==r.baseUrl||r.withBaseUrl("https://stitch.mongodb.com"),void 0!==r.localAppName&&""!==r.localAppName||r.withLocalAppName(t.localAppName),void 0!==r.localAppVersion&&""!==r.localAppVersion||r.withLocalAppVersion(t.localAppVersion);var o=new ln(e,r.build());return yn[e]=o,o},t.clearApps=function(){yn={}},t}(),mn=function(){function t(t,e,n,r){this.command=t,this.args=e,this.service=n,r&&(this.collectionDecoder=new(function(){function t(){}return t.prototype.decode=function(t){return t instanceof Array?t.map((function(t){return r.decode(t)})):[r.decode(t)]},t}()))}return t.prototype.iterator=function(){return this.executeRead().then((function(t){return t[Symbol.iterator]()}))},t.prototype.first=function(){return this.executeRead().then((function(t){return t[0]}))},t.prototype.toArray=function(){return this.executeRead()},t.prototype.asArray=function(){return this.toArray()},t.prototype.executeRead=function(){return this.service.callFunction(this.command,[this.args],this.collectionDecoder)},t}();!function(t){t[t.ActiveUserChanged=0]="ActiveUserChanged",t[t.ListenerRegistered=1]="ListenerRegistered",t[t.UserAdded=2]="UserAdded",t[t.UserLinked=3]="UserLinked",t[t.UserLoggedIn=4]="UserLoggedIn",t[t.UserLoggedOut=5]="UserLoggedOut",t[t.UserRemoved=6]="UserRemoved"}(vn||(vn={}));var En=function(){function t(t,e,n,r,o,i,s,u){this.userId=t,this.deviceId=e,this.accessToken=n,this.refreshToken=r,this.loggedInProviderType=o,this.loggedInProviderName=i,this.lastAuthActivity=s,this.userProfile=u}return t.empty=function(){return new t(void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0)},Object.defineProperty(t.prototype,"hasUser",{get:function(){return void 0!==this.userId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isEmpty",{get:function(){return void 0===this.deviceId},enumerable:!0,configurable:!0}),t.prototype.loggedOut=function(){return new t(this.userId,this.deviceId,void 0,void 0,this.loggedInProviderType,this.loggedInProviderName,new Date,this.userProfile)},t.prototype.withClearedUser=function(){return new t(void 0,this.deviceId,void 0,void 0,void 0,void 0,void 0,void 0)},t.prototype.withAuthProvider=function(e,n){return new t(this.userId,this.deviceId,this.accessToken,this.refreshToken,e,n,new Date,this.userProfile)},t.prototype.withNewAuthActivityTime=function(){return new t(this.userId,this.deviceId,this.accessToken,this.refreshToken,this.loggedInProviderType,this.loggedInProviderName,new Date,this.userProfile)},Object.defineProperty(t.prototype,"isLoggedIn",{get:function(){return void 0!==this.accessToken&&void 0!==this.refreshToken},enumerable:!0,configurable:!0}),t.prototype.merge=function(e){return new t(void 0===e.userId?this.userId:e.userId,void 0===e.deviceId?this.deviceId:e.deviceId,void 0===e.accessToken?this.accessToken:e.accessToken,void 0===e.refreshToken?this.refreshToken:e.refreshToken,void 0===e.loggedInProviderType?this.loggedInProviderType:e.loggedInProviderType,void 0===e.loggedInProviderName?this.loggedInProviderName:e.loggedInProviderName,void 0===e.lastAuthActivity?this.lastAuthActivity:e.lastAuthActivity,void 0===e.userProfile?this.userProfile:e.userProfile)},t}(),An=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),wn=function(t){Error.call(this,t),Error.captureStackTrace&&Error.captureStackTrace(this),this.message=t,this.name=this.constructor.name};wn.prototype=Object.create(Error.prototype);var Rn,bn,In=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return An(e,t),e}(wn);!function(t){t[t.TRANSPORT_ERROR=0]="TRANSPORT_ERROR",t[t.DECODING_ERROR=1]="DECODING_ERROR",t[t.ENCODING_ERROR=2]="ENCODING_ERROR"}(bn||(bn={}));var On,_n=((Rn={})[bn.TRANSPORT_ERROR]="the request transport encountered an error communicating with Stitch",Rn[bn.DECODING_ERROR]="an error occurred while decoding a response from Stitch",Rn[bn.ENCODING_ERROR]="an error occurred while encoding a request for Stitch",Rn),Tn=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Nn=function(t){function e(e,n){var r=this,o="("+bn[n]+"): "+_n[n]+": "+e.message;return(r=t.call(this,o)||this).underlyingError=e,r.errorCode=n,r.errorCodeName=bn[n],r}return Tn(e,t),e}(In);!function(t){t[t.MissingAuthReq=0]="MissingAuthReq",t[t.InvalidSession=1]="InvalidSession",t[t.UserAppDomainMismatch=2]="UserAppDomainMismatch",t[t.DomainNotAllowed=3]="DomainNotAllowed",t[t.ReadSizeLimitExceeded=4]="ReadSizeLimitExceeded",t[t.InvalidParameter=5]="InvalidParameter",t[t.MissingParameter=6]="MissingParameter",t[t.TwilioError=7]="TwilioError",t[t.GCMError=8]="GCMError",t[t.HTTPError=9]="HTTPError",t[t.AWSError=10]="AWSError",t[t.MongoDBError=11]="MongoDBError",t[t.ArgumentsNotAllowed=12]="ArgumentsNotAllowed",t[t.FunctionExecutionError=13]="FunctionExecutionError",t[t.NoMatchingRuleFound=14]="NoMatchingRuleFound",t[t.InternalServerError=15]="InternalServerError",t[t.AuthProviderNotFound=16]="AuthProviderNotFound",t[t.AuthProviderAlreadyExists=17]="AuthProviderAlreadyExists",t[t.ServiceNotFound=18]="ServiceNotFound",t[t.ServiceTypeNotFound=19]="ServiceTypeNotFound",t[t.ServiceAlreadyExists=20]="ServiceAlreadyExists",t[t.ServiceCommandNotFound=21]="ServiceCommandNotFound",t[t.ValueNotFound=22]="ValueNotFound",t[t.ValueAlreadyExists=23]="ValueAlreadyExists",t[t.ValueDuplicateName=24]="ValueDuplicateName",t[t.FunctionNotFound=25]="FunctionNotFound",t[t.FunctionAlreadyExists=26]="FunctionAlreadyExists",t[t.FunctionDuplicateName=27]="FunctionDuplicateName",t[t.FunctionSyntaxError=28]="FunctionSyntaxError",t[t.FunctionInvalid=29]="FunctionInvalid",t[t.IncomingWebhookNotFound=30]="IncomingWebhookNotFound",t[t.IncomingWebhookAlreadyExists=31]="IncomingWebhookAlreadyExists",t[t.IncomingWebhookDuplicateName=32]="IncomingWebhookDuplicateName",t[t.RuleNotFound=33]="RuleNotFound",t[t.ApiKeyNotFound=34]="ApiKeyNotFound",t[t.RuleAlreadyExists=35]="RuleAlreadyExists",t[t.RuleDuplicateName=36]="RuleDuplicateName",t[t.AuthProviderDuplicateName=37]="AuthProviderDuplicateName",t[t.RestrictedHost=38]="RestrictedHost",t[t.ApiKeyAlreadyExists=39]="ApiKeyAlreadyExists",t[t.IncomingWebhookAuthFailed=40]="IncomingWebhookAuthFailed",t[t.ExecutionTimeLimitExceeded=41]="ExecutionTimeLimitExceeded",t[t.FunctionNotCallable=42]="FunctionNotCallable",t[t.UserAlreadyConfirmed=43]="UserAlreadyConfirmed",t[t.UserNotFound=44]="UserNotFound",t[t.UserDisabled=45]="UserDisabled",t[t.Unknown=46]="Unknown"}(On||(On={}));var Pn={APIKeyAlreadyExists:On.ApiKeyAlreadyExists,APIKeyNotFound:On.ApiKeyNotFound,AWSError:On.AWSError,ArgumentsNotAllowed:On.ArgumentsNotAllowed,AuthProviderAlreadyExists:On.AuthProviderAlreadyExists,AuthProviderDuplicateName:On.AuthProviderDuplicateName,AuthProviderNotFound:On.AuthProviderNotFound,DomainNotAllowed:On.DomainNotAllowed,ExecutionTimeLimitExceeded:On.ExecutionTimeLimitExceeded,FunctionAlreadyExists:On.FunctionAlreadyExists,FunctionDuplicateName:On.FunctionDuplicateName,FunctionExecutionError:On.FunctionExecutionError,FunctionInvalid:On.FunctionInvalid,FunctionNotCallable:On.FunctionNotCallable,FunctionNotFound:On.FunctionNotFound,FunctionSyntaxError:On.FunctionSyntaxError,GCMError:On.GCMError,HTTPError:On.HTTPError,IncomingWebhookAlreadyExists:On.IncomingWebhookAlreadyExists,IncomingWebhookAuthFailed:On.IncomingWebhookAuthFailed,IncomingWebhookDuplicateName:On.IncomingWebhookDuplicateName,IncomingWebhookNotFound:On.IncomingWebhookNotFound,InternalServerError:On.InternalServerError,InvalidParameter:On.InvalidParameter,InvalidSession:On.InvalidSession,MissingAuthReq:On.MissingAuthReq,MissingParameter:On.MissingParameter,MongoDBError:On.MongoDBError,NoMatchingRuleFound:On.NoMatchingRuleFound,ReadSizeLimitExceeded:On.ReadSizeLimitExceeded,RestrictedHost:On.RestrictedHost,RuleAlreadyExists:On.RuleAlreadyExists,RuleDuplicateName:On.RuleDuplicateName,RuleNotFound:On.RuleNotFound,ServiceAlreadyExists:On.ServiceAlreadyExists,ServiceCommandNotFound:On.ServiceCommandNotFound,ServiceNotFound:On.ServiceNotFound,ServiceTypeNotFound:On.ServiceTypeNotFound,TwilioError:On.TwilioError,UserAlreadyConfirmed:On.UserAlreadyConfirmed,UserAppDomainMismatch:On.UserAppDomainMismatch,UserDisabled:On.UserDisabled,UserNotFound:On.UserNotFound,ValueAlreadyExists:On.ValueAlreadyExists,ValueDuplicateName:On.ValueDuplicateName,ValueNotFound:On.ValueNotFound};function Sn(t){return t in Pn?Pn[t]:On.Unknown}var Un,kn,Dn=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Cn=function(t){function e(e,n){void 0===n&&(n=On.Unknown);var r=t.call(this,e)||this;return r.message=e,r.errorCode=n,r.errorCodeName=On[n],r}return Dn(e,t),e}(In),Ln=function(){function t(){}return t.APPLICATION_JSON="application/json",t.TEXT_EVENT_STREAM="text/event-stream",t}(),xn=function(){function t(){}return t.getAuthorizationBearer=function(e){return t.AUTHORIZATION_BEARER+" "+e},t.CONTENT_TYPE_CANON="Content-Type",t.CONTENT_TYPE=t.CONTENT_TYPE_CANON.toLocaleLowerCase(),t.AUTHORIZATION_CANON="Authorization",t.AUTHORIZATION=t.AUTHORIZATION_CANON.toLocaleLowerCase(),t.ACCEPT_CANON="Accept",t.ACCEPT=t.ACCEPT_CANON.toLocaleLowerCase(),t.AUTHORIZATION_BEARER="Bearer",t}();function Fn(t){return t instanceof In?t:new Nn(t,bn.DECODING_ERROR)}function Mn(t){if(void 0===t.body)throw new Cn("received unexpected status code "+t.statusCode,On.Unknown);var e;try{e=t.body}catch(r){throw new Cn("received unexpected status code "+t.statusCode,On.Unknown)}var n=function(t,e){if(void 0===t.headers[xn.CONTENT_TYPE]||void 0!==t.headers[xn.CONTENT_TYPE]&&t.headers[xn.CONTENT_TYPE]!==Ln.APPLICATION_JSON)return e;var n=JSON.parse(e);if(!(n instanceof Object))return e;var r=n;if(void 0===r[Un.ERROR])return e;var o=r[Un.ERROR];if(void 0===r[Un.ERROR_CODE])return o;var i=r[Un.ERROR_CODE];throw new Cn(o,Sn(i))}(t,e);throw new Cn(n,On.Unknown)}!function(t){t.ERROR="error",t.ERROR_CODE="error_code"}(Un||(Un={})),function(t){t.GET="GET",t.POST="POST",t.PUT="PUT",t.DELETE="DELETE",t.HEAD="HEAD",t.OPTIONS="OPTIONS",t.TRACE="TRACE",t.PATCH="PATCH"}(kn||(kn={}));var jn=kn,qn=function(){function t(t,e,n,r,o){this.method=t,this.path=e,this.headers=n,this.body=o,this.startedAt=r}return Object.defineProperty(t.prototype,"builder",{get:function(){return new t.Builder(this)},enumerable:!0,configurable:!0}),t}();!function(t){var e=function(){function e(t){void 0!==t&&(this.method=t.method,this.path=t.path,this.headers=t.headers,this.body=t.body,this.startedAt=t.startedAt)}return e.prototype.withMethod=function(t){return this.method=t,this},e.prototype.withPath=function(t){return this.path=t,this},e.prototype.withHeaders=function(t){return this.headers=t,this},e.prototype.withBody=function(t){return this.body=t,this},e.prototype.build=function(){if(void 0===this.method)throw Error("must set method");if(void 0===this.path)throw Error("must set non-empty path");return void 0===this.startedAt&&(this.startedAt=Date.now()/1e3),new t(this.method,this.path,void 0===this.headers?{}:this.headers,this.startedAt,this.body)},e}();t.Builder=e}(qn||(qn={}));var Vn=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Bn=function(t){function e(e,n,r){void 0===n&&(n=!1),void 0===r&&(r=!0);var o=t.call(this,e.method,e.path,e.headers,e.startedAt,e.body)||this;return o.useRefreshToken=n,o.shouldRefreshOnFailure=r,o}return Vn(e,t),Object.defineProperty(e.prototype,"builder",{get:function(){return new e.Builder(this)},enumerable:!0,configurable:!0}),e}(qn);!function(t){var e=function(e){function n(t){return e.call(this,t)||this}return Vn(n,e),n.prototype.withAccessToken=function(){return this.useRefreshToken=!1,this},n.prototype.withRefreshToken=function(){return this.useRefreshToken=!0,this},n.prototype.withShouldRefreshOnFailure=function(t){return this.shouldRefreshOnFailure=t,this},n.prototype.build=function(){return this.useRefreshToken&&(this.shouldRefreshOnFailure=!1),new t(e.prototype.build.call(this),this.useRefreshToken,this.shouldRefreshOnFailure)},n}(qn.Builder);t.Builder=e}(Bn||(Bn={}));var Wn=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Kn=function(t){function e(e,n){var r=this;return(r=e instanceof Bn?t.call(this,e,e.useRefreshToken,e.shouldRefreshOnFailure)||this:t.call(this,e)||this).document=n,r}return Wn(e,t),Object.defineProperty(e.prototype,"builder",{get:function(){return new e.Builder(this)},enumerable:!0,configurable:!0}),e}(Bn);!function(t){var e=function(e){function n(t){var n=e.call(this,t)||this;return void 0!==t&&(n.document=t.document,n.useRefreshToken=t.useRefreshToken),n}return Wn(n,e),n.prototype.withDocument=function(t){return this.document=t,this},n.prototype.withAccessToken=function(){return this.useRefreshToken=!1,this},n.prototype.build=function(){if(void 0===this.document||!(this.document instanceof Object))throw new Error("document must be set: "+this.document);return void 0===this.headers&&this.withHeaders({}),this.headers[xn.CONTENT_TYPE]=Ln.APPLICATION_JSON,this.withBody(d.a.stringify(this.document,{relaxed:!1})),new t(e.prototype.build.call(this),this.document)},n}(Bn.Builder);t.Builder=e}(Kn||(Kn={}));var Gn,Hn,Yn=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Jn=function(t){function e(e,n){var r=t.call(this,e.method,e.path,e.headers,e.startedAt,e.body)||this;return r.document=n,r}return Yn(e,t),Object.defineProperty(e.prototype,"builder",{get:function(){return new e.Builder(this)},enumerable:!0,configurable:!0}),e}(qn);!function(t){var e=function(e){function n(t){var n=e.call(this,t)||this;return void 0!==t&&(n.document=t.document),n}return Yn(n,e),n.prototype.withDocument=function(t){return this.document=t,this},n.prototype.build=function(){if(void 0===this.document||!(this.document instanceof Object))throw new Error("document must be set");return void 0===this.headers&&this.withHeaders({}),this.headers[xn.CONTENT_TYPE]=Ln.APPLICATION_JSON,this.withBody(d.a.stringify(this.document,{relaxed:!1})),new t(e.prototype.build.call(this),this.document)},n}(qn.Builder);t.Builder=e}(Jn||(Jn={})),function(t){t[t.LoggedOutDuringRequest=0]="LoggedOutDuringRequest",t[t.MustAuthenticateFirst=1]="MustAuthenticateFirst",t[t.UserNoLongerValid=2]="UserNoLongerValid",t[t.UserNotFound=3]="UserNotFound",t[t.UserNotLoggedIn=4]="UserNotLoggedIn",t[t.CouldNotLoadPersistedAuthInfo=5]="CouldNotLoadPersistedAuthInfo",t[t.CouldNotPersistAuthInfo=6]="CouldNotPersistAuthInfo",t[t.StreamingNotSupported=7]="StreamingNotSupported",t[t.StreamClosed=8]="StreamClosed",t[t.UnexpectedArguments=9]="UnexpectedArguments"}(Hn||(Hn={}));var zn,Zn=((Gn={})[Hn.LoggedOutDuringRequest]="logged out while making a request to Stitch",Gn[Hn.MustAuthenticateFirst]="method called requires being authenticated",Gn[Hn.UserNoLongerValid]="user instance being accessed is no longer valid; please get a new user with auth.getUser()",Gn[Hn.UserNotFound]="user not found in list of users",Gn[Hn.UserNotLoggedIn]="cannot make the active user a logged out user; please use loginWithCredential() to switch to this user",Gn[Hn.CouldNotLoadPersistedAuthInfo]="failed to load stored auth information for Stitch",Gn[Hn.CouldNotPersistAuthInfo]="failed to save auth information for Stitch",Gn[Hn.StreamingNotSupported]="streaming not supported in this SDK",Gn[Hn.StreamClosed]="stream is closed",Gn[Hn.UnexpectedArguments]="function does not accept arguments",Gn),Xn=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Qn=function(t){function e(e){var n=this,r="("+Hn[e]+"): "+Zn[e];return(n=t.call(this,r)||this).errorCode=e,n.errorCodeName=Hn[e],n}return Xn(e,t),e}(In),$n=function(){function t(t,e){this.eventName=t,this.data=e}return t.MESSAGE_EVENT="message",t}(),tr=function(){function t(e,n,r){this.eventName=e,n=n||"";for(var o=[],i=0;i<n.length;i++){var s=n[i];switch(s){case"%":if(i+2>=n.length)break;var u=void 0;switch(n.substring(i+1,i+3)){case"25":u=!0,o.push("%");break;case"0A":u=!0,o.push("\n");break;case"0D":u=!0,o.push("\r");break;default:u=!1}if(u){i+=2;continue}}o.push(s)}var a=o.join("");switch(this.eventName){case t.ERROR_EVENT_NAME:var c=void 0,h=void 0;try{var f=d.a.parse(a,{strict:!1});c=f[zn.Error],h=Sn(f[zn.ErrorCode])}catch(p){c=a,h=On.Unknown}this.error=new Cn(c,h);break;case $n.MESSAGE_EVENT:this.data=d.a.parse(a,{strict:!1}),r&&(this.data=r.decode(this.data))}}return t.fromEvent=function(e,n){return new t(e.eventName,e.data,n)},t.ERROR_EVENT_NAME="error",t}();!function(t){t.Error="error",t.ErrorCode="error_code"}(zn||(zn={}));var er=function(){function t(t,e){this.eventStream=t,this.decoder=e,this.listeners=[]}return t.prototype.next=function(){var t=this;return this.eventStream.nextEvent().then((function(e){var n=tr.fromEvent(e,t.decoder);if(n.eventName===tr.ERROR_EVENT_NAME)throw n.error;return n.eventName===$n.MESSAGE_EVENT?n.data:t.next()}))},t.prototype.onNext=function(t){var e=this,n={onEvent:function(n){var r=tr.fromEvent(n,e.decoder);r.eventName===$n.MESSAGE_EVENT&&t(r.data)}};this.eventStream.addListener(n)},t.prototype.onError=function(t){var e=this,n={onEvent:function(n){var r=tr.fromEvent(n,e.decoder);r.eventName===tr.ERROR_EVENT_NAME&&t(r.error)}};this.eventStream.addListener(n)},t.prototype.addListener=function(t){var e=this,n={onEvent:function(n){var r=tr.fromEvent(n,e.decoder);r.eventName===tr.ERROR_EVENT_NAME?t.onError&&t.onError(r.error):t.onNext&&t.onNext(r.data)}};this.listeners.push([t,n]),this.eventStream.addListener(n)},t.prototype.removeListener=function(t){for(var e=-1,n=0;n<this.listeners.length;n++)if(this.listeners[n][0]===t){e=n;break}if(-1!==e){var r=this.listeners[e][1];this.listeners.splice(e,1),this.eventStream.removeListener(r)}},t.prototype.isOpen=function(){return this.eventStream.isOpen()},t.prototype.close=function(){this.eventStream.close()},t}(),nr=function(){function t(t,e,n){void 0===e&&(e={}),void 0===n&&(n=[]),this.userType=t,this.data=e,this.identities=n}return t.empty=function(){return new t},Object.defineProperty(t.prototype,"name",{get:function(){return this.data.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"email",{get:function(){return this.data.email},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pictureUrl",{get:function(){return this.data.picture},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstName",{get:function(){return this.data.first_name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastName",{get:function(){return this.data.last_name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gender",{get:function(){return this.data.gender},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"birthday",{get:function(){return this.data.birthday},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minAge",{get:function(){var t=this.data.min_age;if(void 0!==t)return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxAge",{get:function(){var t=this.data.max_age;if(void 0!==t)return t},enumerable:!0,configurable:!0}),t}(),rr=function(){function t(t,e,n,r,o,i,s){this.id=t,this.loggedInProviderType=e,this.loggedInProviderName=n,this.profile=void 0===i?nr.empty():i,this.isLoggedIn=r,this.lastAuthActivity=o,this.customData=void 0===s?{}:s}return Object.defineProperty(t.prototype,"userType",{get:function(){return this.profile.userType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"identities",{get:function(){return this.profile.identities},enumerable:!0,configurable:!0}),t.prototype.equals=function(t){return this.id===t.id&&JSON.stringify(this.identities)===JSON.stringify(t.identities)&&this.isLoggedIn===t.isLoggedIn&&this.loggedInProviderName===t.loggedInProviderName&&this.loggedInProviderType===t.loggedInProviderType&&JSON.stringify(this.profile)===JSON.stringify(t.profile)},t}(),or=function(){function t(){}return t.TYPE="anon-user",t.DEFAULT_NAME="anon-user",t}(),ir=function(t,e,n,r){this.authInfo=t,this.providerType=e,this.providerName=n,this.asLink=r};function sr(t){var e,n=t.length%4;0!=n?e=t+"=".repeat(4-n):e=t;var r=Object(nt.toByteArray)(e);return function(t,e,n){var r="",o="";n=Math.min(t.length,n||1/0);for(var i=e=e||0;i<n;i++)t[i]<=127?(r+=ar(o)+String.fromCharCode(t[i]),o=""):o+="%"+t[i].toString(16);return r+ar(o)}(r,0,r.length)}function ur(t){for(var e,n=1/0,r=t.length,o=null,i=[],s=0;s<r;s++){if((e=t.charCodeAt(s))>55295&&e<57344){if(!o){if(e>56319){(n-=3)>-1&&i.push(239,191,189);continue}if(s+1===r){(n-=3)>-1&&i.push(239,191,189);continue}o=e;continue}if(e<56320){(n-=3)>-1&&i.push(239,191,189),o=e;continue}e=o-55296<<10|e-56320|65536,o=null}else o&&((n-=3)>-1&&i.push(239,191,189),o=null);if(e<128){if((n-=1)<0)break;i.push(e)}else if(e<2048){if((n-=2)<0)break;i.push(e>>6|192,63&e|128)}else if(e<65536){if((n-=3)<0)break;i.push(e>>12|224,e>>6&63|128,63&e|128)}else{if(!(e<2097152))throw new Error("Invalid code point");if((n-=4)<0)break;i.push(e>>18|240,e>>12&63|128,e>>6&63|128,63&e|128)}}return i}function ar(t){try{return decodeURIComponent(t)}catch(e){return String.fromCharCode(65533)}}var cr,hr=function(){function t(t,e,n){this.expires=t,this.issuedAt=e,this.userData=n}return t.fromEncoded=function(e){var n=t.splitToken(e),r=JSON.parse(sr(n[1]));return new t(r.exp,r.iat,r.user_data)},t.splitToken=function(t){var e=t.split(".");if(3!==e.length)throw new Error("Malformed JWT token. The string "+t+" should have 3 parts.");return e},t}(),dr=function(){function t(t){this.auth=t}return t.prototype.shouldRefresh=function(){var t=this.auth;if(void 0===t)return!1;if(!t.isLoggedIn)return!1;var e,n=t.authInfo;if(void 0===n)return!1;if(!n.isLoggedIn)return!1;try{e=hr.fromEncoded(n.accessToken)}catch(r){return console.log(r),!1}return!(Date.now()/1e3<e.expires-300)},t.prototype.run=function(){var t=this;this.shouldRefresh()?this.auth.refreshAccessToken().then((function(){t.nextTimeout=setTimeout((function(){return t.run()}),6e4)})).catch((function(){t.nextTimeout=setTimeout((function(){return t.run()}),6e4)})):this.nextTimeout=setTimeout((function(){return t.run()}),6e4)},t.prototype.stop=function(){clearTimeout(this.nextTimeout)},t}(),fr=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();!function(t){t.USER_ID="user_id",t.DEVICE_ID="device_id",t.ACCESS_TOKEN="access_token",t.REFRESH_TOKEN="refresh_token"}(cr||(cr={}));var pr,lr=function(t){function e(e,n,r,o){return t.call(this,e,n,r,o)||this}return fr(e,t),e.fromJSON=function(t){return new e(t[cr.USER_ID],t[cr.DEVICE_ID],t[cr.ACCESS_TOKEN],t[cr.REFRESH_TOKEN])},e.prototype.toJSON=function(){var t;return(t={})[cr.USER_ID]=this.userId,t[cr.DEVICE_ID]=this.deviceId,t[cr.ACCESS_TOKEN]=this.accessToken,t[cr.REFRESH_TOKEN]=this.refreshToken,t},e}(En),vr=function(){function t(){}return t.keyPresent=function(t,e){if(void 0===e[t])throw new Error("expected "+t+" to be present")},t}(),yr=function(t,e){this.id=t,this.providerType=e},gr=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();!function(t){t.ID="id",t.PROVIDER_TYPE="provider_type"}(pr||(pr={}));var mr,Er=function(t){function e(e,n){return t.call(this,e,n)||this}return gr(e,t),e.fromJSON=function(t){return new e(t[pr.ID],t[pr.PROVIDER_TYPE])},e.prototype.toJSON=function(){var t;return(t={})[pr.ID]=this.id,t[pr.PROVIDER_TYPE]=this.providerType,t},e}(yr),Ar=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();!function(t){t.DATA="data",t.USER_TYPE="type",t.IDENTITIES="identities"}(mr||(mr={}));var wr,Rr=function(t){function e(e,n,r){return t.call(this,e,n,r)||this}return Ar(e,t),e.fromJSON=function(t){return vr.keyPresent(mr.USER_TYPE,t),vr.keyPresent(mr.DATA,t),vr.keyPresent(mr.IDENTITIES,t),new e(t[mr.USER_TYPE],t[mr.DATA],t[mr.IDENTITIES].map(Er.fromJSON))},e.prototype.toJSON=function(){var t;return(t={})[mr.DATA]=this.data,t[mr.USER_TYPE]=this.userType,t[mr.IDENTITIES]=this.identities,t},e}(nr),br=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();!function(t){t.ID="id",t.PROVIDER_TYPE="provider_type"}(wr||(wr={}));var Ir,Or=function(t){function e(e,n){return t.call(this,e,n)||this}return br(e,t),e.decode=function(t){return new e(t[wr.ID],t[wr.PROVIDER_TYPE])},e.prototype.encode=function(){var t;return(t={})[wr.ID]=this.id,t[wr.PROVIDER_TYPE]=this.providerType,t},e}(yr),_r=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();!function(t){t.DATA="data",t.USER_TYPE="type",t.IDENTITIES="identities"}(Ir||(Ir={}));var Tr,Nr=function(t){function e(e,n,r){var o=t.call(this,e,n,r)||this;return o.userType=e,o.data=n,o.identities=r,o}return _r(e,t),e.decode=function(t){return t?new e(t[Ir.USER_TYPE],t[Ir.DATA],t[Ir.IDENTITIES].map((function(t){return Or.decode(t)}))):void 0},e.prototype.encode=function(){var t;return(t={})[Ir.DATA]=this.data,t[Ir.USER_TYPE]=this.userType,t[Ir.IDENTITIES]=this.identities.map((function(t){return t.encode()})),t},e}(nr),Pr=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function Sr(t,e){if(t.isEmpty)e.remove(Dr.ACTIVE_USER_STORAGE_NAME);else{var n=new Dr(t.userId,t.deviceId,t.accessToken,t.refreshToken,t.loggedInProviderType,t.loggedInProviderName,t.lastAuthActivity,t.userProfile?new Nr(t.userProfile.userType,t.userProfile.data,t.userProfile.identities.map((function(t){return new Or(t.id,t.providerType)}))):void 0);e.set(Dr.ACTIVE_USER_STORAGE_NAME,JSON.stringify(n.encode()))}}function Ur(t,e){var n=[];t.forEach((function(t,e){var r=new Dr(e,t.deviceId,t.accessToken,t.refreshToken,t.loggedInProviderType,t.loggedInProviderName,t.lastAuthActivity,t.userProfile?new Nr(t.userProfile.userType,t.userProfile.data,t.userProfile.identities.map((function(t){return new Or(t.id,t.providerType)}))):void 0);n.push(r.encode())})),e.set(Dr.ALL_USERS_STORAGE_NAME,JSON.stringify(n))}!function(t){t.USER_ID="user_id",t.DEVICE_ID="device_id",t.ACCESS_TOKEN="access_token",t.REFRESH_TOKEN="refresh_token",t.LAST_AUTH_ACTIVITY="last_auth_activity",t.LOGGED_IN_PROVIDER_TYPE="logged_in_provider_type",t.LOGGED_IN_PROVIDER_NAME="logged_in_provider_name",t.USER_PROFILE="user_profile"}(Tr||(Tr={}));var kr,Dr=function(t){function e(e,n,r,o,i,s,u,a){var c=t.call(this,e,n,r,o,i,s,u,a)||this;return c.userProfile=a,c}return Pr(e,t),e.decode=function(t){var n=t[Tr.USER_ID],r=t[Tr.DEVICE_ID],o=t[Tr.ACCESS_TOKEN],i=t[Tr.REFRESH_TOKEN],s=t[Tr.LOGGED_IN_PROVIDER_TYPE],u=t[Tr.LOGGED_IN_PROVIDER_NAME],a=t[Tr.USER_PROFILE],c=t[Tr.LAST_AUTH_ACTIVITY];return new e(n,r,o,i,s,u,new Date(c),Nr.decode(a))},e.prototype.encode=function(){var t={};return t[Tr.USER_ID]=this.userId,t[Tr.ACCESS_TOKEN]=this.accessToken,t[Tr.REFRESH_TOKEN]=this.refreshToken,t[Tr.DEVICE_ID]=this.deviceId,t[Tr.LOGGED_IN_PROVIDER_NAME]=this.loggedInProviderName,t[Tr.LOGGED_IN_PROVIDER_TYPE]=this.loggedInProviderType,t[Tr.LAST_AUTH_ACTIVITY]=this.lastAuthActivity?this.lastAuthActivity.getTime():void 0,t[Tr.USER_PROFILE]=this.userProfile?this.userProfile.encode():void 0,t},e.ACTIVE_USER_STORAGE_NAME="auth_info",e.ALL_USERS_STORAGE_NAME="all_auth_infos",e}(En),Cr=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}},Lr=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(u){o={error:u}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s};!function(){function t(t,e,n,r){var o,i;void 0===r&&(r=!0),this.requestClient=t,this.authRoutes=e,this.storage=n;try{o=function(t){var e=t.get(Dr.ALL_USERS_STORAGE_NAME);if(!e)return new Map;var n=JSON.parse(e);if(!Array.isArray(n))throw new Qn(Hn.CouldNotLoadPersistedAuthInfo);var r=new Map;return n.forEach((function(t){var e=Dr.decode(t);r.set(e.userId,e)})),r}(n)}catch(s){throw new Qn(Hn.CouldNotLoadPersistedAuthInfo)}this.allUsersAuthInfo=o;try{i=function(t){var e=t.get(Dr.ACTIVE_USER_STORAGE_NAME);if(e)return Dr.decode(JSON.parse(e))}(n)}catch(s){throw new Qn(Hn.CouldNotLoadPersistedAuthInfo)}this.activeUserAuthInfo=void 0===i?En.empty():i,this.activeUserAuthInfo.hasUser&&(this.currentUser=this.prepUser(this.activeUserAuthInfo)),r&&(this.accessTokenRefresher=new dr(this),this.accessTokenRefresher.run())}Object.defineProperty(t.prototype,"authInfo",{get:function(){return this.activeUserAuthInfo},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoggedIn",{get:function(){return void 0!==this.currentUser&&this.currentUser.isLoggedIn},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"user",{get:function(){return this.currentUser},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasDeviceId",{get:function(){return void 0!==this.activeUserAuthInfo.deviceId&&""!==this.activeUserAuthInfo.deviceId&&"000000000000000000000000"!==this.activeUserAuthInfo.deviceId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"deviceId",{get:function(){if(this.hasDeviceId)return this.activeUserAuthInfo.deviceId},enumerable:!0,configurable:!0}),t.prototype.listUsers=function(){var t=this,e=[];return this.allUsersAuthInfo.forEach((function(n){e.push(t.prepUser(n))})),e},t.prototype.doAuthenticatedRequest=function(t,e){var n=this;try{return this.requestClient.doRequest(this.prepareAuthRequest(t,e||this.activeUserAuthInfo)).catch((function(e){return n.handleAuthFailure(e,t)}))}catch(r){return Promise.reject(r)}},t.prototype.doAuthenticatedRequestWithDecoder=function(t,e){return this.doAuthenticatedRequest(t).then((function(t){var n=d.a.parse(t.body,{strict:!1});return e?e.decode(n):n})).catch((function(t){throw Fn(t)}))},t.prototype.openAuthenticatedEventStream=function(t,e){var n=this;if(void 0===e&&(e=!0),!this.isLoggedIn)throw new Qn(Hn.MustAuthenticateFirst);var r=t.useRefreshToken?this.activeUserAuthInfo.refreshToken:this.activeUserAuthInfo.accessToken;return this.requestClient.doStreamRequest(t.builder.withPath(t.path+"&stitch_at="+r).build(),e,(function(){return n.openAuthenticatedEventStream(t,!1)})).catch((function(r){return n.handleAuthFailureForEventStream(r,t,e)}))},t.prototype.openAuthenticatedStreamWithDecoder=function(t,e){return this.openAuthenticatedEventStream(t).then((function(t){return new er(t,e)}))},t.prototype.refreshAccessToken=function(){var t=this,e=(new Bn.Builder).withRefreshToken().withPath(this.authRoutes.sessionRoute).withMethod(jn.POST);return this.doAuthenticatedRequest(e.build()).then((function(e){try{var n=lr.fromJSON(JSON.parse(e.body));if(t.activeUserAuthInfo=t.activeUserAuthInfo.merge(n),n.accessToken&&t.user instanceof rr){var r=hr.fromEncoded(n.accessToken).userData;t.user.customData=void 0===r?{}:r}}catch(o){throw new Nn(o,bn.DECODING_ERROR)}try{Sr(t.activeUserAuthInfo,t.storage),t.allUsersAuthInfo.set(t.activeUserAuthInfo.userId,t.activeUserAuthInfo),Ur(t.allUsersAuthInfo,t.storage)}catch(o){throw new Qn(Hn.CouldNotPersistAuthInfo)}}))},t.prototype.switchToUserWithId=function(t){var e=this.allUsersAuthInfo.get(t);if(void 0===e)throw new Qn(Hn.UserNotFound);if(!e.isLoggedIn)throw new Qn(Hn.UserNotLoggedIn);this.activeUserAuthInfo.hasUser&&this.allUsersAuthInfo.set(this.activeUserAuthInfo.userId,this.activeUserAuthInfo.withNewAuthActivityTime());var n=e.withNewAuthActivityTime();this.allUsersAuthInfo.set(t,n),Sr(n,this.storage),this.activeUserAuthInfo=n;var r=this.currentUser;return this.currentUser=this.prepUser(n),this.onAuthEvent(),this.dispatchAuthEvent({currentActiveUser:this.currentUser,kind:vn.ActiveUserChanged,previousActiveUser:r}),this.currentUser},t.prototype.loginWithCredentialInternal=function(t){var e,n,r=this;if(t instanceof ir)return this.processLogin(t,t.authInfo,t.asLink).then((function(t){return r.dispatchAuthEvent({kind:vn.UserLoggedIn,loggedInUser:t}),t}));if(t.providerCapabilities.reusesExistingSession)try{for(var o=Cr(this.allUsersAuthInfo),i=o.next();!i.done;i=o.next()){var s=Lr(i.value,2),u=s[0],a=s[1];if(a.loggedInProviderType===t.providerType){if(a.isLoggedIn)try{return Promise.resolve(this.switchToUserWithId(u))}catch(c){return Promise.reject(c)}void 0!==a.userId&&this.removeUserWithIdInternal(a.userId)}}}catch(h){e={error:h}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return this.doLogin(t,!1)},t.prototype.linkUserWithCredentialInternal=function(t,e){return void 0!==this.currentUser&&t.id!==this.currentUser.id?Promise.reject(new Qn(Hn.UserNoLongerValid)):this.doLogin(e,!0)},t.prototype.logoutInternal=function(){return this.isLoggedIn&&this.currentUser?this.logoutUserWithIdInternal(this.currentUser.id):Promise.resolve()},t.prototype.logoutUserWithIdInternal=function(t){var e=this,n=this.allUsersAuthInfo.get(t);if(void 0===n)return Promise.reject(new Qn(Hn.UserNotFound));if(!n.isLoggedIn)return Promise.resolve();var r=function(){e.clearUserAuthTokens(n.userId),n.loggedInProviderType===or.TYPE&&e.removeUserWithIdInternal(n.userId)};return this.doLogout(n).then((function(){r()})).catch((function(){r()}))},t.prototype.removeUserInternal=function(){return this.isLoggedIn&&void 0!==this.currentUser?this.removeUserWithIdInternal(this.currentUser.id):Promise.resolve()},t.prototype.removeUserWithIdInternal=function(t){var e=this,n=this.allUsersAuthInfo.get(t);if(void 0===n)return Promise.reject(new Qn(Hn.UserNotFound));var r=function(){e.clearUserAuthTokens(n.userId),e.allUsersAuthInfo.delete(t),Ur(e.allUsersAuthInfo,e.storage);var r=e.prepUser(n.loggedOut());e.onAuthEvent(),e.dispatchAuthEvent({kind:vn.UserRemoved,removedUser:r})};return n.isLoggedIn?this.doLogout(n).then((function(){r()})).catch((function(t){r()})):(r(),Promise.resolve())},t.prototype.close=function(){this.accessTokenRefresher&&this.accessTokenRefresher.stop()},t.prototype.prepareAuthRequest=function(t,e){if(!e.isLoggedIn)throw new Qn(Hn.MustAuthenticateFirst);var n=t.builder,r=n.headers||{};return t.useRefreshToken?r[xn.AUTHORIZATION]=xn.getAuthorizationBearer(e.refreshToken):r[xn.AUTHORIZATION]=xn.getAuthorizationBearer(e.accessToken),n.withHeaders(r),n.build()},t.prototype.handleAuthFailureForEventStream=function(t,e,n){var r=this;if(void 0===n&&(n=!0),!(t instanceof Cn)||t.errorCode!==On.InvalidSession)throw t;if(e.useRefreshToken||!e.shouldRefreshOnFailure)throw this.clearActiveUserAuth(),t;return this.tryRefreshAccessToken(e.startedAt).then((function(){return r.openAuthenticatedEventStream(e.builder.withShouldRefreshOnFailure(!1).build(),n)}))},t.prototype.handleAuthFailure=function(t,e){var n=this;if(!(t instanceof Cn)||t.errorCode!==On.InvalidSession)throw t;if(e.useRefreshToken||!e.shouldRefreshOnFailure)throw this.clearActiveUserAuth(),t;return this.tryRefreshAccessToken(e.startedAt).then((function(){return n.doAuthenticatedRequest(e.builder.withShouldRefreshOnFailure(!1).build())}))},t.prototype.tryRefreshAccessToken=function(t){if(!this.isLoggedIn)throw new Qn(Hn.LoggedOutDuringRequest);try{if(hr.fromEncoded(this.activeUserAuthInfo.accessToken).issuedAt>=t)return Promise.resolve()}catch(e){}return this.refreshAccessToken()},t.prototype.prepUser=function(t){return this.userFactory.makeUser(t.userId,t.loggedInProviderType,t.loggedInProviderName,t.isLoggedIn,t.lastAuthActivity,t.userProfile)},t.prototype.attachAuthOptions=function(t){var e={};e.device=this.deviceInfo,t.options=e},t.prototype.doLogin=function(t,e){var n=this,r=this.currentUser;return this.doLoginRequest(t,e).then((function(r){return n.processLoginResponse(t,r,e)})).then((function(t){return n.onAuthEvent(),e?n.dispatchAuthEvent({kind:vn.UserLinked,linkedUser:t}):(n.dispatchAuthEvent({kind:vn.UserLoggedIn,loggedInUser:t}),n.dispatchAuthEvent({currentActiveUser:t,kind:vn.ActiveUserChanged,previousActiveUser:r})),t}))},t.prototype.doLoginRequest=function(t,e){var n=new Jn.Builder;n.withMethod(jn.POST),e?n.withPath(this.authRoutes.getAuthProviderLinkRoute(t.providerName)):n.withPath(this.authRoutes.getAuthProviderLoginRoute(t.providerName));var r=t.material;if(this.attachAuthOptions(r),n.withDocument(r),!e)return this.requestClient.doRequest(n.build());var o=new Kn(n.build(),n.document);return this.doAuthenticatedRequest(o)},t.prototype.processLogin=function(t,e,n){var r=this,o=this.activeUserAuthInfo,i=this.currentUser;return e=this.activeUserAuthInfo.merge(new En(e.userId,e.deviceId,e.accessToken,e.refreshToken,t.providerType,t.providerName,void 0,void 0)),this.activeUserAuthInfo=e,this.currentUser=this.userFactory.makeUser(this.activeUserAuthInfo.userId,t.providerType,t.providerName,this.activeUserAuthInfo.isLoggedIn,new Date,void 0,hr.fromEncoded(e.accessToken).userData),this.doGetUserProfile().then((function(n){o.hasUser&&r.allUsersAuthInfo.set(o.userId,o.withNewAuthActivityTime()),e=e.merge(new En(e.userId,e.deviceId,e.accessToken,e.refreshToken,t.providerType,t.providerName,new Date,n));var s=!r.allUsersAuthInfo.has(e.userId);try{Sr(e,r.storage),r.allUsersAuthInfo.set(e.userId,e),Ur(r.allUsersAuthInfo,r.storage)}catch(u){throw r.activeUserAuthInfo=o,r.currentUser=i,e.userId!==o.userId&&e.userId&&r.allUsersAuthInfo.delete(e.userId),new Qn(Hn.CouldNotPersistAuthInfo)}return r.activeUserAuthInfo=e,r.currentUser=r.userFactory.makeUser(r.activeUserAuthInfo.userId,t.providerType,t.providerName,r.activeUserAuthInfo.isLoggedIn,r.activeUserAuthInfo.lastAuthActivity,n,hr.fromEncoded(e.accessToken).userData),s&&(r.onAuthEvent(),r.dispatchAuthEvent({addedUser:r.currentUser,kind:vn.UserAdded})),r.currentUser})).catch((function(t){if(t instanceof Qn)throw t;if(n||o.hasUser){var e=r.activeUserAuthInfo;r.activeUserAuthInfo=o,r.currentUser=i,n&&(r.activeUserAuthInfo=r.activeUserAuthInfo.withAuthProvider(e.loggedInProviderType,e.loggedInProviderName))}else r.clearActiveUserAuth();throw t}))},t.prototype.processLoginResponse=function(t,e,n){try{if(!e)throw new Cn("the login response could not be processed for credential: "+t+";response was undefined");if(!e.body)throw new Cn("response with status code "+e.statusCode+" has empty body");return this.processLogin(t,lr.fromJSON(JSON.parse(e.body)),n)}catch(r){throw new Nn(r,bn.DECODING_ERROR)}},t.prototype.doGetUserProfile=function(){var t=new Bn.Builder;return t.withMethod(jn.GET).withPath(this.authRoutes.profileRoute),this.doAuthenticatedRequest(t.build()).then((function(t){return Rr.fromJSON(JSON.parse(t.body))})).catch((function(t){throw t instanceof In?t:new Nn(t,bn.DECODING_ERROR)}))},t.prototype.doLogout=function(t){var e=new Bn.Builder;return e.withRefreshToken().withPath(this.authRoutes.sessionRoute).withMethod(jn.DELETE),this.doAuthenticatedRequest(e.build(),t).then((function(){}))},t.prototype.clearActiveUserAuth=function(){this.isLoggedIn&&this.clearUserAuthTokens(this.activeUserAuthInfo.userId)},t.prototype.clearUserAuthTokens=function(t){var e=this.allUsersAuthInfo.get(t);if(void 0===e){if(this.activeUserAuthInfo.userId!==t)throw new Qn(Hn.UserNotFound)}else if(!e.isLoggedIn)return;try{var n=void 0;if(e){var r=e.loggedOut();this.allUsersAuthInfo.set(t,r),Ur(this.allUsersAuthInfo,this.storage),n=this.userFactory.makeUser(r.userId,r.loggedInProviderType,r.loggedInProviderName,r.isLoggedIn,r.lastAuthActivity,r.userProfile)}var o=!1;this.activeUserAuthInfo.hasUser&&this.activeUserAuthInfo.userId===t&&(o=!0,this.activeUserAuthInfo=this.activeUserAuthInfo.withClearedUser(),this.currentUser=void 0,Sr(this.activeUserAuthInfo,this.storage)),n&&(this.onAuthEvent(),this.dispatchAuthEvent({kind:vn.UserLoggedOut,loggedOutUser:n}),o&&this.dispatchAuthEvent({currentActiveUser:void 0,kind:vn.ActiveUserChanged,previousActiveUser:n}))}catch(i){throw new Qn(Hn.CouldNotPersistAuthInfo)}}}();!function(t){t.DEVICE_ID="deviceId",t.APP_ID="appId",t.APP_VERSION="appVersion",t.PLATFORM="platform",t.PLATFORM_VERSION="platformVersion",t.SDK_VERSION="sdkVersion"}(kr||(kr={}));var xr,Fr=function(t){void 0===t&&(t=!1),this.reusesExistingSession=t};!function(){function t(){}t.TYPE="custom-token",t.DEFAULT_NAME="custom-token"}();!function(t){t.TOKEN="token"}(xr||(xr={}));var Mr,jr=function(){function t(){}return t.TYPE="oauth2-facebook",t.DEFAULT_NAME="oauth2-facebook",t}();!function(t){t.ACCESS_TOKEN="accessToken"}(Mr||(Mr={}));!function(){function t(t,e){var n;void 0===e&&(e=jr.DEFAULT_NAME),this.providerType=jr.TYPE,this.providerName=e,this.accessToken=t,this.material=((n={})[Mr.ACCESS_TOKEN]=this.accessToken,n)}Object.defineProperty(t.prototype,"providerCapabilities",{get:function(){return new Fr(!1)},enumerable:!0,configurable:!0})}();var qr,Vr=function(){function t(){}return t.TYPE="custom-function",t.DEFAULT_NAME="custom-function",t}();(function(){function t(t,e){void 0===e&&(e=Vr.DEFAULT_NAME),this.providerType=Vr.TYPE,this.providerName=e,this.material=t}Object.defineProperty(t.prototype,"providerCapabilities",{get:function(){return new Fr(!1)},enumerable:!0,configurable:!0})})(),function(){function t(){}t.TYPE="oauth2-google",t.DEFAULT_NAME="oauth2-google"}();!function(t){t.AUTH_CODE="authCode"}(qr||(qr={}));var Br;!function(){function t(){}t.TYPE="api-key",t.DEFAULT_NAME="api-key"}();!function(t){t.KEY="key"}(Br||(Br={}));var Wr,Kr=function(t,e,n){this.providerName=t,this.requestClient=e,this.baseRoute=n};!function(t){t.ID="_id",t.KEY="key",t.NAME="name",t.DISABLED="disabled"}(Wr||(Wr={}));var Gr,Hr=function(){function t(t,e,n,r){this.id=d.b.ObjectID.createFromHexString(t),this.key=e,this.name=n,this.disabled=r}return t.readFromApi=function(e){var n="string"==typeof e?JSON.parse(e):e;return vr.keyPresent(Wr.ID,n),vr.keyPresent(Wr.NAME,n),vr.keyPresent(Wr.DISABLED,n),new t(n[Wr.ID],n[Wr.KEY],n[Wr.NAME],n[Wr.DISABLED])},t.prototype.toJSON=function(){var t;return(t={})[Wr.ID]=this.id,t[Wr.KEY]=this.key,t[Wr.NAME]=this.name,t[Wr.DISABLED]=this.disabled,t},t}(),Yr=function(){function t(){}return t.TYPE="api-key",t.DEFAULT_NAME="api-key",t}(),Jr=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();!function(t){t.NAME="name"}(Gr||(Gr={}));var zr;!function(t){function e(e,n){var r=n.baseAuthRoute+"/api_keys",o=Yr.DEFAULT_NAME;return t.call(this,o,e,r)||this}Jr(e,t),e.prototype.createApiKey=function(t){var e,n=new Kn.Builder;return n.withMethod(jn.POST).withPath(this.baseRoute).withDocument((e={},e[Gr.NAME]=t,e)).withRefreshToken(),this.requestClient.doAuthenticatedRequest(n.build()).then((function(t){return Hr.readFromApi(t.body)})).catch((function(t){throw Fn(t)}))},e.prototype.fetchApiKey=function(t){var e=new Bn.Builder;return e.withMethod(jn.GET).withPath(this.getApiKeyRoute(t.toHexString())),e.withRefreshToken(),this.requestClient.doAuthenticatedRequest(e.build()).then((function(t){return Hr.readFromApi(t.body)})).catch((function(t){throw Fn(t)}))},e.prototype.fetchApiKeys=function(){var t=new Bn.Builder;return t.withMethod(jn.GET).withPath(this.baseRoute),t.withRefreshToken(),this.requestClient.doAuthenticatedRequest(t.build()).then((function(t){var e=JSON.parse(t.body);if(Array.isArray(e))return e.map((function(t){return Hr.readFromApi(t)}));throw new Nn(new Error("unexpected non-array response from server"),bn.DECODING_ERROR)})).catch((function(t){throw Fn(t)}))},e.prototype.deleteApiKey=function(t){var e=new Bn.Builder;return e.withMethod(jn.DELETE).withPath(this.getApiKeyRoute(t.toHexString())),e.withRefreshToken(),this.requestClient.doAuthenticatedRequest(e.build()).then((function(){}))},e.prototype.enableApiKey=function(t){var e=new Bn.Builder;return e.withMethod(jn.PUT).withPath(this.getApiKeyEnableRoute(t.toHexString())),e.withRefreshToken(),this.requestClient.doAuthenticatedRequest(e.build()).then((function(){}))},e.prototype.disableApiKey=function(t){var e=new Bn.Builder;return e.withMethod(jn.PUT).withPath(this.getApiKeyDisableRoute(t.toHexString())),e.withRefreshToken(),this.requestClient.doAuthenticatedRequest(e.build()).then((function(){}))},e.prototype.getApiKeyRoute=function(t){return this.baseRoute+"/"+t},e.prototype.getApiKeyEnableRoute=function(t){return this.getApiKeyRoute(t)+"/enable"},e.prototype.getApiKeyDisableRoute=function(t){return this.getApiKeyRoute(t)+"/disable"}}(Kr);!function(t){t.KEY="key"}(zr||(zr={}));var Zr,Xr,Qr=function(){function t(){}return t.TYPE="local-userpass",t.DEFAULT_NAME="local-userpass",t}(),$r=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();!function(t){t.EMAIL="email",t.PASSWORD="password"}(Zr||(Zr={})),function(t){t.EMAIL="email",t.PASSWORD="password",t.TOKEN="token",t.TOKEN_ID="tokenId",t.ARGS="arguments"}(Xr||(Xr={}));var to;!function(t){function e(e,n,r){void 0===e&&(e=Qr.DEFAULT_NAME);var o=r.getAuthProviderRoute(e);return t.call(this,e,n,o)||this}$r(e,t),e.prototype.registerWithEmailInternal=function(t,e){var n,r=new Jn.Builder;return r.withMethod(jn.POST).withPath(this.getRegisterWithEmailRoute()),r.withDocument(((n={})[Zr.EMAIL]=t,n[Zr.PASSWORD]=e,n)),this.requestClient.doRequest(r.build()).then((function(){}))},e.prototype.confirmUserInternal=function(t,e){var n,r=new Jn.Builder;return r.withMethod(jn.POST).withPath(this.getConfirmUserRoute()),r.withDocument(((n={})[Xr.TOKEN]=t,n[Xr.TOKEN_ID]=e,n)),this.requestClient.doRequest(r.build()).then((function(){}))},e.prototype.resendConfirmationEmailInternal=function(t){var e,n=new Jn.Builder;return n.withMethod(jn.POST).withPath(this.getResendConfirmationEmailRoute()),n.withDocument(((e={})[Xr.EMAIL]=t,e)),this.requestClient.doRequest(n.build()).then((function(){}))},e.prototype.resetPasswordInternal=function(t,e,n){var r,o=new Jn.Builder;return o.withMethod(jn.POST).withPath(this.getResetPasswordRoute()),o.withDocument(((r={})[Xr.TOKEN]=t,r[Xr.TOKEN_ID]=e,r[Xr.PASSWORD]=n,r)),this.requestClient.doRequest(o.build()).then((function(){}))},e.prototype.sendResetPasswordEmailInternal=function(t){var e,n=new Jn.Builder;return n.withMethod(jn.POST).withPath(this.getSendResetPasswordEmailRoute()),n.withDocument(((e={})[Xr.EMAIL]=t,e)),this.requestClient.doRequest(n.build()).then((function(){}))},e.prototype.callResetPasswordFunctionInternal=function(t,e,n){var r,o=new Jn.Builder;return o.withMethod(jn.POST).withPath(this.getCallResetPasswordFunctionRoute()),o.withDocument(((r={})[Xr.EMAIL]=t,r[Xr.PASSWORD]=e,r[Xr.ARGS]=n,r)),this.requestClient.doRequest(o.build()).then((function(){}))},e.prototype.getRegisterWithEmailRoute=function(){return this.getExtensionRoute("register")},e.prototype.getConfirmUserRoute=function(){return this.getExtensionRoute("confirm")},e.prototype.getResendConfirmationEmailRoute=function(){return this.getExtensionRoute("confirm/send")},e.prototype.getResetPasswordRoute=function(){return this.getExtensionRoute("reset")},e.prototype.getSendResetPasswordEmailRoute=function(){return this.getExtensionRoute("reset/send")},e.prototype.getCallResetPasswordFunctionRoute=function(){return this.getExtensionRoute("reset/call")},e.prototype.getExtensionRoute=function(t){return this.baseRoute+"/"+t}}(Kr);!function(t){t.USERNAME="username",t.PASSWORD="password"}(to||(to={}));var eo;!function(t){t.Normal="normal",t.Server="server",t.Unknown="unknown"}(eo||(eo={}));!function(){function t(t){this.suiteName=t,this.storage={}}t.prototype.get=function(t){return this.storage[this.suiteName+"."+t]},t.prototype.set=function(t,e){this.storage[this.suiteName+"."+t]=e},t.prototype.remove=function(t){delete this.storage[this.suiteName+"."+t]}}();var no,ro=function(){};!function(t){t[t.AUTH_EVENT=0]="AUTH_EVENT"}(no||(no={}));var oo=function(){function t(t,e,n){this.serviceField="service",this.argumentsField="arguments",this.requestClient=t,this.serviceRoutes=e,this.serviceName=n,this.serviceBinders=[],this.allocatedStreams=[]}return t.prototype.callFunction=function(t,e,n){return this.requestClient.doAuthenticatedRequestWithDecoder(this.getCallServiceFunctionRequest(t,e),n)},t.prototype.streamFunction=function(t,e,n){var r=this;return this.requestClient.openAuthenticatedStreamWithDecoder(this.getStreamServiceFunctionRequest(t,e),n).then((function(t){return r.allocatedStreams.push(t),t}))},t.prototype.bind=function(t){this.serviceBinders.push(t)},t.prototype.onRebindEvent=function(t){switch(t.type){case no.AUTH_EVENT:t.event.kind===vn.ActiveUserChanged&&this.closeAllocatedStreams()}this.serviceBinders.forEach((function(e){e.onRebindEvent(t)}))},t.prototype.getStreamServiceFunctionRequest=function(t,e){var n={name:t};void 0!==this.serviceName&&(n[this.serviceField]=this.serviceName),n[this.argumentsField]=e;var r,o,i=new Bn.Builder;return i.withMethod(jn.GET).withPath(this.serviceRoutes.functionCallRoute+"?stitch_request="+encodeURIComponent((r=d.a.stringify(n),"undefined"==typeof Uint8Array&&(o=ur(r)),o=new Uint8Array(ur(r)),Object(nt.fromByteArray)(o)))),i.build()},t.prototype.getCallServiceFunctionRequest=function(t,e){var n={name:t};void 0!==this.serviceName&&(n[this.serviceField]=this.serviceName),n[this.argumentsField]=e;var r=new Kn.Builder;return r.withMethod(jn.POST).withPath(this.serviceRoutes.functionCallRoute),r.withDocument(n),r.build()},t.prototype.closeAllocatedStreams=function(){this.allocatedStreams.forEach((function(t){t.isOpen()&&t.close()})),this.allocatedStreams=[]},t}(),io=(function(){function t(t,e){this.functionService=new oo(t,e.serviceRoutes)}t.prototype.callFunction=function(t,e,n){return this.functionService.callFunction(t,e,n)}}(),function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}),so=(function(){function t(t){this.reconnecter=t,this.closed=!1,this.events=[],this.listeners=[],this.lastErr=void 0}t.prototype.isOpen=function(){return!this.closed},t.prototype.addListener=function(t){var e=this;this.closed?setTimeout((function(){return t.onEvent(new $n(tr.ERROR_EVENT_NAME,"stream closed"))}),0):void 0===this.lastErr?(this.listeners.push(t),this.poll()):setTimeout((function(){return t.onEvent(new $n(tr.ERROR_EVENT_NAME,e.lastErr))}),0)},t.prototype.removeListener=function(t){var e=this.listeners.indexOf(t);-1!==e&&this.listeners.splice(e,1)},t.prototype.nextEvent=function(){var t=this;return this.closed?Promise.reject(new $n(tr.ERROR_EVENT_NAME,"stream closed")):void 0!==this.lastErr?Promise.reject(new $n(tr.ERROR_EVENT_NAME,this.lastErr)):new Promise((function(e,n){t.listenOnce({onEvent:function(t){e(t)}})}))},t.prototype.close=function(){this.closed||(this.closed=!0,this.afterClose())},t.prototype.reconnect=function(e){var n=this;this.reconnecter?this.reconnecter().then((function(t){n.onReconnect(t)})).catch((function(r){if(!(r instanceof In&&r instanceof Nn))return n.closed=!0,n.events.push(new $n(tr.ERROR_EVENT_NAME,"stream closed: "+e)),void n.poll();setTimeout((function(){return n.reconnect(r)}),t.RETRY_TIMEOUT_MILLIS)})):this.closed||(this.closed=!0,this.events.push(new $n(tr.ERROR_EVENT_NAME,"stream closed: "+e)),this.poll())},t.prototype.poll=function(){for(var t,e;0!==this.events.length;){var n=this.events.pop();try{for(var r=io(this.listeners),o=r.next();!o.done;o=r.next()){var i=o.value;i.onEvent&&i.onEvent(n)}}catch(s){t={error:s}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}}},t.prototype.listenOnce=function(t){var e=this;if(this.closed)setTimeout((function(){return t.onEvent(new $n(tr.ERROR_EVENT_NAME,"stream closed"))}),0);else if(void 0===this.lastErr){var n={onEvent:function(r){e.removeListener(n),t.onEvent(r)}};this.addListener(n)}else setTimeout((function(){return t.onEvent(new $n(tr.ERROR_EVENT_NAME,e.lastErr))}),0)},t.RETRY_TIMEOUT_MILLIS=5e3}(),function(t,e,n,r){this.method=t,this.url=e,this.headers=n,this.body=r});!function(t){var e=function(){function e(t){t&&(this.method=t.method,this.url=t.url,this.headers=t.headers,this.body=t.body)}return e.prototype.withMethod=function(t){return this.method=t,this},e.prototype.withUrl=function(t){return this.url=t,this},e.prototype.withHeaders=function(t){return this.headers=t,this},e.prototype.withBody=function(t){return this.body=t,this},e.prototype.build=function(){if(void 0===this.method)throw new Error("must set method");if(void 0===this.url)throw new Error("must set non-empty url");return new t(this.method,this.url,void 0===this.headers?{}:this.headers,this.body)},e}();t.Builder=e}(so||(so={}));function uo(t){return"/api/client/v2.0/app/"+t}function ao(t){return uo(t)+"/functions/call"}function co(t,e){return uo(t)+"/auth/providers/"+e}function ho(t,e){return co(t,e)+"/login"}var fo,po=function(){function t(t){var e=this;this.baseAuthRoute="/api/client/v2.0/auth",this.sessionRoute=e.baseAuthRoute+"/session",this.profileRoute=e.baseAuthRoute+"/profile",this.clientAppId=t}return t.prototype.getAuthProviderRoute=function(t){return co(this.clientAppId,t)},t.prototype.getAuthProviderLoginRoute=function(t){return ho(this.clientAppId,t)},t.prototype.getAuthProviderLinkRoute=function(t){return function(t,e){return ho(t,e)+"?link=true"}(this.clientAppId,t)},t.prototype.getAuthProviderExtensionRoute=function(t,e){return this.getAuthProviderRoute(t)+"/"+e},t}();!function(t){t.DEPLOYMENT_MODEL="deployment_model",t.LOCATION="location",t.HOSTNAME="hostname"}(fo||(fo={}));var lo=function(){function t(t,e,n){this.deploymentModel=t,this.location=e,this.hostname=n}return t.fromJSON=function(e){return new t(e[fo.DEPLOYMENT_MODEL],e[fo.LOCATION],e[fo.HOSTNAME])},t.prototype.toJSON=function(){var t;return(t={})[fo.DEPLOYMENT_MODEL]=this.deploymentModel,t[fo.LOCATION]=this.location,t[fo.HOSTNAME]=this.hostname,t},t}();var vo=function(){function t(t,e){this.baseUrl=t,this.transport=e}return t.prototype.doRequestToURL=function(t,e){return this.transport.roundTrip(this.buildRequest(t,e)).catch((function(t){throw new Nn(t,bn.TRANSPORT_ERROR)})).then((function(t){return(e=t).statusCode>=200&&e.statusCode<300?e:Mn(e);var e}))},t.prototype.doStreamRequestToURL=function(t,e,n,r){return void 0===n&&(n=!0),this.transport.stream(this.buildRequest(t,e),n,r).catch((function(t){if(t instanceof In)throw t;throw new Nn(t,bn.TRANSPORT_ERROR)}))},t.prototype.buildRequest=function(t,e){return(new so.Builder).withMethod(t.method).withUrl(""+e+t.path).withHeaders(t.headers).withBody(t.body).build()},t}(),yo=function(t){this.clientAppId=t,this.functionCallRoute=ao(t)},go=function(t){this.clientAppId=t,this.authRoutes=new po(t),this.serviceRoutes=new yo(t),this.appMetadataRoute=function(t){return uo(t)+"/location"}(t),this.functionCallRoute=ao(t)},mo=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Eo=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{a(r.next(t))}catch(e){i(e)}}function u(t){try{a(r.throw(t))}catch(e){i(e)}}function a(t){t.done?o(t.value):new n((function(e){e(t.value)})).then(s,u)}a((r=r.apply(t,e||[])).next())}))},Ao=function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(u){i=[6,u],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},wo=(function(t){function e(e,n,r){var o=t.call(this,n,r)||this;return o.clientAppId=e,o.routes=new go(e),o}mo(e,t),e.prototype.doRequest=function(e){var n=this;return this.initAppMetadata().then((function(r){return t.prototype.doRequestToURL.call(n,e,r.hostname)}))},e.prototype.doStreamRequest=function(e,n,r){var o=this;return void 0===n&&(n=!0),this.initAppMetadata().then((function(i){return t.prototype.doStreamRequestToURL.call(o,e,i.hostname,n,r)}))},e.prototype.getBaseURL=function(){return Eo(this,void 0,void 0,(function(){return Ao(this,(function(t){return[2,this.initAppMetadata().then((function(t){return t.hostname}))]}))}))},e.prototype.initAppMetadata=function(){var e=this;if(this.appMetadata)return Promise.resolve(this.appMetadata);var n=(new qn.Builder).withMethod(jn.GET).withPath(this.routes.appMetadataRoute).build();return t.prototype.doRequestToURL.call(this,n,this.baseUrl).then((function(t){return e.appMetadata=lo.fromJSON(d.a.parse(t.body)),e.appMetadata}))}}(vo),function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),Ro=(function(t){function e(e,n){return t.call(this,e,n)||this}wo(e,t),e.prototype.doRequest=function(e){return t.prototype.doRequestToURL.call(this,e,this.baseUrl)},e.prototype.doStreamRequest=function(e,n,r){return void 0===n&&(n=!0),t.prototype.doStreamRequestToURL.call(this,e,this.baseUrl,n,r)},e.prototype.getBaseURL=function(){return Promise.resolve(this.baseUrl)}}(vo),function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),bo=(function(t){function e(e){var n=t.call(this)||this;return n.type=no.AUTH_EVENT,n.event=e,n}Ro(e,t)}(ro),function(){function t(t,e,n,r){this.baseUrl=t,this.storage=e,this.dataDirectory=n,this.transport=r}return t.prototype.builder=function(){return new t.Builder(this)},t}());!function(t){var e=function(){function e(t){t&&(this.baseUrl=t.baseUrl,this.storage=t.storage,this.dataDirectory=t.dataDirectory,this.transport=t.transport)}return e.prototype.withBaseUrl=function(t){return this.baseUrl=t,this},e.prototype.withStorage=function(t){return this.storage=t,this},e.prototype.withDataDirectory=function(t){return this.dataDirectory=t,this},e.prototype.withTransport=function(t){return this.transport=t,this},e.prototype.build=function(){return new t(this.baseUrl,this.storage,this.dataDirectory,this.transport)},e}();t.Builder=e}(bo||(bo={}));var Io=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Oo=function(t){function e(e,n,r){var o=t.call(this,e.baseUrl,e.storage,e.dataDirectory,e.transport)||this;return o.localAppVersion=r,o.localAppName=n,o}return Io(e,t),e.prototype.builder=function(){return new e.Builder(this)},e}(bo);!function(t){var e=function(e){function n(t){var n=e.call(this,t)||this;return t&&(n.localAppVersion=t.localAppVersion,n.localAppName=t.localAppName),n}return Io(n,e),n.prototype.withLocalAppName=function(t){return this.localAppName=t,this},n.prototype.withLocalAppVersion=function(t){return this.localAppVersion=t,this},n.prototype.build=function(){var n=e.prototype.build.call(this);return new t(n,this.localAppName,this.localAppVersion)},n}(bo.Builder);t.Builder=e}(Oo||(Oo={}));var _o;function To(t){switch(t){case"insert":return _o.Insert;case"delete":return _o.Delete;case"replace":return _o.Replace;case"update":return _o.Update;default:return _o.Unknown}}!function(t){t.Insert="insert",t.Delete="delete",t.Replace="replace",t.Update="update",t.Unknown="unknown"}(_o||(_o={}));var No,Po,So,Uo,ko,Do,Co,Lo=function(t){var e={};t.forEach((function(t,n){e[n]=t})),this.insertedIds=e};!function(t){t.InsertedIds="insertedIds"}(No||(No={})),function(t){t.InsertedId="insertedId"}(Po||(Po={})),function(t){t.MatchedCount="matchedCount",t.ModifiedCount="modifiedCount",t.UpsertedId="upsertedId"}(So||(So={})),function(t){t.DeletedCount="deletedCount"}(Uo||(Uo={})),function(t){t.UpdatedFields="updatedFields",t.RemovedFields="removedFields"}(ko||(ko={})),function(t){t.Id="_id",t.OperationType="operationType",t.FullDocument="fullDocument",t.DocumentKey="documentKey",t.Namespace="ns",t.NamespaceDb="db",t.NamespaceColl="coll",t.UpdateDescription="updateDescription"}(Do||(Do={})),function(t){t.OperationType="ot",t.FullDocument="fd",t.DocumentKey="dk",t.UpdateDescription="ud",t.StitchDocumentVersion="sdv",t.StitchDocumentHash="sdh"}(Co||(Co={}));var xo=function(){function t(){}return t.prototype.decode=function(t){return new Lo(t[No.InsertedIds])},t}(),Fo=function(){function t(){}return t.prototype.decode=function(t){return{insertedId:t[Po.InsertedId]}},t}(),Mo=function(){function t(){}return t.prototype.decode=function(t){return{matchedCount:t[So.MatchedCount],modifiedCount:t[So.ModifiedCount],upsertedId:t[So.UpsertedId]}},t}(),jo=function(){function t(){}return t.prototype.decode=function(t){return{deletedCount:t[Uo.DeletedCount]}},t}(),qo=function(){function t(){}return t.prototype.decode=function(t){return vr.keyPresent(ko.UpdatedFields,t),vr.keyPresent(ko.RemovedFields,t),{removedFields:t[ko.RemovedFields],updatedFields:t[ko.UpdatedFields]}},t}();function Vo(t,e,n,r){var o,i;return o=e in t?Go.updateDescriptionDecoder.decode(t[e]):void 0,n in t?(i=t[n],r&&(i=r.decode(i))):i=void 0,{updateDescription:o,fullDocument:i}}var Bo,Wo=function(){function t(t){this.decoder=t}return t.prototype.decode=function(t){vr.keyPresent(Do.Id,t),vr.keyPresent(Do.OperationType,t),vr.keyPresent(Do.Namespace,t),vr.keyPresent(Do.DocumentKey,t);var e=t[Do.Namespace],n=Vo(t,Do.UpdateDescription,Do.FullDocument,this.decoder),r=n.updateDescription,o=n.fullDocument;return{documentKey:t[Do.DocumentKey],fullDocument:o,id:t[Do.Id],namespace:{collection:e[Do.NamespaceColl],database:e[Do.NamespaceDb]},operationType:To(t[Do.OperationType]),updateDescription:r}},t}(),Ko=function(){function t(t){this.decoder=t}return t.prototype.decode=function(t){vr.keyPresent(Co.OperationType,t),vr.keyPresent(Co.DocumentKey,t);var e,n,r=Vo(t,Co.UpdateDescription,Co.FullDocument,this.decoder),o=r.updateDescription,i=r.fullDocument;return e=Co.StitchDocumentVersion in t?t[Co.StitchDocumentVersion]:void 0,n=Co.StitchDocumentHash in t?t[Co.StitchDocumentHash]:void 0,{documentKey:t[Co.DocumentKey],fullDocument:i,operationType:To(t[Co.OperationType]),stitchDocumentHash:n,stitchDocumentVersion:e,updateDescription:o}},t}(),Go=function(){function t(){}return t.remoteInsertManyResultDecoder=new xo,t.remoteInsertOneResultDecoder=new Fo,t.remoteUpdateResultDecoder=new Mo,t.remoteDeleteResultDecoder=new jo,t.updateDescriptionDecoder=new qo,t.ChangeEventDecoder=Wo,t.CompactChangeEventDecoder=Ko,t}(),Ho=Go,Yo=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},Jo=function(){function t(t,e,n,r){var o=this;this.name=t,this.databaseName=e,this.service=n,this.codec=r,this.namespace=this.databaseName+"."+this.name,this.baseOperationArgs={collection:o.name,database:o.databaseName}}return t.prototype.withCollectionType=function(e){return new t(this.name,this.databaseName,this.service,e)},t.prototype.find=function(t,e){void 0===t&&(t={});var n=Yo({},this.baseOperationArgs);return n.query=t,e&&(e.limit&&(n.limit=e.limit),e.projection&&(n.project=e.projection),e.sort&&(n.sort=e.sort)),new mn("find",n,this.service,this.codec)},t.prototype.findOne=function(t,e){void 0===t&&(t={});var n=Yo({},this.baseOperationArgs);return n.query=t,e&&(e.projection&&(n.project=e.projection),e.sort&&(n.sort=e.sort)),this.service.callFunction("findOne",[n],this.codec)},t.prototype.findOneAndUpdate=function(t,e,n){var r=Yo({},this.baseOperationArgs);return r.filter=t,r.update=e,n&&(n.projection&&(r.projection=n.projection),n.sort&&(r.sort=n.sort),n.upsert&&(r.upsert=!0),n.returnNewDocument&&(r.returnNewDocument=!0)),this.service.callFunction("findOneAndUpdate",[r],this.codec)},t.prototype.findOneAndReplace=function(t,e,n){var r=Yo({},this.baseOperationArgs);return r.filter=t,r.update=e,n&&(n.projection&&(r.projection=n.projection),n.sort&&(r.sort=n.sort),n.upsert&&(r.upsert=!0),n.returnNewDocument&&(r.returnNewDocument=!0)),this.service.callFunction("findOneAndReplace",[r],this.codec)},t.prototype.findOneAndDelete=function(t,e){var n=Yo({},this.baseOperationArgs);return n.filter=t,e&&(e.projection&&(n.projection=e.projection),e.sort&&(n.sort=e.sort)),this.service.callFunction("findOneAndDelete",[n],this.codec)},t.prototype.aggregate=function(t){var e=Yo({},this.baseOperationArgs);return e.pipeline=t,new mn("aggregate",e,this.service,this.codec)},t.prototype.count=function(t,e){void 0===t&&(t={});var n=Yo({},this.baseOperationArgs);return n.query=t,e&&e.limit&&(n.limit=e.limit),this.service.callFunction("count",[n])},t.prototype.insertOne=function(t){var e=Yo({},this.baseOperationArgs);return e.document=this.generateObjectIdIfMissing(this.codec?this.codec.encode(t):t),this.service.callFunction("insertOne",[e],Ho.remoteInsertOneResultDecoder)},t.prototype.insertMany=function(t){var e=this,n=Yo({},this.baseOperationArgs);return n.documents=t.map((function(t){return e.generateObjectIdIfMissing(e.codec?e.codec.encode(t):t)})),this.service.callFunction("insertMany",[n],Ho.remoteInsertManyResultDecoder)},t.prototype.deleteOne=function(t){return this.executeDelete(t,!1)},t.prototype.deleteMany=function(t){return this.executeDelete(t,!0)},t.prototype.updateOne=function(t,e,n){return this.executeUpdate(t,e,n,!1)},t.prototype.updateMany=function(t,e,n){return this.executeUpdate(t,e,n,!0)},t.prototype.watch=function(t){var e=Yo({},this.baseOperationArgs);return void 0!==t&&(t instanceof Array?0!==t.length&&(e.ids=t):t instanceof Object&&(e.filter=t)),e.useCompactEvents=!1,this.service.streamFunction("watch",[e],new Ho.ChangeEventDecoder(this.codec))},t.prototype.watchCompact=function(t){var e=Yo({},this.baseOperationArgs);return e.ids=t,e.useCompactEvents=!0,this.service.streamFunction("watch",[e],new Ho.CompactChangeEventDecoder(this.codec))},t.prototype.executeDelete=function(t,e){var n=Yo({},this.baseOperationArgs);return n.query=t,this.service.callFunction(e?"deleteMany":"deleteOne",[n],Ho.remoteDeleteResultDecoder)},t.prototype.executeUpdate=function(t,e,n,r){void 0===r&&(r=!1);var o=Yo({},this.baseOperationArgs);return o.query=t,o.update=e,n&&n.upsert&&(o.upsert=n.upsert),this.service.callFunction(r?"updateMany":"updateOne",[o],Ho.remoteUpdateResultDecoder)},t.prototype.generateObjectIdIfMissing=function(t){if(!t._id){var e=t;return e._id=new d.b.ObjectID,e}return t},t}(),zo=function(){function t(t,e){this.name=t,this.service=e}return t.prototype.collection=function(t,e){return new Jo(t,this.name,this.service,e)},t}(),Zo=function(){function t(t){this.service=t}return t.prototype.db=function(t){return new zo(t,this.service)},t}(),Xo=function(){function t(t){this.proxy=t}return t.prototype.next=function(){return Promise.resolve(this.proxy.next().value)},t}(),Qo=function(){function t(t){this.proxy=t}return t.prototype.first=function(){return this.proxy.first()},t.prototype.toArray=function(){return this.proxy.toArray()},t.prototype.asArray=function(){return this.toArray()},t.prototype.iterator=function(){return this.proxy.iterator().then((function(t){return new Xo(t)}))},t}(),$o=function(){function t(t){this.proxy=t,this.namespace=this.proxy.namespace}return t.prototype.withCollectionType=function(e){return new t(this.proxy.withCollectionType(e))},t.prototype.count=function(t,e){return this.proxy.count(t,e)},t.prototype.find=function(t,e){return new Qo(this.proxy.find(t,e))},t.prototype.findOne=function(t,e){return this.proxy.findOne(t,e)},t.prototype.findOneAndUpdate=function(t,e,n){return this.proxy.findOneAndUpdate(t,e,n)},t.prototype.findOneAndReplace=function(t,e,n){return this.proxy.findOneAndReplace(t,e,n)},t.prototype.findOneAndDelete=function(t,e){return this.proxy.findOneAndDelete(t,e)},t.prototype.aggregate=function(t){return new Qo(this.proxy.aggregate(t))},t.prototype.insertOne=function(t){return this.proxy.insertOne(t)},t.prototype.insertMany=function(t){return this.proxy.insertMany(t)},t.prototype.deleteOne=function(t){return this.proxy.deleteOne(t)},t.prototype.deleteMany=function(t){return this.proxy.deleteMany(t)},t.prototype.updateOne=function(t,e,n){return this.proxy.updateOne(t,e,n)},t.prototype.updateMany=function(t,e,n){return this.proxy.updateMany(t,e,n)},t.prototype.watch=function(t){return this.proxy.watch(t)},t.prototype.watchCompact=function(t){return this.proxy.watchCompact(t)},t}(),ti=function(){function t(t){this.proxy=t,this.name=this.proxy.name}return t.prototype.collection=function(t,e){return new $o(this.proxy.collection(t,e))},t}(),ei=function(){function t(t){this.proxy=t}return t.prototype.db=function(t){return new ti(this.proxy.db(t))},t}();(Bo||(Bo={})).factory=new(function(){function t(){}return t.prototype.getNamedClient=function(t,e){return new ei(new Zo(t))},t}());var ni,ri=n("IqlA").a?(ni="feedback-ibcyy",gn.hasAppClient(ni)?gn.getAppClient(ni):gn.initializeAppClient(ni)):{auth:{}};function oi(){return(oi=Object(u.a)(s.a.mark((function t(){var e;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(ri.auth.user){t.next=7;break}return t.next=3,ri.auth.loginWithCredential(new Mt);case 3:return e=t.sent,t.abrupt("return",e);case 7:return t.abrupt("return",ri.auth.user);case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var ii=function(){var t=h.a.useState(ri.auth.user),e=t[0],n=t[1];return h.a.useEffect((function(){(function(){return oi.apply(this,arguments)})().then(n)}),[]),e};function si(t){return ui.apply(this,arguments)}function ui(){return(ui=Object(u.a)(s.a.mark((function t(e){var n,r,o,i;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.page,r=e.user,o=Object(a.a)(e,["page","user"]),t.next=3,ri.callFunction("feedback_create",[Object.assign({page:n,user:r},o)]);case 3:return i=t.sent,t.abrupt("return",i);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ai(t){return ci.apply(this,arguments)}function ci(){return(ci=Object(u.a)(s.a.mark((function t(e){var n,r,o;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.feedback_id,r=Object(a.a)(e,["feedback_id"]),n){t.next=3;break}throw new Error("Must specify a feedback item _id to update");case 3:return t.next=5,ri.callFunction("feedback_update",[Object.assign({feedback_id:n},r)]);case 5:return o=t.sent,t.abrupt("return",o);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function hi(t){return di.apply(this,arguments)}function di(){return(di=Object(u.a)(s.a.mark((function t(e){var n,r;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.feedback_id){t.next=3;break}throw new Error("Must specify a feedback item _id to submit");case 3:return t.next=5,ri.callFunction("feedback_submit",[{feedback_id:n}]);case 5:return r=t.sent,t.abrupt("return",r);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function fi(t){return pi.apply(this,arguments)}function pi(){return(pi=Object(u.a)(s.a.mark((function t(e){var n,r;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.feedback_id){t.next=3;break}throw new Error("Must specify a feedback item _id to abandon");case 3:return t.next=5,ri.callFunction("feedback_abandon",[{feedback_id:n}]);case 5:return r=t.sent,t.abrupt("return",1===r.modifiedCount);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function li(t){return vi.apply(this,arguments)}function vi(){return(vi=Object(u.a)(s.a.mark((function t(e){var n,r,o;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.feedback_id,r=e.attachment,n){t.next=3;break}throw new Error("Must specify a feedback item _id to add an attachment to");case 3:return t.next=5,ri.callFunction("feedback_addAttachment",[{feedback_id:n,attachment:r}]);case 5:return o=t.sent,t.abrupt("return",o);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function yi(){if(window.analytics){var t=window.analytics.user(),e=t.id();return{isAnonymous:!Boolean(e),id:e?e.toString():t.anonymousId().toString()}}return{isAnonymous:!0,id:"<notrack>"}}var gi=n("dTkW"),mi=n("qKvR"),Ei=h.a.createContext();function Ai(t){var e=t.page,n=t.hideHeader,r=t.test,o=void 0===r?{}:r,i=Object(a.a)(t,["page","hideHeader","test"]),c=h.a.useState(o.feedback!=={}&&o.feedback||null),d=c[0],f=c[1],p=h.a.useState(o.isSupportRequest||!1),l=p[0],v=p[1],y=h.a.useState(o.view||"waiting"),g=y[0],m=y[1],E=ii();function A(t){return w.apply(this,arguments)}function w(){return(w=Object(u.a)(s.a.mark((function t(n){var r,i,u,a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===n&&(n="rating"),r=yi(),i=Object.assign({page:{title:e.title,slug:e.slug,url:e.url,docs_property:e.docs_property,docs_version:null},user:{stitch_id:E&&E.id,segment_id:r.id,isAnonymous:r.isAnonymous},viewport:Object(gi.b)()},o.feedback),t.next=5,si(i);case 5:return u=t.sent,a=u._id,f(Object.assign({_id:a},i)),m(n),t.abrupt("return",Object.assign({_id:a},i));case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function R(){return(R=Object(u.a)(s.a.mark((function t(e){var n,r;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!d||!d.rating){t.next=2;break}return t.abrupt("return");case 2:if(!d){t.next=6;break}t.t0=d._id,t.next=9;break;case 6:return t.next=8,A("waiting");case 8:t.t0=t.sent._id;case 9:if(n=t.t0,"number"==typeof e){t.next=12;break}throw new Error("Rating value must be a number.");case 12:if(!(e<1||e>5)){t.next=14;break}throw new Error("Rating value must be between 1 and 5, inclusive.");case 14:return t.next=16,ai({feedback_id:d?d._id:n,rating:e});case 16:r=t.sent,f(r),m("qualifiers");case 19:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function b(){return(b=Object(u.a)(s.a.mark((function t(e,n){var r;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(d){t.next=2;break}return t.abrupt("return");case 2:if("string"==typeof e){t.next=4;break}throw new Error("id must be a string Qualifier ID.");case 4:if("boolean"==typeof n){t.next=6;break}throw new Error("value must be a boolean.");case 6:return t.next=8,ai({feedback_id:d._id,qualifiers:wi(d.qualifiers,e,n)});case 8:r=t.sent,f(r);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function I(){return(I=Object(u.a)(s.a.mark((function t(e){var n,r,o;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.dataUri,r=e.viewport,d){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,li({feedback_id:d._id,attachment:{type:"screenshot",dataUri:n,viewport:r}});case 5:o=t.sent,f(o);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function O(){return(O=Object(u.a)(s.a.mark((function t(e){var n,r,o,i,u;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.comment,r=void 0===n?"":n,o=e.email,i=void 0===o?"":o,d){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,ai({feedback_id:d._id,comment:r,user:{email:i}});case 5:u=t.sent,f(u);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function _(){return(_=Object(u.a)(s.a.mark((function t(){var e;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,hi({feedback_id:d._id});case 2:e=t.sent,f(e),m(l?"support":"submitted");case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function T(){return(T=Object(u.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(d){t.next=2;break}return t.abrupt("return");case 2:m("submitted");case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function N(){return(N=Object(u.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(m("waiting"),!d){t.next=5;break}return t.next=4,fi({feedback_id:d._id});case 4:f(null);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var P={feedback:d,view:g,isSupportRequest:l,initializeFeedback:A,setRating:function(t){return R.apply(this,arguments)},setQualifier:function(t,e){return b.apply(this,arguments)},submitQualifiers:function(){if(d){var t=d.qualifiers.find((function(t){return"support"===t.id&&!0===t.value}));v(Boolean(t)),m("comment")}},submitComment:function(t){return O.apply(this,arguments)},submitScreenshot:function(t){return I.apply(this,arguments)},submitSupport:function(){return T.apply(this,arguments)},submitAllFeedback:function(){return _.apply(this,arguments)},abandon:function(){return N.apply(this,arguments)},hideHeader:n};return Object(mi.d)(Ei.Provider,{value:P},i.children)}function wi(t,e,n){var r=t.findIndex((function(t){return t.id===e}));return[].concat(Object(o.a)(t.slice(0,r)),[Object.assign({},t[r],{value:n})],Object(o.a)(t.slice(r+1)))}function Ri(){var t=h.a.useContext(Ei);if(!t&&null!==t)throw new Error("You must nest useFeedbackState() inside of a FeedbackProvider.");return t}},"dBg+":function(t,e){e.f=Object.getOwnPropertySymbols},dTkW:function(t,e,n){"use strict";n.d(e,"b",(function(){return s})),n.d(e,"a",(function(){return u}));var r=n("q1tI"),o=n.n(r),i=n("IqlA");function s(){return i.a?{width:Math.max(document.documentElement.clientWidth,window.innerWidth||0),height:Math.max(document.documentElement.clientHeight,window.innerHeight||0),scrollY:Math.max(window.pageYOffset,document.documentElement.scrollTop,document.body.scrollTop||0),scrollX:Math.max(window.pageXOffset,document.documentElement.scrollLeft,document.body.scrollLeft||0)}:{}}function u(){var t=o.a.useState(s()),e=t[0],n=t[1],r=function(){n(s())};return o.a.useEffect((function(){var t,e,n,o=(t=r,e=200,n=null,function(){clearTimeout(n),n=setTimeout((function(){t.apply(this,arguments)}),e)});return window.addEventListener("resize",o),window.addEventListener("scroll",o),function(){window.removeEventListener("resize",o),window.removeEventListener("scroll",o)}}),[]),e}},"eDl+":function(t,e){t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},f5p1:function(t,e,n){var r=n("2oRo"),o=n("iSVu"),i=r.WeakMap;t.exports="function"==typeof i&&/native code/.test(o(i))},"g6v/":function(t,e,n){var r=n("0Dky");t.exports=!r((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},glrk:function(t,e,n){var r=n("hh1v");t.exports=function(t){if(!r(t))throw TypeError(String(t)+" is not an object");return t}},hh1v:function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},iSVu:function(t,e,n){var r=n("xs3f"),o=Function.toString;"function"!=typeof r.inspectSource&&(r.inspectSource=function(t){return o.call(t)}),t.exports=r.inspectSource},kOOl:function(t,e){var n=0,r=Math.random();t.exports=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++n+r).toString(36)}},kRJp:function(t,e,n){var r=n("g6v/"),o=n("m/L8"),i=n("XGwC");t.exports=r?function(t,e,n){return o.f(t,e,i(1,n))}:function(t,e,n){return t[e]=n,t}},lMq5:function(t,e,n){var r=n("0Dky"),o=/#|\.prototype\./,i=function(t,e){var n=u[s(t)];return n==c||n!=a&&("function"==typeof e?r(e):!!e)},s=i.normalize=function(t){return String(t).replace(o,".").toLowerCase()},u=i.data={},a=i.NATIVE="N",c=i.POLYFILL="P";t.exports=i},"m/L8":function(t,e,n){var r=n("g6v/"),o=n("DPsx"),i=n("glrk"),s=n("wE6v"),u=Object.defineProperty;e.f=r?u:function(t,e,n){if(i(t),e=s(e,!0),i(n),o)try{return u(t,e,n)}catch(r){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},p532:function(t,e,n){"use strict";var r=n("I+eb"),o=n("xDBR"),i=n("/qmn"),s=n("0Dky"),u=n("0GbY"),a=n("SEBh"),c=n("zfnd"),h=n("busE");r({target:"Promise",proto:!0,real:!0,forced:!!i&&s((function(){i.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(t){var e=a(this,u("Promise")),n="function"==typeof t;return this.then(n?function(n){return c(e,t()).then((function(){return n}))}:t,n?function(n){return c(e,t()).then((function(){throw n}))}:t)}}),o||"function"!=typeof i||i.prototype.finally||h(i.prototype,"finally",u("Promise").prototype.finally)},ppGB:function(t,e){var n=Math.ceil,r=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?r:n)(t)}},pv8m:function(t,e,n){"use strict";n.r(e);var r=n("wx14"),o=(n("q1tI"),n("EfB0")),i=n("qKvR");e.default=function(t){return Object(i.d)(o.a,Object(r.a)({className:"feedback-tooltip"},t))}},qpwQ:function(t,e,n){"use strict";(function(e){t.exports={fetch:e.fetch}}).call(this,n("yLpj"))},tiKp:function(t,e,n){var r=n("2oRo"),o=n("VpIT"),i=n("UTVS"),s=n("kOOl"),u=n("STAE"),a=n("/b8u"),c=o("wks"),h=r.Symbol,d=a?h:h&&h.withoutSetter||s;t.exports=function(t){return i(c,t)||(u&&i(h,t)?c[t]=h[t]:c[t]=d("Symbol."+t)),c[t]}},v0vc:function(t,e,n){"use strict";n.d(e,"a",(function(){return v})),n.d(e,"b",(function(){return y})),n.d(e,"c",(function(){return g}));var r=n("wTIg"),o=n("q1tI"),i=n.n(o),s=n("d77F"),u=n("qKvR"),a=n("IqlA"),c=n("fxY1"),h=n("MKeS"),d=n("bpZ4");var f=Object(h.a)((function(){return n.e(0).then(n.bind(null,"pv8m"))}));var p=c.a.yellow.base,l=c.a.gray.light2,v={1:"Not at all",2:"A little",3:"Somewhat",4:"Very",5:"Extremely"},y=Object(r.a)("div",{target:"eqdvr4s0"})({name:"1hw29i9",styles:"margin-top:12px;"});function g(t){var e=t.size,n=void 0===e?"3x":e,r=i.a.useState(null),o=r[0],c=r[1],h=Object(s.b)(),d=h.feedback,f=h.setRating,p=d&&d.rating;return a.a&&Object(u.d)(E,{size:n},[1,2,3,4,5].map((function(t){var e=p?p>=t:o>=t,r=o===t;return Object(u.d)(m,{key:t,ratingValue:t,isHighlighted:e,shouldShowTooltip:r&&!p,onClick:function(){return f(t)},onMouseEnter:function(){return c(t)},onMouseLeave:function(){return c(null)},size:n})})))}function m(t){var e=t.ratingValue,n=t.isHighlighted,r=t.shouldShowTooltip,o=t.size,i=t.onClick,s=t.onMouseEnter,a=t.onMouseLeave;return Object(u.d)("div",{onClick:i,onMouseLeave:a},Object(u.d)(f,{key:"star-"+o+"-"+e,id:"star-"+o+"-"+e,align:"bottom",justify:"middle",triggerEvent:"hover",open:r,usePortal:!1,trigger:Object(u.d)(A,null,Object(u.d)(d.d,{size:o,onMouseEnter:s,style:{color:n?p:l}}))},(v[e]+" helpful").replace(/\s/g," ")))}var E=Object(r.a)("div",{target:"eqdvr4s1"})((function(t){return Object(u.c)("display:flex;flex-direction:row;width:",function(t){switch(t){case"lg":return"140px";case"2x":case"3x":default:return"100%"}}(t.size),";justify-content:space-between;margin:",function(t){switch(t){case"lg":return"0";case"2x":return"16px 0 32px 0";case"3x":return"32px 0 20px 0";default:return"20px 0 20px 0"}}(t.size),";")}),""),A=Object(r.a)("div",{target:"eqdvr4s2"})({name:"4g6ai3",styles:"cursor:pointer;"})},wE6v:function(t,e,n){var r=n("hh1v");t.exports=function(t,e){if(!r(t))return t;var n,o;if(e&&"function"==typeof(n=t.toString)&&!r(o=n.call(t)))return o;if("function"==typeof(n=t.valueOf)&&!r(o=n.call(t)))return o;if(!e&&"function"==typeof(n=t.toString)&&!r(o=n.call(t)))return o;throw TypeError("Can't convert object to primitive value")}},xDBR:function(t,e){t.exports=!1},xrYK:function(t,e){var n={}.toString;t.exports=function(t){return n.call(t).slice(8,-1)}},xs3f:function(t,e,n){var r=n("2oRo"),o=n("zk60"),i=r["__core-js_shared__"]||o("__core-js_shared__",{});t.exports=i},yLpj:function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(r){"object"==typeof window&&(n=window)}t.exports=n},yNLB:function(t,e,n){var r=n("0Dky"),o=n("WJkJ");t.exports=function(t){return r((function(){return!!o[t]()||"​᠎"!="​᠎"[t]()||o[t].name!==t}))}},yoRg:function(t,e,n){var r=n("UTVS"),o=n("/GqU"),i=n("TWQb").indexOf,s=n("0BK2");t.exports=function(t,e){var n,u=o(t),a=0,c=[];for(n in u)!r(s,n)&&r(u,n)&&c.push(n);for(;e.length>a;)r(u,n=e[a++])&&(~i(c,n)||c.push(n));return c}},z4o4:function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return a}));var r=n("q1tI"),o=n.n(r),i=n("v0vc"),s=n("d77F"),u=n("qKvR");function a(t){var e=t.isVisible,n=void 0===e||e,r=Object(s.b)().hideHeader;return n&&!r&&Object(u.d)(o.a.Fragment,null,Object(u.d)(i.c,{size:"lg"}),Object(u.d)(i.b,null,"Give Feedback"))}},zBJ4:function(t,e,n){var r=n("2oRo"),o=n("hh1v"),i=r.document,s=o(i)&&o(i.createElement);t.exports=function(t){return s?i.createElement(t):{}}},zfnd:function(t,e,n){var r=n("glrk"),o=n("hh1v"),i=n("8GlL");t.exports=function(t,e){if(r(t),o(e)&&e.constructor===t)return e;var n=i.f(t);return(0,n.resolve)(e),n.promise}},zk60:function(t,e,n){var r=n("2oRo"),o=n("kRJp");t.exports=function(t,e){try{o(r,t,e)}catch(n){r[t]=e}return e}}}]);
//# sourceMappingURL=commons-fdf8840e9d2801bbd1c7.js.map