(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"1Apw":function(e,t,r){"use strict";(function(e,n){r.d(t,"a",(function(){return Te})),r.d(t,"b",(function(){return de}));r("E9XD"),r("wfmh");var a,i=r("kHIg"),o=r("KQm4"),s=r("Ji7U"),c=r("md7G"),u=r("foSv"),h=r("ODXe"),f=r("rePB"),l=r("Ff2n"),p=r("o0o1"),d=r.n(p),v=(r("ls82"),r("HaE+")),y=r("1OyB"),b=r("vuIU"),w=r("16gb"),k=r("iGi1"),g=r("Zova"),m=r("C9+b");function O(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return x(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return x(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function T(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(c.a)(this,r)}}function A(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?A(Object(r),!0).forEach((function(t){Object(f.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var j=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),a=0;for(t=0;t<r;t++)for(var i=arguments[t],o=0,s=i.length;o<s;o++,a++)n[a]=i[o];return n},_=function(e,t,r){this.name=e,this.version=t,this.os=r,this.type="browser"},S=function(t){this.version=t,this.type="node",this.name="node",this.os=e.platform},N=function(e,t,r,n){this.name=e,this.version=t,this.os=r,this.bot=n,this.type="bot-device"},I=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},R=function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},P=/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,C=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/Edg\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FBAV\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],U=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function D(e){var t=function(e){return""!==e&&C.reduce((function(t,r){var n=r[0],a=r[1];if(t)return t;var i=a.exec(e);return!!i&&[n,i]}),!1)}(e);if(!t)return null;var r=t[0],n=t[1];if("searchbot"===r)return new I;var a=n[1]&&n[1].split(/[._]/).slice(0,3);a?a.length<3&&(a=j(a,function(e){for(var t=[],r=0;r<e;r++)t.push("0");return t}(3-a.length))):a=[];var i=a.join("."),o=function(e){for(var t=0,r=U.length;t<r;t++){var n=U[t],a=n[0];if(n[1].exec(e))return a}return null}(e),s=P.exec(e);return s&&s[1]?new N(r,i,o,s[1]):new _(r,i,o)}var B=function(){function e(){if(Object(y.a)(this,e),!e.fetch)throw new Error("DefaultNetworkTransport.fetch must be set before it's used");if(!e.AbortController)throw new Error("DefaultNetworkTransport.AbortController must be set before it's used")}var t;return Object(b.a)(e,[{key:"fetchWithCallbacks",value:function(e,t){this.fetch(e).then(function(){var e=Object(v.a)(d.a.mark((function e(t){var r,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.text();case 2:return r=e.sent,n={},t.headers.forEach((function(e,t){n[t]=e})),e.abrupt("return",{statusCode:t.status,headers:n,body:r});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(e){return t.onSuccess(e)})).catch((function(e){return t.onError(e)}))}},{key:"fetch",value:(t=Object(v.a)(d.a.mark((function t(r){var n,a,i,o,s,c;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.timeoutMs,a=r.url,i=Object(l.a)(r,["timeoutMs","url"]),o=this.createTimeoutSignal(n),s=o.signal,c=o.cancelTimeout,t.prev=2,t.next=5,e.fetch(a,E({signal:s},i));case 5:return t.abrupt("return",t.sent);case 6:return t.prev=6,c(),t.finish(6);case 9:case"end":return t.stop()}}),t,this,[[2,,6,9]])}))),function(e){return t.apply(this,arguments)})},{key:"createTimeoutSignal",value:function(t){if("number"==typeof t){var r=new e.AbortController,n=setTimeout((function(){r.abort()}),t);return{signal:r.signal,cancelTimeout:function(){clearTimeout(n)}}}return{signal:void 0,cancelTimeout:function(){}}}}]),e}();B.DEFAULT_HEADERS={"Content-Type":"application/json"},B.fetch=window.fetch.bind(window),B.AbortController=window.AbortController;var W="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n?n:"undefined"!=typeof self?self:{};var F,M,J=function(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&r.path)}},r.exports),r.exports}((function(e,t){!function(t,r){e.exports=function(t){var r,n=(t=t||{}).Base64,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=function(e){for(var t={},r=0,n=e.length;r<n;r++)t[e.charAt(r)]=r;return t}(a),o=String.fromCharCode,s=function(e){if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?o(192|t>>>6)+o(128|63&t):o(224|t>>>12&15)+o(128|t>>>6&63)+o(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return o(240|t>>>18&7)+o(128|t>>>12&63)+o(128|t>>>6&63)+o(128|63&t)},c=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,u=function(e){return e.replace(c,s)},h=function(e){var t=[0,2,1][e.length%3],r=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0);return[a.charAt(r>>>18),a.charAt(r>>>12&63),t>=2?"=":a.charAt(r>>>6&63),t>=1?"=":a.charAt(63&r)].join("")},f=t.btoa&&"function"==typeof t.btoa?function(e){return t.btoa(e)}:function(e){if(e.match(/[^\x00-\xFF]/))throw new RangeError("The string contains invalid characters.");return e.replace(/[\s\S]{1,3}/g,h)},l=function(e){return f(u(String(e)))},p=function(e){return e.replace(/[+\/]/g,(function(e){return"+"==e?"-":"_"})).replace(/=/g,"")},d=function(e,t){return t?p(l(e)):l(e)};t.Uint8Array&&(r=function(e,t){for(var r="",n=0,i=e.length;n<i;n+=3){var o=e[n],s=e[n+1],c=e[n+2],u=o<<16|s<<8|c;r+=a.charAt(u>>>18)+a.charAt(u>>>12&63)+(void 0!==s?a.charAt(u>>>6&63):"=")+(void 0!==c?a.charAt(63&u):"=")}return t?p(r):r});var v,y=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,b=function(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return o(55296+(t>>>10))+o(56320+(1023&t));case 3:return o((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return o((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},w=function(e){return e.replace(y,b)},k=function(e){var t=e.length,r=t%4,n=(t>0?i[e.charAt(0)]<<18:0)|(t>1?i[e.charAt(1)]<<12:0)|(t>2?i[e.charAt(2)]<<6:0)|(t>3?i[e.charAt(3)]:0),a=[o(n>>>16),o(n>>>8&255),o(255&n)];return a.length-=[0,0,2,1][r],a.join("")},g=t.atob&&"function"==typeof t.atob?function(e){return t.atob(e)}:function(e){return e.replace(/\S{1,4}/g,k)},m=function(e){return g(String(e).replace(/[^A-Za-z0-9\+\/]/g,""))},O=function(e){return String(e).replace(/[-_]/g,(function(e){return"-"==e?"+":"/"})).replace(/[^A-Za-z0-9\+\/]/g,"")},x=function(e){return function(e){return w(g(e))}(O(e))};t.Uint8Array&&(v=function(e){return Uint8Array.from(m(O(e)),(function(e){return e.charCodeAt(0)}))});var T=function(){var e=t.Base64;return t.Base64=n,e};if(t.Base64={VERSION:"2.6.4",atob:m,btoa:f,fromBase64:x,toBase64:d,utob:u,encode:d,encodeURI:function(e){return d(e,!0)},btou:w,decode:x,noConflict:T,fromUint8Array:r,toUint8Array:v},"function"==typeof Object.defineProperty){var A=function(e){return{value:e,enumerable:!1,writable:!0,configurable:!0}};t.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",A((function(){return x(this)}))),Object.defineProperty(String.prototype,"toBase64",A((function(e){return d(this,e)}))),Object.defineProperty(String.prototype,"toBase64URI",A((function(){return d(this,!0)})))}}t.Meteor&&(Base64=t.Base64);e.exports&&(e.exports.Base64=t.Base64);return{Base64:t.Base64}}(t)}("undefined"!=typeof self?self:"undefined"!=typeof window?window:W)})),L={relaxed:!1};function V(e){return m.a.serialize(e,L)}function H(e){return Array.isArray(e)?e.map((function(e){return m.a.deserialize(e)})):m.a.deserialize(e)}!function(e){e.Normal="normal",e.Server="server"}(F||(F={})),function(e){e.NAME="name",e.EMAIL="email",e.PICTURE="picture",e.FIRST_NAME="first_name",e.LAST_NAME="last_name",e.GENDER="gender",e.BIRTHDAY="birthday",e.MIN_AGE="min_age",e.MAX_AGE="max_age"}(M||(M={}));var K=(a={},Object(f.a)(a,M.NAME,"name"),Object(f.a)(a,M.EMAIL,"email"),Object(f.a)(a,M.PICTURE,"pictureUrl"),Object(f.a)(a,M.FIRST_NAME,"firstName"),Object(f.a)(a,M.LAST_NAME,"lastName"),Object(f.a)(a,M.GENDER,"gender"),Object(f.a)(a,M.BIRTHDAY,"birthday"),Object(f.a)(a,M.MIN_AGE,"minAge"),Object(f.a)(a,M.MAX_AGE,"maxAge"),a),G=function e(t){if(Object(y.a)(this,e),this.type=F.Normal,this.identities=[],"object"==typeof t&&null!==t){var r=t.type,n=t.identities,a=t.data;if("string"!=typeof r)throw new Error("Expected 'type' in the response body");if(this.type=r,!Array.isArray(n))throw new Error("Expected 'identities' in the response body");if(this.identities=n.map((function(e){return{id:e.id,providerType:e.provider_type}})),"object"!=typeof a||null===a)throw new Error("Expected 'data' in the response body");var i=Object.fromEntries(Object.entries(a).map((function(e){var t=Object(h.a)(e,2),r=t[0],n=t[1];return r in K?[K[r],n]:[r,n]})));this.data=H(i)}else this.data={}},q=function(){function e(t,r){Object(y.a)(this,e),this.storage=t,this.keyPart=r}return Object(b.a)(e,[{key:"get",value:function(t){return this.storage.get(this.keyPart+e.PART_SEPARATOR+t)}},{key:"set",value:function(t,r){return this.storage.set(this.keyPart+e.PART_SEPARATOR+t,r)}},{key:"remove",value:function(t){return this.storage.remove(this.keyPart+e.PART_SEPARATOR+t)}},{key:"prefix",value:function(t){return new e(this,t)}},{key:"clear",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.storage.clear(this.keyPart+e.PART_SEPARATOR+t)}},{key:"addListener",value:function(e){return this.storage.addListener(e)}},{key:"removeListener",value:function(e){return this.storage.addListener(e)}}]),e}();q.PART_SEPARATOR=":";var z=function(e){Object(s.a)(r,e);var t=T(r);function r(e,n){return Object(y.a)(this,r),t.call(this,e,"user(".concat(n,")"))}return Object(b.a)(r,[{key:"accessToken",get:function(){return this.get("accessToken")},set:function(e){null===e?this.remove("accessToken"):this.set("accessToken",e)}},{key:"refreshToken",get:function(){return this.get("refreshToken")},set:function(e){null===e?this.remove("refreshToken"):this.set("refreshToken",e)}},{key:"profile",get:function(){var e=this.get("profile");if(e){var t=new G;return Object.assign(t,JSON.parse(e)),t}},set:function(e){e?this.set("profile",JSON.stringify(e)):this.remove("profile")}},{key:"providerType",get:function(){var e=this.get("providerType");if(e)return e},set:function(e){e?this.set("providerType",e):this.remove("providerType")}}]),r}(q);function $(e){return Object.fromEntries(Object.entries(e).filter((function(e){return void 0!==e[1]})))}function X(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=$(e),n=t&&Object.keys(r).length>0?"?":"";return n+Object.entries(r).map((function(e){var t=Object(h.a)(e,2),r=t[0],n=t[1];return"".concat(r,"=").concat(encodeURIComponent(n))})).join("&")}var Y=["inspect","callFunction","callFunctionStreaming"].concat(Object(o.a)(Object.getOwnPropertyNames(Object.prototype)));function Q(e){return function(e){var t,r=O(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;if("object"==typeof n)for(var a=0,i=Object.entries(n);a<i.length;a++){var o=Object(h.a)(i[a],2),s=o[0];void 0===o[1]&&delete n[s]}}}catch(c){r.e(c)}finally{r.f()}return e}(e).map((function(e){return"object"==typeof e?V(e):e}))}var Z=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(y.a)(this,e),this.fetcher=t,this.serviceName=r.serviceName,this.argsTransformation=r.argsTransformation||Q}var t;return Object(b.a)(e,[{key:"callFunction",value:(t=Object(v.a)(d.a.mark((function e(t){var r,n,a,i,o,s=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=s.length,n=new Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=s[a];return i={name:t,arguments:this.argsTransformation?this.argsTransformation(n):n},this.serviceName&&(i.service=this.serviceName),o=this.fetcher.appRoute,e.abrupt("return",this.fetcher.fetchJSON({method:"POST",path:o.functionsCall().path,body:i}));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"callFunctionStreaming",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var a={name:e,arguments:this.argsTransformation?this.argsTransformation(r):r};this.serviceName&&(a.service=this.serviceName);var i=this.fetcher.appRoute,o=X(Object(f.a)({},"baas_request",Base64.encode(JSON.stringify(a))));return this.fetcher.fetchStream({method:"GET",path:i.functionsCall().path+o})}}],[{key:"create",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new e(t,r);return new Proxy(n,{get:function(e,t,r){if("string"==typeof t&&-1===Y.indexOf(t))return e.callFunction.bind(e,t);var n=Reflect.get(e,t,r);return"function"==typeof n?n.bind(e):n}})}}]),e}(),ee=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"local-userpass";Object(y.a)(this,e),this.fetcher=t,this.providerName=r}var t,r,n,a,i,o;return Object(b.a)(e,[{key:"registerUser",value:(o=Object(v.a)(d.a.mark((function e(t,r){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.fetcher.appRoute,e.next=3,this.fetcher.fetchJSON({method:"POST",path:n.emailPasswordAuth(this.providerName).register().path,body:{email:t,password:r}});case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"confirmUser",value:(i=Object(v.a)(d.a.mark((function e(t,r){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.fetcher.appRoute,e.next=3,this.fetcher.fetchJSON({method:"POST",path:n.emailPasswordAuth(this.providerName).confirm().path,body:{token:t,tokenId:r}});case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"resendConfirmationEmail",value:(a=Object(v.a)(d.a.mark((function e(t){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.fetcher.appRoute,e.next=3,this.fetcher.fetchJSON({method:"POST",path:r.emailPasswordAuth(this.providerName).confirmSend().path,body:{email:t}});case 3:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"resetPassword",value:(n=Object(v.a)(d.a.mark((function e(t,r,n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.fetcher.appRoute,e.next=3,this.fetcher.fetchJSON({method:"POST",path:a.emailPasswordAuth(this.providerName).reset().path,body:{token:t,tokenId:r,password:n}});case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"sendResetPasswordEmail",value:(r=Object(v.a)(d.a.mark((function e(t){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.fetcher.appRoute,e.next=3,this.fetcher.fetchJSON({method:"POST",path:r.emailPasswordAuth(this.providerName).resetSend().path,body:{email:t}});case 3:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"callResetPasswordFunction",value:(t=Object(v.a)(d.a.mark((function e(t,r){var n,a,i,o,s=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=this.fetcher.appRoute,a=s.length,i=new Array(a>2?a-2:0),o=2;o<a;o++)i[o-2]=s[o];return e.next=4,this.fetcher.fetchJSON({method:"POST",path:n.emailPasswordAuth(this.providerName).resetCall().path,body:{email:t,password:r,arguments:i}});case 4:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})}]),e}();var te={api:function(){return{path:"/api/client/v2.0",app:function(e){return{path:this.path+"/app/".concat(e),location:function(){return{path:this.path+"/location"}},authProvider:function(e){return{path:this.path+"/auth/providers/".concat(e),login:function(){return{path:this.path+"/login"}}}},emailPasswordAuth:function(e){return E(E({},this.authProvider(e)),{},{register:function(){return{path:this.path+"/register"}},confirm:function(){return{path:this.path+"/confirm"}},confirmSend:function(){return{path:this.path+"/confirm/send"}},reset:function(){return{path:this.path+"/reset"}},resetSend:function(){return{path:this.path+"/reset/send"}},resetCall:function(){return{path:this.path+"/reset/call"}}})},functionsCall:function(){return{path:this.path+"/functions/call"}}}},auth:function(){return{path:this.path+"/auth",apiKeys:function(){return{path:this.path+"/api_keys",key:function(e){return{path:this.path+"/".concat(e),enable:function(){return{path:this.path+"/enable"}},disable:function(){return{path:this.path+"/disable"}}}}}},profile:function(){return{path:this.path+"/profile"}},session:function(){return{path:this.path+"/session"}}}}}}},re=function(){function e(t){Object(y.a)(this,e),this.fetcher=t}var t,r,n;return Object(b.a)(e,[{key:"create",value:function(e){return this.fetcher.fetchJSON({method:"POST",body:{name:e},path:te.api().auth().apiKeys().path,tokenType:"refresh"})}},{key:"fetch",value:function(e){return this.fetcher.fetchJSON({method:"GET",path:te.api().auth().apiKeys().key(e).path,tokenType:"refresh"})}},{key:"fetchAll",value:function(){return this.fetcher.fetchJSON({method:"GET",tokenType:"refresh",path:te.api().auth().apiKeys().path})}},{key:"delete",value:(n=Object(v.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetcher.fetchJSON({method:"DELETE",path:te.api().auth().apiKeys().key(t).path,tokenType:"refresh"});case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"enable",value:(r=Object(v.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetcher.fetchJSON({method:"PUT",path:te.api().auth().apiKeys().key(t).enable().path,tokenType:"refresh"});case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"disable",value:(t=Object(v.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetcher.fetchJSON({method:"PUT",path:te.api().auth().apiKeys().key(t).disable().path,tokenType:"refresh"});case 2:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),ne=null;function ae(){if(ne)return ne;throw new Error("Cannot get environment before it's set")}var ie,oe=function(e){Object(s.a)(r,e);var t=T(r);function r(e){var n,a=e.message,i=e.code;return Object(y.a)(this,r),(n=t.call(this,a)).name="WatchError",n.code=i,n}return r}(Object(i.a)(Error));!function(e){e.NEED_DATA="NEED_DATA",e.HAVE_EVENT="HAVE_EVENT",e.HAVE_ERROR="HAVE_ERROR"}(ie||(ie={}));var se=function(){function e(){Object(y.a)(this,e),this._state=ie.NEED_DATA,this._error=null,this._textDecoder=new(ae().TextDecoder),this._buffer="",this._bufferOffset=0,this._eventType="",this._dataBuffer=""}return Object(b.a)(e,[{key:"feedBuffer",value:function(e){this.assertState(ie.NEED_DATA),this._buffer+=this._textDecoder.decode(e,{stream:!0}),this.advanceBufferState()}},{key:"feedLine",value:function(e){if(this.assertState(ie.NEED_DATA),e.endsWith("\n")&&(e=e.substr(0,e.length-1)),e.endsWith("\r")&&(e=e.substr(0,e.length-1)),0===e.length){if(0===this._dataBuffer.length)return void(this._eventType="");this._dataBuffer.endsWith("\n")&&(this._dataBuffer=this._dataBuffer.substr(0,this._dataBuffer.length-1)),this.feedSse({data:this._dataBuffer,eventType:this._eventType}),this._dataBuffer="",this._eventType=""}if(":"!==e[0]){var t=e.indexOf(":"),r=e.substr(0,t),n=-1===t?"":e.substr(t+1);n.startsWith(" ")&&(n=n.substr(1)),"event"===r?this._eventType=n:"data"===r&&(this._dataBuffer+=n,this._dataBuffer+="\n")}}},{key:"feedSse",value:function(e){this.assertState(ie.NEED_DATA);var t=e.data.indexOf("%");if(-1!==t){for(var r="",n=0,a=t;-1!==a;a=e.data.indexOf("%",n)){r+=e.data.substr(n,a-n);var i=e.data.substr(a,3);r+="%25"===i?"%":"%0A"===i?"\n":"%0D"===i?"\r":i,n=a+i.length}r+=e.data.substr(n),e.data=r}if(e.eventType&&"message"!==e.eventType){if("error"===e.eventType){this._state=ie.HAVE_ERROR,this._error=new oe({message:e.data,code:"unknown"});try{var o=m.a.parse(e.data),s=o.error_code,c=o.error;if("string"!=typeof s)return;if("string"!=typeof c)return;this._error=new oe({message:c,code:s})}catch(h){return}}}else{try{var u=m.a.parse(e.data);if("object"==typeof u)return this._nextEvent=u,void(this._state=ie.HAVE_EVENT)}catch(f){}this._state=ie.HAVE_ERROR,this._error=new oe({message:"server returned malformed event: "+e.data,code:"bad bson parse"})}}},{key:"nextEvent",value:function(){this.assertState(ie.HAVE_EVENT);var e=this._nextEvent;return this._state=ie.NEED_DATA,this.advanceBufferState(),e}},{key:"advanceBufferState",value:function(){for(this.assertState(ie.NEED_DATA);this.state===ie.NEED_DATA;){if(this._bufferOffset===this._buffer.length)return this._buffer="",void(this._bufferOffset=0);var e=this._buffer.indexOf("\n",this._bufferOffset);if(-1===e)return void(0!==this._bufferOffset&&(this._buffer=this._buffer.substr(this._bufferOffset,this._buffer.length-this._bufferOffset),this._bufferOffset=0));this.feedLine(this._buffer.substr(this._bufferOffset,e-this._bufferOffset)),this._bufferOffset=e+1}}},{key:"assertState",value:function(e){if(this._state!==e)throw Error("Expected WatchStream to be in state ".concat(e,", but in state ").concat(this._state))}},{key:"state",get:function(){return this._state}},{key:"error",get:function(){return this._error}}]),e}(),ce=function(){function e(t,r,n,a){Object(y.a)(this,e),this.functions=Z.create(t,{serviceName:r}),this.databaseName=n,this.collectionName=a,this.serviceName=r,this.fetcher=t}return Object(b.a)(e,[{key:"find",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.functions.find({database:this.databaseName,collection:this.collectionName,query:e,project:t.projection,sort:t.sort,limit:t.limit})}},{key:"findOne",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.functions.findOne({database:this.databaseName,collection:this.collectionName,query:e,project:t.projection,sort:t.sort})}},{key:"findOneAndUpdate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.functions.findOneAndUpdate({database:this.databaseName,collection:this.collectionName,filter:e,update:t,sort:r.sort,projection:r.projection,upsert:r.upsert,returnNewDocument:r.returnNewDocument})}},{key:"findOneAndReplace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.functions.findOneAndReplace({database:this.databaseName,collection:this.collectionName,filter:e,update:t,sort:r.sort,projection:r.projection,upsert:r.upsert,returnNewDocument:r.returnNewDocument})}},{key:"findOneAndDelete",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.functions.findOneAndReplace({database:this.databaseName,collection:this.collectionName,filter:e,sort:t.sort,projection:t.projection})}},{key:"aggregate",value:function(e){return this.functions.aggregate({database:this.databaseName,collection:this.collectionName,pipeline:e})}},{key:"count",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.functions.count({database:this.databaseName,collection:this.collectionName,query:e,limit:t.limit})}},{key:"insertOne",value:function(e){return this.functions.insertOne({database:this.databaseName,collection:this.collectionName,document:e})}},{key:"insertMany",value:function(e){return this.functions.insertMany({database:this.databaseName,collection:this.collectionName,documents:e})}},{key:"deleteOne",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.functions.deleteOne({database:this.databaseName,collection:this.collectionName,query:e})}},{key:"deleteMany",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.functions.deleteMany({database:this.databaseName,collection:this.collectionName,query:e})}},{key:"updateOne",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.functions.updateOne({database:this.databaseName,collection:this.collectionName,query:e,update:t,upsert:r.upsert})}},{key:"updateMany",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.functions.updateMany({database:this.databaseName,collection:this.collectionName,query:e,update:t,upsert:r.upsert})}},{key:"watch",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.ids,n=t.filter;return Object(k.a)(d.a.mark((function t(){var a,i,o,s,c,u,h,f,l;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(w.a)(e.functions.callFunctionStreaming("watch",{database:e.databaseName,collection:e.collectionName,ids:r,filter:n}));case 2:a=t.sent,i=new se,o=!0,s=!1,t.prev=6,u=Object(g.a)(a);case 8:return t.next=10,Object(w.a)(u.next());case 10:return h=t.sent,o=h.done,t.next=14,Object(w.a)(h.value);case 14:if(f=t.sent,o){t.next=30;break}if(l=f){t.next=19;break}return t.abrupt("continue",27);case 19:i.feedBuffer(l);case 20:if(i.state!=ie.HAVE_EVENT){t.next=25;break}return t.next=23,i.nextEvent();case 23:t.next=20;break;case 25:if(i.state!=ie.HAVE_ERROR){t.next=27;break}throw i.error;case 27:o=!0,t.next=8;break;case 30:t.next=36;break;case 32:t.prev=32,t.t0=t.catch(6),s=!0,c=t.t0;case 36:if(t.prev=36,t.prev=37,o||null==u.return){t.next=41;break}return t.next=41,Object(w.a)(u.return());case 41:if(t.prev=41,!s){t.next=44;break}throw c;case 44:return t.finish(41);case 45:return t.finish(36);case 46:case"end":return t.stop()}}),t,null,[[6,32,36,46],[37,,41,45]])})))()}}]),e}();function ue(e,t,r,n){return new ce(e,t,r,n)}function he(e,t,r){return{collection:ue.bind(null,e,t,r)}}var fe,le;!function(e){e.Active="active",e.LoggedOut="logged-out",e.Removed="removed"}(fe||(fe={})),function(e){e.Normal="normal",e.Server="server"}(le||(le={}));var pe=function(){function e(t){if(Object(y.a)(this,e),this.app=t.app,this.id=t.id,this.storage=new z(this.app.storage,this.id),"accessToken"in t&&"refreshToken"in t&&"providerType"in t)this._accessToken=t.accessToken,this._refreshToken=t.refreshToken,this.providerType=t.providerType,this.storage.accessToken=t.accessToken,this.storage.refreshToken=t.refreshToken,this.storage.providerType=t.providerType;else{this._accessToken=this.storage.accessToken,this._refreshToken=this.storage.refreshToken;var r=this.storage.providerType;if(this._profile=this.storage.profile,!r)throw new Error("Storage is missing a provider type");this.providerType=r}this.fetcher=this.app.fetcher.clone({userContext:{currentUser:this}}),this.apiKeys=new re(this.fetcher),this.functions=Z.create(this.fetcher)}var t,r,n,a,i;return Object(b.a)(e,[{key:"refreshProfile",value:(i=Object(v.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetcher.fetchJSON({method:"GET",path:te.api().auth().profile().path});case 2:t=e.sent,this._profile=new G(t),this.storage.profile=this._profile;case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"logOut",value:(a=Object(v.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,null===this._refreshToken){e.next=4;break}return e.next=4,this.fetcher.fetchJSON({method:"DELETE",path:te.api().auth().session().path,tokenType:"refresh"});case 4:return e.prev=4,this.accessToken=null,this.refreshToken=null,e.finish(4);case 8:case"end":return e.stop()}}),e,this,[[0,,4,8]])}))),function(){return a.apply(this,arguments)})},{key:"linkCredentials",value:(n=Object(v.a)(d.a.mark((function e(t){var r,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.app.authenticator.authenticate(t,this);case 2:if(r=e.sent,this.id===r.userId){e.next=6;break}throw n="got user id ".concat(r.userId," expected ").concat(this.id),new Error("Link response ment for another user (".concat(n,")"));case 6:return this.accessToken=r.accessToken,e.next=9,this.refreshProfile();case 9:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"refreshAccessToken",value:(r=Object(v.a)(d.a.mark((function e(){var t,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetcher.fetchJSON({method:"POST",path:te.api().auth().session().path,tokenType:"refresh"});case 2:if(t=e.sent,"string"!=typeof(r=t.access_token)){e.next=8;break}this.accessToken=r,e.next=9;break;case 8:throw new Error("Expected an 'access_token' in the response");case 9:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"refreshCustomData",value:(t=Object(v.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.refreshAccessToken();case 2:return e.abrupt("return",this.customData);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"callFunction",value:function(e){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];return(t=this.functions).callFunction.apply(t,[e].concat(n))}},{key:"toJSON",value:function(){return{id:this.id,accessToken:this.accessToken,refreshToken:this.refreshToken,profile:this._profile,state:this.state,customData:this.customData}}},{key:"push",value:function(){throw new Error("Not yet implemented")}},{key:"mongoClient",value:function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"mongo-db";return{db:he.bind(null,e,t)}}(this.fetcher,e)}},{key:"decodeAccessToken",value:function(){if(this.accessToken){var e=this.accessToken.split(".");if(3!==e.length)throw new Error("Expected an access token with three parts");var t=e[1],r=J.Base64.decode(t),n=JSON.parse(r),a=n.exp,i=n.iat,o=n.sub,s=n.user_data,c=void 0===s?{}:s;if("number"!=typeof a)throw new Error("Failed to decode access token 'exp'");if("number"!=typeof i)throw new Error("Failed to decode access token 'iat'");return{expires:a,issuedAt:i,subject:o,userData:c}}throw new Error("Missing an access token")}},{key:"accessToken",get:function(){return this._accessToken},set:function(e){this._accessToken=e,this.storage.accessToken=e}},{key:"refreshToken",get:function(){return this._refreshToken},set:function(e){this._refreshToken=e,this.storage.refreshToken=e}},{key:"state",get:function(){return this.id in this.app.allUsers?null===this.refreshToken?fe.LoggedOut:fe.Active:fe.Removed}},{key:"isLoggedIn",get:function(){return this.state===fe.Active}},{key:"customData",get:function(){if(this.accessToken)return this.decodeAccessToken().userData;throw new Error("Cannot read custom data without an access token")}},{key:"profile",get:function(){if(this._profile)return this._profile.data;throw new Error("A profile was never fetched for this user")}},{key:"identities",get:function(){if(this._profile)return this._profile.identities;throw new Error("A profile was never fetched for this user")}},{key:"deviceId",get:function(){if(this.accessToken){var e=this.accessToken.split(".")[1];if(e){var t=JSON.parse(J.Base64.decode(e)).baas_device_id;if("string"==typeof t&&"000000000000000000000000"!==t)return t}}return null}}]),e}(),de=function(){function e(t,r,n){Object(y.a)(this,e),this.providerName=t,this.providerType=r,this.payload=n}return Object(b.a)(e,null,[{key:"anonymous",value:function(){return new e("anon-user","anon-user",{})}},{key:"userApiKey",value:function(t){return new e("api-key","api-key",{key:t})}},{key:"serverApiKey",value:function(t){return new e("api-key","api-key",{key:t})}},{key:"apiKey",value:function(t){return new e("api-key","api-key",{key:t})}},{key:"emailPassword",value:function(t,r){return new e("local-userpass","local-userpass",{username:t,password:r})}},{key:"function",value:function(t){return new e("custom-function","custom-function",t)}},{key:"jwt",value:function(t){return new e("custom-token","custom-token",{token:t})}},{key:"google",value:function(t){return new e("oauth2-google","oauth2-google",e.derivePayload(t))}},{key:"derivePayload",value:function(e){if("string"==typeof e){if(e.includes("://"))return this.derivePayload({redirectUrl:e});if(e.startsWith("4/"))return this.derivePayload({authCode:e});if(e.startsWith("ey"))return this.derivePayload({idToken:e});throw new Error("Unexpected payload: ".concat(e))}if(1===Object.keys(e).length){if("authCode"in e||"redirectUrl"in e)return e;if("idToken"in e)return{id_token:e.idToken};throw new Error("Unexpected payload: "+JSON.stringify(e))}throw new Error("Expected only one property in payload, got "+JSON.stringify(e))}},{key:"facebook",value:function(t){return new e("oauth2-facebook","oauth2-facebook",t.includes("://")?{redirectUrl:t}:{accessToken:t})}},{key:"apple",value:function(t){return new e("oauth2-apple","oauth2-apple",t.includes("://")?{redirectUrl:t}:{id_token:t})}}]),e}(),ve=function(e){Object(s.a)(r,e);var t=T(r);function r(e,n){return Object(y.a)(this,r),t.call(this,e,"app(".concat(n,")"))}return Object(b.a)(r,[{key:"getUserIds",value:function(){var e=this.get("userIds"),t=e?JSON.parse(e):[];if(Array.isArray(t))return Object(o.a)(new Set(t));throw new Error("Expected the user ids to be an array")}},{key:"setUserIds",value:function(e,t){if(t){var r,n=O(this.getUserIds());try{for(n.s();!(r=n.n()).done;){var a=r.value;-1===e.indexOf(a)&&e.push(a)}}catch(i){n.e(i)}finally{n.f()}}this.set("userIds",JSON.stringify(e))}},{key:"removeUserId",value:function(e){var t=this.getUserIds().filter((function(t){return t!==e}));this.setUserIds(t,!1)}},{key:"getDeviceId",value:function(){return this.get("deviceId")}},{key:"setDeviceId",value:function(e){this.set("deviceId",e)}}]),r}(q),ye={_stitch_client_app_id:"appId",_baas_client_app_id:"appId",_stitch_ua:"userAuth",_baas_ua:"userAuth",_stitch_link:"link",_baas_link:"link",_stitch_error:"error",_baas_error:"error",_stitch_state:"state",_baas_state:"state"},be=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ae().openWindow;Object(y.a)(this,e),this.storage=t.prefix("oauth2"),this.openWindow=r}return Object(b.a)(e,[{key:"openWindowAndWaitForRedirect",value:function(t,r){var n=this,a=e.getStateStorage(this.storage,r);return new Promise((function(e,r){var i,o=null,s=function t(){var r=a.get("result");if(r){var n=JSON.parse(r);a.removeListener(t),a.clear();try{o&&(clearInterval(i),o.close())}catch(s){console.warn("Failed closing redirect window: ".concat(s))}finally{e(n)}}};a.addListener(s),o=n.openWindow(t),i=setInterval((function(){if(o){if(o.closed){clearInterval(i),a.removeListener(s);var e=new Error("Window closed");r(e)}}else clearInterval(i)}),100)}))}},{key:"generateState",value:function(){return function(e,t){for(var r="",n=0;n<e;n++)r+=t[Math.floor(Math.random()*t.length)];return r}(12,"abcdefghijklmnopqrstuvwxyz")}}],[{key:"parseRedirectLocation",value:function(e){for(var t,r,n=(r="?"===(t=e)[0]?t.substr(1):t,Object.fromEntries(r.split("&").filter((function(e){return e.length>0})).map((function(e){return e.split("=")})).map((function(e){var t=Object(h.a)(e,2),r=t[0],n=t[1];return[r,decodeURIComponent(n)]})))),a={},i=0,o=Object.entries(ye);i<o.length;i++){var s=Object(h.a)(o[i],2),c=s[0],u=s[1],f=n[c];f&&(a[u]=f)}return a}},{key:"handleRedirect",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ae().defaultStorage,n=e.parseRedirectLocation(t),a=n.state,i=n.error;if("string"!=typeof a)throw i?new Error("Failed to handle OAuth 2.0 redirect: ".concat(i)):new Error("Failed to handle OAuth 2.0 redirect.");var o=r.prefix("oauth2"),s=e.getStateStorage(o,a);s.set("result",JSON.stringify(n))}},{key:"decodeAuthInfo",value:function(e){var t=(e||"").split("$");if(4===t.length){var r=Object(h.a)(t,4);return{accessToken:r[0],refreshToken:r[1],userId:r[2],deviceId:r[3]}}throw new Error("Failed to decode 'authInfo' into ids and tokens")}},{key:"getStateStorage",value:function(e,t){return e.prefix("state(".concat(t,")"))}}]),e}(),we=function(){function e(t,r,n){Object(y.a)(this,e),this.fetcher=t,this.oauth2=new be(r),this.getDeviceInformation=n}var t,r,n;return Object(b.a)(e,[{key:"authenticate",value:(n=Object(v.a)(d.a.mark((function e(t,r){var n,a,i,o,s,c,u,h,f,l,p,v,y;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.getDeviceInformation(),a="object"==typeof r,!t.providerType.startsWith("oauth2")||"string"!=typeof t.payload.redirectUrl){e.next=22;break}return i=this.oauth2.generateState(),e.next=6,this.getLogInUrl(t,a,{state:i,redirect:t.payload.redirectUrl,providerRedirectHeader:!!a||void 0,device:a?void 0:n.encode()});case 6:if(o=e.sent,!a){e.next=19;break}return e.next=10,this.fetcher.fetch({method:"GET",url:o,tokenType:a?"access":"none",user:r,mode:"cors",credentials:"include"});case 10:if(s=e.sent,!(c=s.headers.get("x-baas-location"))){e.next=16;break}return e.abrupt("return",this.openWindowAndWaitForAuthResponse(c,i));case 16:throw new Error("Missing ".concat("x-baas-location"," header"));case 17:e.next=20;break;case 19:return e.abrupt("return",this.openWindowAndWaitForAuthResponse(o,i));case 20:e.next=34;break;case 22:return e.next=24,this.getLogInUrl(t,a);case 24:return u=e.sent,e.next=27,this.fetcher.fetchJSON({method:"POST",url:u,body:E(E({},t.payload),{},{options:{device:n.toJSON()}}),tokenType:a?"access":"none",user:r});case 27:if(h=e.sent,f=h.user_id,l=h.access_token,p=h.refresh_token,v=void 0===p?null:p,y=h.device_id,"string"==typeof f){e.next=31;break}throw new Error("Expected a user id in the response");case 31:if("string"==typeof l){e.next=33;break}throw new Error("Expected an access token in the response");case 33:return e.abrupt("return",{userId:f,accessToken:l,refreshToken:v,deviceId:y});case 34:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"getLogInUrl",value:(r=Object(v.a)(d.a.mark((function e(t){var r,n,a,i,o,s,c=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>1&&void 0!==c[1]&&c[1],n=c.length>2&&void 0!==c[2]?c[2]:{},a=this.fetcher.appRoute,i=a.authProvider(t.providerName).login(),o=X(E({link:r?"true":void 0},n)),e.next=7,this.fetcher.locationUrl;case 7:return s=e.sent,e.abrupt("return",s+i.path+o);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"openWindowAndWaitForAuthResponse",value:(t=Object(v.a)(d.a.mark((function e(t,r){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.oauth2.openWindowAndWaitForRedirect(t,r);case 2:return n=e.sent,e.abrupt("return",be.decodeAuthInfo(n.userAuth));case 4:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})}]),e}(),ke=function(e){Object(s.a)(n,e);var t,r=T(n);function n(e,t,a,i,o,s,u){var h;Object(y.a)(this,n);var f=i?"status ".concat(a," ").concat(i):"status ".concat(a);return(h="string"==typeof o?r.call(this,"Request failed (".concat(e," ").concat(t,"): ").concat(o," (").concat(f,")")):r.call(this,"Request failed (".concat(e," ").concat(t,"): (").concat(f,")"))).method=e,h.url=t,h.statusText=i,h.statusCode=a,h.error=o,h.errorCode=s,h.link=u,Object(c.a)(h)}return Object(b.a)(n,null,[{key:"fromRequestAndResponse",value:(t=Object(v.a)(d.a.mark((function e(t,r){var a,i,o,s,c,u,h,f,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.url,o=t.method,s=r.status,c=r.statusText,!(null===(a=r.headers.get("content-type"))||void 0===a?void 0:a.startsWith("application/json"))){e.next=12;break}return e.next=5,r.json();case 5:return u=e.sent,h=u.error||"No message",f=u.error_code,l=u.link,e.abrupt("return",new n(o,i,s,c,h,f,l));case 12:return e.abrupt("return",new n(o,i,s,c));case 13:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})}]),n}(Object(i.a)(Error));function ge(e){if("object"!=typeof e||null===e)throw new Error("Expected a non-null object");if(Symbol.asyncIterator in e)return e;if("getReader"in e){var t=e;return Object(f.a)({},Symbol.asyncIterator,(function(){var e=t.getReader();return{next:function(){return e.read()},return:function(){return Object(v.a)(d.a.mark((function t(){return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.cancel();case 2:return t.abrupt("return",{done:!0,value:null});case 3:case"end":return t.stop()}}),t)})))()}}}))}throw new Error("Expected an AsyncIterable or a ReadableStream")}var me,Oe=function(){function e(t){var r=t.appId,n=t.transport,a=t.userContext,i=t.locationUrlContext;Object(y.a)(this,e),this.appId=r,this.transport=n,this.userContext=a,this.locationUrlContext=i}var t,r,n;return Object(b.a)(e,[{key:"clone",value:function(t){return new e(E({appId:this.appId,transport:this.transport,userContext:this.userContext,locationUrlContext:this.locationUrlContext},t))}},{key:"fetch",value:(n=Object(v.a)(d.a.mark((function t(r){var n,a,i,o,s,c,u,h,f;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=r.path,a=r.url,i=r.tokenType,o=void 0===i?"access":i,s=r.user,c=void 0===s?this.userContext.currentUser:s,u=Object(l.a)(r,["path","url","tokenType","user"]),"string"!=typeof n||"string"!=typeof a){t.next=5;break}throw new Error("Use of 'url' and 'path' mutually exclusive");case 5:if("string"!=typeof n){t.next=14;break}return t.next=8,this.locationUrlContext.locationUrl;case 8:return t.t0=t.sent,t.t1=n,h=t.t0+t.t1,t.abrupt("return",this.fetch(E(E({},r),{},{path:void 0,url:h})));case 14:if("string"!=typeof a){t.next=34;break}return t.next=17,this.transport.fetch(E(E({},u),{},{url:a,headers:E(E({},e.buildAuthorizationHeader(c,o)),r.headers)}));case 17:if(!(f=t.sent).ok){t.next=22;break}return t.abrupt("return",f);case 22:if(!c||401!==f.status||"access"!==o){t.next=28;break}return t.next=25,c.refreshAccessToken();case 25:return t.abrupt("return",this.fetch(E(E({},r),{},{user:c})));case 28:return c&&401===f.status&&"refresh"===o&&(c.accessToken=null,c.refreshToken=null),t.next=31,ke.fromRequestAndResponse(r,f);case 31:throw t.sent;case 32:t.next=35;break;case 34:throw new Error("Expected either 'url' or 'path'");case 35:case"end":return t.stop()}}),t,this)}))),function(e){return n.apply(this,arguments)})},{key:"fetchJSON",value:(r=Object(v.a)(d.a.mark((function t(r){var n,a,i,o,s,c;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.body,a=e.buildBody(n),i=e.buildJsonHeader(a),t.next=5,this.fetch(E(E({},r),{},{body:a,headers:E(E({Accept:"application/json"},i),r.headers)}));case 5:if(o=t.sent,!(null==(s=o.headers.get("content-type"))?void 0:s.startsWith("application/json"))){t.next=14;break}return t.next=10,o.json();case 10:return c=t.sent,t.abrupt("return",H(c));case 14:if(null!==s){t.next=18;break}return t.abrupt("return",null);case 18:throw new Error('Expected JSON response, got "'.concat(s,'"'));case 19:case"end":return t.stop()}}),t,this)}))),function(e){return r.apply(this,arguments)})},{key:"fetchStream",value:(t=Object(v.a)(d.a.mark((function e(t){var r,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(E(E({},t),{},{headers:E({Accept:"text/event-stream"},t.headers)}));case 2:return r=e.sent,n=r.body,e.abrupt("return",ge(n));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"appRoute",get:function(){return te.api().app(this.appId)}},{key:"locationUrl",get:function(){return this.locationUrlContext.locationUrl}}],[{key:"buildAuthorizationHeader",value:function(e,t){if(e&&"none"!==t){if("access"===t)return{Authorization:"Bearer ".concat(e.accessToken)};if("refresh"===t)return{Authorization:"Bearer ".concat(e.refreshToken)};throw new Error("Unexpected token type (".concat(t,")"))}return{}}},{key:"buildBody",value:function(e){if(e){if("object"==typeof e&&null!==e)return JSON.stringify(V(e));if("string"==typeof e)return e;throw console.log("body is",e),new Error("Unexpected type of body")}}},{key:"buildJsonHeader",value:function(e){return e&&e.length>0?{"Content-Type":"application/json"}:{}}}]),e}();!function(e){e.DEVICE_ID="deviceId",e.APP_ID="appId",e.APP_VERSION="appVersion",e.PLATFORM="platform",e.PLATFORM_VERSION="platformVersion",e.SDK_VERSION="sdkVersion"}(me||(me={}));var xe=function(){function e(t){var r=t.appId,n=t.appVersion,a=t.deviceId;Object(y.a)(this,e),this.sdkVersion="1.3.0";var i=ae();this.platform=i.platform,this.platformVersion=i.platformVersion,this.appId=r,this.appVersion=n,this.deviceId=a}return Object(b.a)(e,[{key:"encode",value:function(){var e=$(this);return J.Base64.encode(JSON.stringify(e))}},{key:"toJSON",value:function(){return $(this)}}]),e}(),Te=function(){function e(t){var r=this;Object(y.a)(this,e),this.users=[],this._locationUrl=null;var n="string"==typeof t?{id:t}:t;if("object"!=typeof n||"string"!=typeof n.id)throw new Error("Missing a MongoDB Realm app-id");this.id=n.id,this.baseUrl=n.baseUrl||"https://stitch.mongodb.com",n.skipLocationRequest&&(this._locationUrl=Promise.resolve(this.baseUrl)),this.localApp=n.app;var a=n.storage,i=n.transport,o=void 0===i?new B:i;this.fetcher=new Oe({appId:this.id,userContext:this,locationUrlContext:this,transport:o}),this.emailPasswordAuth=new ee(this.fetcher);var s=a||ae().defaultStorage;this.storage=new ve(s,this.id),this.authenticator=new we(this.fetcher,s,(function(){return r.deviceInformation}));try{this.hydrate()}catch(c){this.storage.clear(),console.warn("Realm app hydration failed:",c.message)}}var t,r;return Object(b.a)(e,[{key:"switchUser",value:function(e){var t=this.users.findIndex((function(t){return t===e}));if(-1===t)throw new Error("The user was never logged into this app");var r=this.users.splice(t,1),n=Object(h.a)(r,1)[0];this.users.unshift(n)}},{key:"logIn",value:(r=Object(v.a)(d.a.mark((function e(t){var r,n,a,i,o=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!(o.length>1&&void 0!==o[1])||o[1],e.next=3,this.authenticator.authenticate(t);case 3:if(n=e.sent,a=this.createOrUpdateUser(n,t.providerType),this.switchUser(a),!r){e.next=9;break}return e.next=9,a.refreshProfile();case 9:return this.storage.setUserIds(this.users.map((function(e){return e.id})),!0),(i=n.deviceId)&&"000000000000000000000000"!==i&&this.storage.set("deviceId",i),e.abrupt("return",a);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"removeUser",value:(t=Object(v.a)(d.a.mark((function e(t){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!==(r=this.users.findIndex((function(e){return e===t})))){e.next=3;break}throw new Error("The user was never logged into this app");case 3:return this.users.splice(r,1),e.next=6,t.logOut();case 6:this.storage.remove("user(".concat(t.id,"):profile")),this.storage.removeUserId(t.id);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"createOrUpdateUser",value:function(e,t){var r=this.users.find((function(t){return t.id===e.userId}));if(r)return r.accessToken=e.accessToken,r.refreshToken=e.refreshToken,r;if(!e.refreshToken)throw new Error("No refresh token in response from server");var n=new pe({app:this,id:e.userId,accessToken:e.accessToken,refreshToken:e.refreshToken,providerType:t});return this.users.unshift(n),n}},{key:"hydrate",value:function(){var e=this,t=this.storage.getUserIds();this.users=t.map((function(t){return new pe({app:e,id:t})}))}},{key:"currentUser",get:function(){var e=this.users.filter((function(e){return e.state===fe.Active}));return 0===e.length?null:e[0]}},{key:"allUsers",get:function(){return Object.fromEntries(this.users.map((function(e){return[e.id,e]})))}},{key:"locationUrl",get:function(){var e=this;if(!this._locationUrl){var t=te.api().app(this.id).location().path;this._locationUrl=this.fetcher.fetchJSON({method:"GET",url:this.baseUrl+t,tokenType:"none"}).then((function(e){var t=e.hostname;if("string"!=typeof t)throw new Error("Expected response to contain a 'hostname'");return t})).catch((function(t){throw e._locationUrl=null,t}))}return this._locationUrl}},{key:"deviceInformation",get:function(){var e=this.storage.getDeviceId(),t="string"==typeof e&&"000000000000000000000000"!==e?new m.b(e):void 0;return new xe({appId:this.localApp?this.localApp.name:void 0,appVersion:this.localApp?this.localApp.version:void 0,deviceId:t})}}],[{key:"getApp",value:function(t){if(t in e.appCache)return e.appCache[t];var r=new e(t);return e.appCache[t]=r,r}}]),e}();Te.appCache={},Te.Credentials=de;var Ae,Ee=function(){function e(){if(Object(y.a)(this,e),"object"!=typeof window)throw new Error("Cannot use LocalStorage without a global window object");this.window=window}return Object(b.a)(e,[{key:"get",value:function(e){return this.window.localStorage.getItem(e)}},{key:"set",value:function(e,t){return this.window.localStorage.setItem(e,t)}},{key:"remove",value:function(e){return this.window.localStorage.removeItem(e)}},{key:"prefix",value:function(e){return new q(this,e)}},{key:"clear",value:function(e){for(var t=[],r=0;r<this.window.localStorage.length;r++){var n=this.window.localStorage.key(r);!n||e&&!n.startsWith(e)||t.push(n)}for(var a=0,i=t;a<i.length;a++){var o=i[a];this.window.localStorage.removeItem(o)}}},{key:"addListener",value:function(e){return this.window.addEventListener("storage",e)}},{key:"removeListener",value:function(e){return this.window.removeEventListener("storage",e)}}]),e}(),je=Ae?D(Ae):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new R:"undefined"!=typeof navigator?D(navigator.userAgent):void 0!==e&&e.version?new S(e.version.slice(1)):null,_e={defaultStorage:(new Ee).prefix("realm-web"),openWindow:function(e){return window.open(e)},platform:(null==je?void 0:je.name)||"web",platformVersion:(null==je?void 0:je.version)||"0.0.0",TextDecoder:TextDecoder};ne=_e}).call(this,r("8oxB"),r("yLpj"))}}]);
//# sourceMappingURL=7cc3a356-fcaf035e88c58e70eafd.js.map